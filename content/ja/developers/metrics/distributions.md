---
title: ディストリビューション
kind: documentation
beta: true
further_reading:
  - link: graphing/metrics/distributions
    tag: Documentation
    text: ディストリビューションメトリクスの専用 UI の詳細
  - link: developers/libraries
    tag: Documentation
    text: 公式/コミュニティ寄稿の API および DogStatsD クライアントライブラリ
---
<div class="alert alert-warning">   
この機能はベータ版です。<a href="https://docs.datadoghq.com/help/">ご使用のアカウントでディストリビューションメトリクスを有効にしたい場合は、Datadog のサポートチームにお問い合わせください</a>。  
</div>

## 概要

ディストリビューションは、フラッシュ間隔の間に複数のホストから送信された値を集計して、インフラストラクチャー全体の統計的分布を測定するメトリクスタイプです。ディストリビューションメトリクスは、サービスなどの論理オブジェクトを基底のホストから独立して計測し、Agent レベルの集計によって生じる問題を解決することを目的としています。

Agent 側で集計するヒストグラムメトリクスタイプと異なり、ディストリビューションは、フラッシュ間隔の間に収集されたすべての未加工データを送信し、サーバー側で集計を行います。基になるデータ構造は集計されておらず、未加工データを表すため、ディストリビューションは 2 つの主要な機能を提供します。

* パーセンタイル集計の計算
* タグ付けのカスタマイズ

#### 例

フラッシュ間隔の間に、ホスト `HOST_1` があるメトリクスで値 [1,1,1,2,2,2,3,3] を報告し、ホスト `HOST_2` が同じメトリクスで値 [1,1,2] を報告するとします。

ここで、`HOST_1` の p50 (中央値) は 2、`HOST_2` の p50 は 1 です。集計としてサーバー側で平均値を求めると 1.5 になります。

実際は、グローバルな p50 (中央値) は、2 つの集合を組み合わせた [1,1,1,1,1,2,2,2,2,3,3] の中央値なので、2 です。ディストリビューションメトリクスは、統計的に正確なこの値を返すことができます。

### パーセンタイル集計の計算

`gauge`、`histogram` などのメトリクスタイプと同様に、`distribution` メトリクスタイプでは集計 `count`、`min`、`max`、`sum`、`avg` を利用できます。ディストリビューションメトリクスは、まず他のメトリクスと同様にタグ付けられ (コードで設定されたカスタムタグを使用)、メトリクスを報告したホストに基づいてホストタグに解決されます。

ただし、ディストリビューションメトリクスでは、さらにパーセンタイル集計を使用できます (`p50`、`p75`、`p90`、`p95`、`p99`)。つまり、フラッシュ間隔 10 秒のパーセンタイル集計付きのディストリビューションメトリクスの場合は、集計 `count`、`sum`、`min`、`max`、`avg`、`p50`、`p75`、`p90`、`p95`、`p99` を使用できます。

パーセンタイル集計は、アプリ内の [Datadog ディストリビューションメトリクスのページ][1]で追加できます。

### タグ付けのカスタマイズ

この機能を使用すると、ホストレベルの粒度を必要としない場合に、メトリクスのタグ付けを制御できます。ホワイトリストベースのタグ付け制御の詳細については、[ディストリビューションメトリクスのページ][2]を参照してください。**注**: この機能では、`!` によるタグの除外を使用できません。

## 送信

Datadog ではさまざまなメトリクスタイプがさまざまなメトリクス名で送信されます。

### DogStatsD

{{% table  %}}

| 方法 | 概要 |
| :----- | :------- |
| `dog.distribution(String metric.name, double value, String... tags)` | 1 つ以上のホストの値セットの統計的分布を追跡します。 |

#### 例

メトリクス `http_request.time` によって表される HTTP リクエストの処理時間を測定するには、次の python コードスニペットを使用します。

```python
start_time = time.time()
results = requests.get('https://google.com')
duration = time.time() - start_time
statsd.distribution('http_request.time', duration,'env:dev')
```

上のインスツルメンテーションは、合計、カウント、平均、最小値、最大値の各集計を計算します。パーセンタイルについては、[ディストリビューションのページ][2]を参照してください。

## その他の参考資料

{{< partial name="whats-next/whats-next.html" >}}
[1]: https://app.datadoghq.com/metric/distribution_metrics
[2]: /ja/graphing/metrics/distributions/#customize-tagging