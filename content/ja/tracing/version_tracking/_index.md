---
title: バージョン追跡
kind: ドキュメント
description: Datadog を使用して、デプロイ中とデプロイ後にバージョンを追跡する
further_reading:
  - link: getting_started/tagging/unified_service_tagging/
    text: 統合サービスタグ付けと予約済みタグについて学ぶ
  - link: app_analytics
    text: App Analytics クエリでディメンションとしてバージョンを使用する
---
## Version タグ

`version` は Datadog 内の[予約済みタグ][1]で、統合サービスタグ付けのため、`version` タグはインフラストラクチャー、トレース、トレースメトリクス、プロファイル、ログ全体に適用されます。

このページでは、`version` タグを使用してデプロイとサービスの動作をより適切に監視する具体的な方法について説明します。タグの設定手順については、[統合サービスタグ付け][1]のドキュメントを参照してください。

## バージョンデプロイ戦略

Datadog のバージョン追跡により、以下のデプロイ戦略 (またはその他) の使用時にデプロイされたコードのパフォーマンスを可視化して不良コードのデプロイを検出し、変更の影響を抑え、インシデントにより迅速に対応することができます。

### ローリングデプロイ

ローリングデプロイでは、新しいバージョンをホストまたはコンテナに 1 つずつデプロイしながら、トラフィックを他のインスタンスに転送することにより、ダウンタイムをゼロにできます。

Datadog を使用して、ローリングデプロイを監視し、エラーの増加を検出できます。

{{< img src="tracing/version_tracking/rolling.png" alt="サービス詳細画面のバージョン"  style="width:100%;">}}

### ブルー/グリーンデプロイ

ブルー/グリーン (または他の色の組み合わせ) デプロイでは、どちらもトラフィックを受け入れる 2 つのサービスのクラスターを実行するか、一方をスタンバイ状態にして、もう一方に問題がある場合にアクティブ化できるようにすることで、ダウンタイムを削減します。

これらのサービスの `version` タグを設定して表示すると、リクエストとエラーを比較し、クラスターの 1 つが他のクラスターよりもエラー率が高い場合、クラスターが SLO を満たしていない場合、トラフィックを受信することが想定されていないクラスターである場合を検出することができます。

### カナリアデプロイ

カナリアデプロイでは、サービスを限られた数のホストまたは一部の顧客にデプロイして、影響を制限しながら新しいデプロイをテストします。

Datadog 内で `version` タグを使用すると、カナリアデプロイのエラー率、トレース、サービスの動作を比較できます。

たとえば、次の画像では、カナリアバージョンがデプロイされ、いくつかのエラーがあり、削除されたことがわかります。そのバージョンに対応するトレースは、さらに影響を与えることなく調査に利用できます。

{{< img src="tracing/version_tracking/Canary.png" alt="サービス詳細画面のバージョン"  style="width:100%;">}}

### シャドウデプロイ

シャドウデプロイでは、リリース候補バージョンが本番バージョンと一緒にデプロイされ、着信トラフィックが両方のサービスに送信されます。ユーザーには本番からの結果のみが表示されますが、両方からデータを収集することができます。

シャドウデプロイを使用すると、実際の本番トラフィックに対して潜在的なリリースをテストできます。シャドウに `version` タグをタグ付けすると、2 つのバージョン間のエラー率、トレース、サービスの動作を比較して、シャドウバージョンをリリースする必要があるかどうかを判断できます。

## Datadog 内での Version タグの使用

`version` タグは、検索ビューを特定のバージョンにフィルターするか、異なるバージョンのメトリクスを比較するために、Datadog 内の任意の場所で使用できます。

### サービス詳細画面

{{< img src="tracing/version_tracking/ServicePage.png" alt="サービス詳細画面のバージョン"  style="width:100%;">}}

サービス詳細画面で、`version` タグが使用可能な場合、リクエストウィジェットのスコープは次のいずれかに設定できます。

- バージョンごとの合計リクエスト数
- バージョンごとの 1 秒あたりのリクエスト数

エラーウィジェットは、`version` タグを含む 3 つのオプションのいずれかにスコープを設定できます。

- バージョンごとの合計エラー数
- バージョンごとの 1 秒あたりのエラー数
- バージョンごとのエラー率

これらはすべてダッシュボードとモニターにエクスポートできます。

### リソースステータス画面

{{< img src="tracing/version_tracking/ResourcePage.png" alt="リソースステータス画面のバージョン"  style="width:100%;">}}

リソースステータス画面で、version タグが使用可能な場合、リクエストウィジェットのスコープは次のいずれかに設定できます。

- バージョンごとの合計リクエスト数
- バージョンごとの 1 秒あたりのリクエスト数

エラーウィジェットは、`version` タグを含む 3 つのオプションのいずれかにスコープを設定できます。

- バージョンごとの合計エラー数
- バージョンごとの 1 秒あたりのエラー数
- バージョンごとのエラー率

これらはすべてダッシュボードとモニターにエクスポートできます。

### トレース検索と分析

{{< img src="tracing/version_tracking/AnalyticsErrorsByVersion.gif" alt="リソースステータス画面のバージョン"  style="width:100%;">}}

使用可能な場合、`version` はトレース検索と分析の両方のタグとして使用することで、ライブ検索モードとインデックス化されたトレースをフィルタリングするか、分析クエリをフィルタリングまたはグループ化することができます。

`version` タグでのフィルタリングを含む分析は、ダッシュボードとモニターにエクスポートできます。

## その他の参考資料

{{< partial name="whats-next/whats-next.html" >}}


[1]: /ja/getting_started/tagging/unified_service_tagging/