---
further_reading:
- link: /tracing/trace_collection/dd_libraries
  tag: ドキュメント
  text: アプリケーションのインスツルメンテーションの方法について
- link: /getting_started/tagging/unified_service_tagging/
  tag: ドキュメント
  text: 統合サービスタグ付け
- link: /tracing/services/services_list/
  tag: ドキュメント
  text: Datadog に報告するサービスの一覧
- link: /metrics
  tag: ドキュメント
  text: メトリクスについて
is_beta: true
kind: documentation
private: true
title: ダイナミックインスツルメンテーション
---

{{< beta-callout url="https://www.datadoghq.com/live-debugger-request/" d-toggle="modal" d_target="#signupModal" custom_class="sign-up-trigger">}}
  ダイナミックインスツルメンテーションは、非公開ベータ版です。アクセスしたい場合は、このフォームに記入してください。
{{< /beta-callout >}}

ダイナミックインスツルメンテーションにより、コードの変更や再デプロイメントを行うことなく、ライブアプリケーションからデータをキャプチャすることができます。

## はじめに

### 要件
ダイナミックインスツルメンテーションには、以下のものが必要です。

- [Datadog Agent][1] 7.39.0 以降がサービスと一緒にインストールされていること。
- Java アプリケーションの場合、トレーシングライブラリ [`dd-trace-java`][2] 0.109.0 以降。
- Python アプリケーションの場合、トレーシングライブラリ [`dd-trace-py`][3] 1.5 以降。
- .NET アプリケーションの場合、トレーシングライブラリ [`dd-trace-dotnet`][4] 2.15 以降。
- [統合サービスタグ付け][5]タグ `service`、`env`、`version` がデプロイメントに適用されていること。
- オプションで、サービスに[ソースコードインテグレーション][6]が設定されていること。

### リモート構成を有効にする

1. [リモート構成設定ページ][7]にアクセスし、組織の機能を有効にします。
2. キーを作成します。
3. 提供された構成スニペットで `datadog-agent` を更新します。
4. `datadog-agent` の構成で `remote_configuration.refresh_interval: 5s` を設定します。

**注**: リモート構成を有効にしてキーを作成するには、Datadog の管理者権限が必要です。これは、環境ごとに 1 回限りの設定です。必要なアクセス権をお持ちでない場合は、Datadog 管理者にお問い合わせください。

### ログのインデックスを作成する

ダイナミックインスツルメンテーションのスナップショットは、Datadog のログに送信されます。それらは、アプリケーションログと一緒に表示されます。

ログのインデックスを作成し、**サンプリングなし**で希望の保持に[インデックスを構成][8]します。`source:dd_debugger` にマッチするようにフィルターを設定します。ログはそのフィルターにマッチした最初のインデックスに入るので、新しいインデックスがそのタグにマッチするかもしれないフィルターを持つ他のインデックスよりも優先されることを確認します。

### ダイナミックインスツルメンテーションを有効にする

サービス上でダイナミックインスツルメンテーションを有効にするには、そのランタイムを選択し、セットアップの指示に従います。

{{< partial name="dynamic_instrumentation/dynamic-instrumentation-languages.html" >}}

## ダイナミックインスツルメンテーションを見る

ダイナミックインスツルメンテーションは、アプリケーションがランタイムに何をしているかを理解するのに役立ちます。ダイナミックインスツルメンテーションのプローブを追加することで、コードの変更や再デプロイメントを行うことなく、アプリケーションから追加のデータをエクスポートすることができます。

### スナップショットプローブの作成

*スナップショットプローブ*は、構成されたコンテキストを Datadog にエクスポートします。これは、クラスプロパティ、メソッド引数、ローカル変数をキャプチャします。

スナップショットプローブを作成するには

1. [ダイナミックインスツルメンテーションのページ][9]へ移動します。
2. 右上の **Create Probe** をクリックするか、サービス上で 3 つの点のコンテキストメニューをクリックし、**Add the probe for this service** を選択します。
3. プローブタイプとして **Snapshot** を選択します。
4. あらかじめ入力されていない場合は、リストからサービスを選択します。
5. あらかじめ入力されていない場合は、ランタイム、環境、バージョンを選択します。
6. サービスにソースコードインテグレーションを設定した場合、プローブを設定するファイルを選択することができます。
7. ソースコードで、プローブを設定する行を選択します。

### メトリクスプローブの作成

メトリクスプローブは、コード内の選択された位置でメトリクスを発行します。ダイナミックインスツルメンテーション式言語を使用して、ローカル変数やクラスフィールドなどのコンテキストから数値を参照します。

メトリクスプローブを作成するには

1. [ダイナミックインスツルメンテーションのページ][9]へ移動します。
2. 右上の **Create Probe** をクリックするか、サービス上で 3 つの点のコンテキストメニューをクリックし、**Add the probe for this service** を選択します。
3. プローブタイプとして **Metric** を選択します。
4. メトリクスの名前を指定します。
5. メトリクスの種類を選択します。
6. メトリクス式を入力します。
7. あらかじめ入力されていない場合は、リストからサービスを選択します。
5. あらかじめ入力されていない場合は、ランタイム、環境、バージョンを選択します。
9. サービスにソースコードインテグレーションを設定した場合、プローブを設定するファイルを選択することができます。
10. ソースコードで、プローブを設定する行を選択します。

### インスツルメンテーションされたインスタンスの選択

デフォルトでは、ダイナミックインスツルメンテーションは、環境とバージョンの組み合わせごとに、ランダムに選択された 1 つのサービスのインスタンスに対してのみ有効です。有効化されたインスタンスが破壊されると、残りのインスタンスからランダムに新しいインスタンスが選択されます。

また、どのサービスのインスタンスを有効にするかを明示的に構成することもできます。この機能を使用すると、より多くのサービスインスタンスでダイナミックインスツルメンテーションを有効にしたり、特定の環境での有効化を制限したりすることができます。

サービスを選択するには

1. プローブリストのサービスの横にある 3 つの点のコンテキストメニューをクリックし、**Apply filters for service instrumentation** を選択します。
2. タグに基づいてアクティブなインスタンスを選択するために、1 つまたは複数のクエリを作成します。
3. **Apply Filter** をクリックします。

フィルターを削除するには、同じメニュー項目を開き、**Delete Filter** をクリックします。

## {{< partial name="whats-next/whats-next.html" >}}

{{< partial name="whats-next/whats-next.html" >}}

[1]: /ja/agent/
[2]: https://github.com/DataDog/dd-trace-java
[3]: https://github.com/DataDog/dd-trace-py
[4]: https://github.com/DataDog/dd-trace-dotnet
[5]: /ja/getting_started/tagging/unified_service_tagging/
[6]: /ja/integrations/guide/source-code-integration/
[7]: https://app.datadoghq.com/organization-settings/remote-config
[8]: /ja/logs/log_configuration/indexes/#add-indexes
[9]: https://app.datadoghq.com/dynamic-instrumentation