---
aliases:
- /ja/graphing/metrics/
- /ja/metrics/introduction/
- /ja/graphing/faq/inconsistent-sum-aggregation-between-different-time-windows-on-graph/
- /ja/dashboards/faq/inconsistent-sum-aggregation-between-different-time-windows-on-graph/
cascade:
  algolia:
    rank: 70
    tags:
    - メトリクスを送信する
    - メトリクスの送信
kind: documentation
title: メトリクス
---
Datadog のメトリクスとその有用性についてご紹介します。このセクションには以下のトピックが含まれます。

{{< whatsnext desc="Datadog へのメトリクス送信" >}}
    {{< nextlink href="/metrics/custom_metrics">}}<u>カスタムメトリクスの送信</u> - カスタムメトリクスとその送信方法をご紹介します。{{< /nextlink >}}
    {{< nextlink href="/opentelemetry/otel_metrics" >}}<u>OpenTelemetry メトリクスの送信</u> - Datadog Agent や OpenTelemetry Collector の構成方法について学びます。{{< /nextlink >}}
    {{< nextlink href="/metrics/types" >}}<u>メトリクスタイプ</u> - Datadog に送信できるメトリクスのタイプ。{{< /nextlink >}}
    {{< nextlink href="/metrics/distributions" >}}<u>ディストリビューションメトリクス</u> - ディストリビューションメトリクスとグローバルに正確なパーセンタイルについてご紹介します。{{< /nextlink >}}
    {{< nextlink href="/metrics/units" >}}<u>メトリクス単位</u> - メトリクスに関連付けられる単位についてご紹介します。{{< /nextlink >}}
{{< /whatsnext >}}

{{< whatsnext desc="メトリクスの視覚化とクエリ" >}}
    {{< nextlink href="/metrics/explorer" >}}<u>メトリクスエクスプローラー</u> - すべてのメトリクスを探索し、分析を行います。{{< /nextlink >}}
    {{< nextlink href="/metrics/summary" >}}<u>メトリクスサマリー</u> - Datadog メトリクスのアクティブなレポートを理解します。{{< /nextlink >}}
    {{< nextlink href="/metrics/advanced-filtering" >}}<u>高度なフィルタリング</u> - データをフィルタリングして、返されるメトリクスの範囲を絞り込みます。{{< /nextlink >}}
{{< /whatsnext >}}

{{< whatsnext desc="カスタムメトリクスのボリュームとコストの把握と管理" >}}
    {{< nextlink href="metrics/metrics-without-limits/" >}}<u>Metrics without Limits™</u> - Metrics without Limits™ を使用して、タグと集計構成を通じてカスタムメトリクスのボリュームを制御する方法を学びます。{{< /nextlink >}}
{{< /whatsnext >}}

## 概要
### メトリクスとは？

メトリクスは、レイテンシーからエラー率、ユーザーのサインアップまで、環境に関するあらゆる情報を経時的に追跡できる数値です。

Datadog では、メトリクスデータは値とタイムスタンプを持つデータポイントとして収集され、格納されます。

```text
[ 17.82,  22:11:01 ]
```

一連のデータポイントが 1 つの時系列として格納されます。

```text
[ 17.82,  22:11:01 ]
[  6.38,  22:11:12 ]
[  2.87,  22:11:38 ]
[  7.06,  22:12:00 ]
```

タイムスタンプが秒の端数であるメトリクスは、最も近い秒に丸められます。同じタイムスタンプを持つポイントがある場合、最新のポイントが前のポイントを上書きします。

### メトリクスが役立つ理由は？

メトリクスは、システムの全体像を提供します。それを使用して、環境の状態を一目で評価できます。たとえば、ユーザーが Web サイトをロードする速度や、サーバーの平均メモリ消費量などを視覚化します。問題を特定したら、[ログ][1]と[トレース][2]を使用して、トラブルシューティングします。

システムの状態を追跡するメトリクスは、{{< translate key="integration_count" >}} 以上のサービスと Datadog のインテグレーションによって自動的に取得されます。ビジネスに固有のメトリクス (カスタムメトリクスとも呼ばれます) を追跡することもできます。ユーザーログインの数、ユーザーカートのサイズ、チームのコードコミットの頻度などを追跡することができます。

さらに、メトリクスは、顧客からの需要を満たすために環境の規模を調整するのに役立ちます。リソースをどれだけ消費する必要があるかを正確に知ることは、お金を節約したり、パフォーマンスを向上させたりするのに役立ちます。

### Datadog へのメトリクスの送信

メトリクスは、いくつかの場所から Datadog に送信できます。

- [Datadog がサポートするインテグレーション][8]: {{< translate key="integration_count" >}} 以上ある Datadog のインテグレーションには、すぐに使用できるメトリクスが含まれています。このメトリクスにアクセスするには、サービスの特定のページに移動し、インストール手順に従います。たとえば、EC2 インスタンスを監視する必要がある場合は、[Amazon EC2 インテグレーションドキュメント][9]に移動します。

- Datadog のプラットフォーム内で、メトリクスを直接生成できます。たとえば、ログに表示されるエラーステータスコードをカウントし、Datadog に[それを新しいメトリクスとして保存][10]することができます。

- 多くの場合、ビジネスに関連するメトリクス (ユーザーのログインや登録数など) を追跡する必要があります。このような場合、[カスタムメトリクス][11]を作成できます。カスタムメトリクスは、[Agent][12]、[DogStatsD][13]、または [HTTP API][14] を介して送信できます。

- さらに、[Datadog Agent][15] は、いくつかの標準メトリクス (CPU やディスク使用量など) を自動的に送信します。

すべてのメトリクス送信ソースとメソッドの概要については、[メトリクスタイプのドキュメント][16]をお読みください。

### メトリクスタイプとリアルタイムメトリクスの可視性

#### メトリクスタイプ

Datadog では、カウント、ゲージ、レート、ヒストグラム、分布など、異なるユースケースに対応するいくつかの異なるメトリクスタイプをサポートしています。メトリクスタイプは、アプリのメトリクスで使用できるグラフと関数を決定します。

Datadog Agent が、送信するデータポイントごとに Datadog のサーバーに個別のリクエストを行うことはありません。代わりに、_フラッシュ時間間隔_で収集された値を報告します。メトリクスのタイプは、この間隔でホストから収集された値が送信のためにどのように集計されるかを決定します。

**_カウント_**タイプは、送信されたすべての値を時間間隔で合計します。これは、たとえば、Web サイトのヒット数を追跡するメトリクスに適しています。

**_レート_**タイプはカウントを取り、それを時間間隔の長さで割ったものです。これは、1 秒あたりのヒット数に興味がある場合に有用です。

**_ゲージ_**タイプは、間隔中に報告された最後の値を取ります。このタイプは、RAM または CPU の使用量を追跡するのに役立ちます。最後の値を取得すると、時間間隔中のホストの動作の代表的な像が得られます。この場合、_カウント_などの別のタイプを使用すると、不正確で極端な値になる可能性があります。正しいメトリクスタイプを選択することで、正確なデータを得ることができます。

**_ヒストグラム_**は、送信された値を要約した 5 つの異なる値、平均、カウント、中央値、95 パーセンタイル、最大を報告します。これにより、5 つの異なる時系列が生成されます。このメトリクスタイプは、平均値を知るだけでは不十分なレイテンシーなどに適しています。ヒストグラムを使用すると、すべてのデータポイントを記録しなくても、データがどのように分散しているかを理解できます。

**_分布_**はヒストグラムに似ていますが、環境内のすべてのホストにわたって時間間隔中に送信された値を要約します。複数のパーセンタイルをレポートすることもできます(p50、p75、p90、p95、p99)。この強力な機能の詳細については、[ディストリビューションのドキュメント][19]をご覧ください。

各メトリクスタイプの詳細な例と送信手順については、[メトリクスタイプ][16]のドキュメントを参照してください。

## メトリクスのクエリ

[メトリクスエクスプローラー][3]、[ダッシュボード][4]、または[ノートブック][5]の Datadog 全体でメトリクスを視覚化してグラフを作成できます。

以下は、時系列を視覚化した場合の例です。

{{< img src="metrics/introduction/timeseries_example.png" alt="時系列グラフでは、レイテンシーメトリクスを 1 本の青い線で表し、いくつかのスパイクを付けて表示します。" >}}

この折れ線グラフは、x 軸の時間に対して、y 軸のユーザーが経験したレイテンシー (ミリ秒単位) をプロットします。

#### 追加の視覚化

Datadog は、メトリクスを簡単にグラフ化して表示できるように、さまざまな視覚化オプションを提供しています。

メトリクスクエリは、開始時に同じ 2 つの評価ステップ、時間集計と空間集計で構成されています。詳しくは[メトリクスクエリの構造][6]を参照してください。

{{< whatsnext desc="メトリクスのユーザーがよく便利だと感じる 2 つの視覚化製品">}}
    {{< nextlink href="dashboards/widgets/query_value/" >}}<u>クエリ値ウィジェット</u> - この 2 つのステップの結果を 1 つの値に還元します。{{< /nextlink >}}
    {{< nextlink href="/dashboards/widgets/top_list/" >}}<u>トップリスト</u> - グループごとに 1 つの値を返します。{{< /nextlink >}}
{{< /whatsnext >}}

また、Datadog には、視覚化のための多くのタイプのグラフやウィジェットがあります。詳しくは、Datadog の[メトリクスグラフに関するブログシリーズ][7]をご覧ください。

ダッシュボード、ノートブック、モニターのいずれを使用しても、グラフの作成方法は一定です。グラフエディタ UI を使用するか、生のクエリ文字列を直接変更するからのいずれかの方法により、グラフを作成できます。クエリ文字列を編集するには、右端の `</>` ボタンを押します。

### メトリクスクエリの構造

Datadog のメトリクスクエリは次のようになります。

{{< img src="metrics/introduction/newanatomy.jpg" alt="カラーコードのセクションで示されたサンプルクエリ" style="width:70%;">}}

このクエリはいくつかのステップに分けることができます。

#### メトリクス名

まず、グラフを作成する特定のメトリクスを検索または **Metric** の横にあるドロップダウンから選択します。使用するメトリクスが不明な場合は、メトリクスエクスプローラーまたはノートブックで開始します。メトリクスの概要ページで、アクティブにレポートを送信しているメトリクスのリストを確認することも可能です。

#### メトリクスのフィルタリング

メトリクスを選択したら、タグに基づいてクエリにフィルターを適用することができます。たとえば、`account:prod` を使用してクエリの_スコープ_を定義し、本番環境のホストからのメトリクスのみに絞り込むことができます。詳細は[タグ付けに関するドキュメント][17]をお読みください。

#### 時間集計の構成

次に、時間ロールアップを使用してデータの粒度を選択します。この例では、1 時間 (3600 秒) ごとに 1 つのデータポイントがあると定義しました。各タイムバケットのデータをどのように集計するかを選択することができます。デフォルトでは、_平均_ が適用されますが、他にも _合計_、_最小_、_最大_、_カウント_ のオプションが使用可能です。関数やアプリ内モディファイア―を使って、メトリクスデータの集計方法やバケット化の方法をカスタマイズすることもできます。たとえば、最大を適用し、カレンダーに沿ったクエリに合わせてメトリクスデータのロールアップとバケット化の方法をカスタマイズしたい場合は、`.rollup(max, 60)` を使用できます。詳しくは、[関数][24]、[ロールアップ][23]、[アプリ内モディファイア―][25]のドキュメントを参照してください。

#### 空間集計の構成

Datadog では、「空間」とは、メトリクスがさまざまなホストやタグに分散される方法を指します。制御できる空間には、Aggregator とグループ化という 2 つの異なる側面があります。

_Aggregator_ は、各グループのメトリクスを組み合わせる方法を定義します。利用可能な集計には、合計、最小、最大、平均の 4 つがあります。

_グループ化_は、グラフ上の線を構成するものを定義します。たとえば、4 つのリージョンに数百のホストが分散している場合、リージョンごとにグループ化すると、リージョンごとに 1 つの線をグラフ化します。これにより、時系列の数を 4 つに減らすことができます。

#### 関数の適用 (任意)

グラフ値は数学[関数][18]で変更することができます。これにより、整数とメトリクス (メトリクスを2乗するなど) 間、または 2 つのメトリクス間 (`jvm.heap_memory / jvm.heap_memory_max` のように、メモリ使用率に関する新しい時系列を作成するなど) の算術演算を実行することができます。

### 時間と空間の集計

_時間集計_と_空間集計_は、クエリの 2 つの重要なコンポーネントです。これらの集計がどのように機能するかを理解すると、グラフの誤解を避けるのに役立つため、これらの概念について以下で詳しく説明します。

#### 時間集計

Datadog は大量のポイントを保管しており、ほとんどの場合、そのすべてをグラフ上に表示することはできません。ピクセルよりもデータポイント数の方が多くなるためです。Datadog は時間集計を使用して、データポイントとタイムバケツを組み合わせることでこの問題を解決しています。例えば、4 時間を調べる場合、データポイントは 2 分のバケットにまとめられます。これは_ロールアップ_と呼ばれます。クエリに定義した時間間隔が長くなると、データの粒度は小さくなります。

各タイムバケットのデータを組み合わせるために適用できる集計には、合計、最小、最大、平均、カウントの 5 つがあります。

クエリを実行するたびに時間集計が_常に_適用されることを覚えておくことが重要です。

#### 空間集計

空間集計は、ホスト、コンテナ、リージョンなどのタグによって単一のメトリクスを複数の時系列に分割します。たとえば、リージョンごとの EC2 インスタンスのレイテンシーを表示する場合は、空間集計のグループ化機能を使用して各リージョンのホストを組み合わせる必要があります。

Aggregator を使用するときに適用できる集計には、_合計_、_最小_、_最大_、_平均_の 4 つがあります。上記の例を使用して、ホストが us-east-1、us-east-2、us-west-1、us-west-2 の 4 つのリージョンに分散しているとします。各リージョンのホストは、集計関数を使用して組み合わせる必要があります。_最大_アグリゲーターを使用すると、各リージョンのホスト間で最大のレイテンシーが発生し、_平均_アグリゲーターを使用すると、リージョンごとの平均レイテンシーが発生します。

### メトリクスに関するリアルタイム情報を表示する

[メトリクスの概要ページ][20]には、過去 1 時間、1 日、または 1 週間の指定されたタイムフレームで Datadog に報告されたメトリクスのリストが表示されます。メトリクスは、メトリクス名またはタグでフィルタリングできます。

メトリクス名をクリックすると、詳細サイドパネルに詳細情報が表示されます。詳細再度パネルには、メタデータ (タイプ、ユニット、間隔)、個別のメトリクスの数、レポートホストの数、送信されたタグの数、メトリクスで送信されたすべてのタグを含むテーブルなど、特定のメトリクスの重要な情報が表示されます。メトリクスで送信されているタグを確認すると、タグ値の組み合わせによって異なるため、メトリクスからレポートされる個別のメトリクスの数を理解するのに役立ちます。

**注:** メトリクスの概要の詳細サイドパネルで報告される個別のメトリクスの数によって請求が定義されるわけではありません。過去 1 か月間の使用量の正確な計算については、[使用量の詳細][21]を参照してください。

詳細については、[メトリクスの概要ドキュメント][22]をお読みください。

## その他の参考資料

{{< whatsnext desc="メトリクスに関するトピックを続行する場合は、以下を確認してください。">}}
    {{< nextlink href="/metrics/advanced-filtering" >}}<u>高度なフィルタリング</u> - フィルターを使用して返されたメトリクスのスコープを絞り込みます。{{< /nextlink >}}
    {{< nextlink href="/metrics/distributions" >}}<u>ディストリビューションメトリクス</u> - データセット全体のグローバルパーセンタイルを計算します。{{< /nextlink >}}
    {{< nextlink href="metrics/metrics-without-limits/" >}}<u>Metrics without Limits™</u> - Metrics without Limits™ を使って、タグや集計構成によりカスタムメトリクスのボリュームを制御する方法をご紹介します。{{< /nextlink >}}
    {{< nextlink href="https://dtdg.co/fe" >}}<u>Foundation Enablement</u> - メトリクスの可能性を最大限に引き出すインタラクティブなセッションにご参加ください。{{< /nextlink >}}
{{< /whatsnext >}}

[1]: /ja/logs
[2]: /ja/tracing/
[3]: /ja/metrics/explorer/
[4]: /ja/dashboards/
[5]: /ja/notebooks/
[6]: https://docs.datadoghq.com/ja/metrics/#anatomy-of-a-metric-query
[7]: https://www.datadoghq.com/blog/timeseries-metric-graphs-101/
[8]: /ja/integrations/
[9]: /ja/integrations/amazon_ec2/
[10]: /ja/logs/logs_to_metrics/
[11]: /ja/metrics/custom_metrics/
[12]: /ja/agent/
[13]: /ja/metrics/custom_metrics/dogstatsd_metrics_submission/
[14]: /ja/api/
[15]: https://docs.datadoghq.com/ja/agent/basic_agent_usage/
[16]: /ja/metrics/types/
[17]: /ja/getting_started/tagging/using_tags/
[18]: /ja/dashboards/functions/
[19]: /ja/metrics/distributions/
[20]: https://app.datadoghq.com/metric/summary
[21]: /ja/account_management/plan_and_usage/usage_details/
[22]: /ja/metrics/summary/
[23]: /ja/dashboards/functions/rollup/#rollup-with-calendar-aligned-queries
[24]: /ja/dashboards/functions/
[25]: /ja/metrics/custom_metrics/type_modifiers/?tab=count#in-application-modifiers