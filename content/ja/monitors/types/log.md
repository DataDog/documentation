---
aliases:
- /ja/monitors/monitor_types/log
- /ja/monitors/create/types/log/
further_reading:
- link: /monitors/notify/
  tag: ドキュメント
  text: モニター通知の設定
- link: /monitors/downtimes/
  tag: ドキュメント
  text: モニターをミュートするダウンタイムのスケジュール
- link: /monitors/manage/status/
  tag: ドキュメント
  text: モニターステータスを確認
- link: https://www.datadoghq.com/blog/cidr-queries-datadog-log-management/
  tag: ブログ
  text: CIDR 表記クエリを使用して、ネットワークトラフィックログをフィルターする
kind: documentation
title: ログモニター
---

## 概要

組織で[ログ管理を有効に][1]すると、指定された種類のログが、ユーザー定義のしきい値を一定時間超えた場合にアラートするように、ログモニターを作成することができます。ログモニターは、[インデックス化ログ][2]のみを評価します。

## モニターの作成

Datadog で[ログモニター][3]を作成するには、メインナビゲーションで *Monitors --> New Monitor --> Logs* の順に進みます。

<div class="alert alert-info"><strong>注</strong>: デフォルトでは、1 アカウントあたり 1000 ログモニターという制限があります。この制限に引っかかっている場合、<a href="/monitors/configuration/#アラートのグループ化">マルチアラート</a>の使用を検討するか、<a href="/help/">サポートにお問い合わせ</a>ください。</div>

### 検索クエリを定義する

検索クエリを定義すると、検索フィールドの上にあるグラフが更新されます。

1. [ログエクスプローラーでの検索][4]と同じロジックを使用して検索クエリを作成します。
2. ログカウント、[ファセット][5]、属性、または[メジャー][6]の監視を選択します。
    * **Monitor over a log count**: 検索バーを使用 (任意) し、属性やメジャーは**選択しません**。選択されたタイムフレームで Datadog がログ数を評価し、それをしきい値の条件と比較します。
    * **Monitor over a facet or an attribute**: 属性が選択されている場合、モニターはその属性の `Unique value count` (ユニーク値カウント) をアラートします。例えば、`user.email` のような属性がある場合、ユニーク値カウントは一意のユーザーメールの数になります。どのような属性でもモニターで使用することができますが、オートコンプリートで表示されるのはファセットのみです。
    * **Monitor over measure**: [メジャー][6]が選択されていると、モニターは (メトリクスモニターと同様に) ログファセットの数値に対してアラートを出します。また、集計を選択する必要があります（`min`、`avg`、 `sum`、`median`、`pc75`、`pc90`、`pc95`、`pc98`、`pc99`、または `max`）。
3. 複数のディメンションでログをグループ化する (オプション):

   クエリに一致するすべてのログは、最大 4 つのファセットの値に基づいてグループに集計されます。複数のディメンションがある場合、上位の値は最初のディメンションに基づき決定されます。その後最初のディメンション内の上位値内の 2 番目のディメンション、最後のディメンションの順に続きます。ディメンションの制限は、ディメンションの総数に応じて異なります。
   * **ファセット 1 個**: 上位値 1000
   * **ファセット 2 個**: ファセットごとに上位値 30 (最大 900 グループ)
   * **ファセット 3 個**: ファセットごとに上位値 10 (最大 1000 グループ)
   * **ファセット 4 個**: ファセットごとに上位値 5 (最大 625 グループ)
4. アラート設定のグループ化方法を構成します（任意）:
    * **Simple alert**: すべてのソースをまとめて集計します。集計値が設定条件を満たすと、1 件のアラートを受け取ります。これは、単一のホストから受け取るメトリクスまたは多くのホストからの合計メトリクスを監視する場合に最適です。通知件数を減らしたい場合にこの方法を選択します。
    * **Multi Alert**: グループパラメーターに従い、複数のアラートを各ソースに適用します。アラートイベントは、設定された条件を満たすと各グループに生成されます。たとえば、`system.disk.in_use` を `device` でグループ化すると、容量不足のデバイスに対してアラートを個別に送信できます。

### アラートの条件を設定する

* メトリクスが `above`、`above or equal to`、`below`、`below or equal to` の場合にトリガーされる
* 過去 `5 minutes`、`15 minutes`、`1 hour` などの間のしきい値、または `custom` に `5 minutes` ～ `2 days` の値を設定します。
* アラートのしきい値 `<数値>`
* 警告のしきい値 `<数値>`

#### データなしと下限のアラート

タイムフレーム内でモニターのクエリに一致するログがない場合は、`NO DATA` が返されます。

特定のクエリに一致するすべてのグループがログの送信を停止した場合に通知を受け取るには、条件を `below 1` に設定します。これにより、すべての集計グループについて、指定のタイムフレームでモニタークエリと一致するログがない場合に通知が行われます。

モニターを何らかのディメンション (タグまたはファセット) で分割している場合に `below` 条件を使用すると、特定のグループのログが存在してカウントがしきい値未満である**場合に限り**、または**すべての**グループについてログが存在しない場合に、アラートがトリガーされます。

**例**:

* このモニターは、すべてのサービスについてログが存在しない場合にのみトリガーします。
  {{< img src="monitors/monitor_types/log/log_monitor_below_by_service.png" alt="サービスで分割された下限モニター" style="width:60%;" >}}
* このモニターは、サービス `backend` のログが存在しない場合にトリガーします。
  {{< img src="monitors/monitor_types/log/log_monitor_below_condition.png" alt="バックエンドサービスの下限モニター" style="width:60%;" >}}

#### 高度なアラート条件

高度なアラートオプション (評価遅延、新しいグループ遅延など) の詳細な手順については、[モニターコンフィギュレーション][7]ページを参照してください。

### 通知

**Say what's happening** セクションと **Notify your team** セクションの詳細については、[通知][8]ページをご確認ください。

#### ログのサンプルと違反値トップリスト

ログモニターがトリガーされると、サンプルまたは値を通知メッセージに追加できます。メッセージのないログはサンプルに含まれません。モニターのメッセージにログ属性の内容を追加するには、モニターのメッセージ本文に直接ログモニター[テンプレート変数][9]を使用します。

| モニター設定                    | 通知メッセージに追加可能な値 |
|----------------------------------|--------------------------------------|
| グループ化されていない Simple-Alert ログ数 | 最大 10 個のログサンプル。                |
| グループ化された Simple-Alert ログ数   | 最大 10 個のファセット値またはメジャー値。    |
| グループ化された Multi Alert ログ数    | 最大 10 個のログサンプル。                |
| グループ化されていない Simple-Alert メジャー   | 最大 10 個のログサンプル。                |
| グループ化された Simple-Alert メジャー     | 最大 10 個のファセット値またはメジャー値。    |
| グループ化された Multi-Alert Log メジャー  | 最大 10 個のファセット値またはメジャー値。    |

これらの通知の送信に、Slack、Jira、webhooks、Microsoft Teams、Pagerduty、電子メールを使用することができます。**注**: サンプルはリカバリ通知には表示されません。

ログサンプルを無効にするには、**Say what's happening** セクションの一番下にあるチェックボックスをオフにします。チェックボックスの隣に表示されるテキストは、モニターのグループ化によって変わります（上記を参照）。

#### 例

上位 10 の違反値の表を含める:
{{< img src="monitors/monitor_types/log/top_10_breaching_values.png" alt="上位 10 の違反値" style="width:60%;" >}}

10 のログのサンプルをアラート通知に含める:
{{< img src="monitors/monitor_types/log/10_sample_logs.png" alt="上位 10 の違反値" style="width:60%;" >}}

## その他の参考資料

{{< partial name="whats-next/whats-next.html" >}}

[1]: /ja/logs/
[2]: /ja/logs/log_configuration/indexes/
[3]: https://app.datadoghq.com/monitors#create/log
[4]: /ja/logs/explorer/search/
[5]: /ja/logs/explorer/facets/
[6]: /ja/logs/explorer/facets/#measures
[7]: /ja/monitors/configuration/#advanced-alert-conditions
[8]: /ja/monitors/notify/
[9]: /ja/monitors/notify/variables/?tab=is_alert#matching-attributetag-variables