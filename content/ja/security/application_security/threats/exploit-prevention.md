---
disable_toc: false
further_reading:
- link: /security/application_security/
  tag: ドキュメント
  text: Datadog App and API Protection で脅威から保護する
- link: /security/application_security/threats/library_configuration/
  tag: ドキュメント
  text: その他のセットアップ時の考慮事項と設定オプション
- link: https://www.datadoghq.com/blog/datadog-exploit-prevention/
  tag: ブログ
  text: Datadog Exploit Prevention でゼロ デイ攻撃からアプリケーションを保護する
- link: https://www.datadoghq.com/blog/understanding-your-waf/
  tag: ブログ
  text: 'WAF の理解: Web アプリケーションセキュリティにおける一般的なギャップへの対処方法'
title: Exploit Prevention
---


## 概要

AAP の **Exploit Prevention** を使うと、重要なアプリケーションと API をゼロ デイ脆弱性から守れます。チューニングや再設定は不要です。

AAP のコンテキスト認識機能により、アプリケーションのロジック、データ フロー、状態を深く把握できます。

Datadog tracer のテレメトリーを事前定義のヒューリスティクスと組み合わせることで、より高い精度でエクスプロイトを検知してブロックします。正当なトラフィックへの影響は最小限に抑えられます。

## Exploit Prevention の仕組み

1. アプリケーションに Datadog AAP トレーシング ライブラリを組み込むと、リクエスト、コード実行、データ フローなど、アプリケーション内のあらゆるインタラクションの詳細が収集されます。
2. 攻撃ペイロードがアプリケーションに到達すると、AAP はそのペイロードが既知の脆弱性に紐づくコード パスを通過するかどうかを評価します。
3. 潜在的なエクスプロイトが検出されると、AAP は次の処理を行います。
   1. AAP は被害が発生する前にリクエストをリアル タイムでブロックします。
   2. AAP は追加調査のためにセキュリティ シグナルを生成します。
4. Exploit Prevention の検知結果にはスタック トレースが付随し、脆弱性が存在するコード上の位置を完全に可視化できます。修正に向けた道筋が明確になります。

### 例 1: Server-side request forgery (SSRF)

攻撃者がサーバーをだまして、内部システムや外部サーバーに対する不正なリクエストを送らせます。その結果、情報漏えいにつながったり、さらなる悪用の足掛かりになったりします。

AAP Exploit Prevention は、ユーザー パラメータによって一部または全体が制御されるリクエストの URL が、攻撃者によって改ざんされ、リクエスト本来の目的が変えられていないかを確認します。

### 例 2: Local file inclusion (LFI)

攻撃者が脆弱なパラメータを悪用し、サーバー上のローカル ファイルを取り込ませます。設定ファイルなどの機密データが露出したり、リモートでのコード実行につながったりする可能性があります。

AAP Exploit Prevention はすべてのファイル アクセス試行を検査し、パスがインジェクションされていないか、また制限されたファイルへのアクセスが発生していないかを判定します。

### 例 3: SQL injection (SQLi)

攻撃者がクエリに悪意ある SQL コードを埋め込み、データベースへの不正アクセス、データ改ざん、管理操作の実行などを狙います。

AAP Exploit Prevention はすべての SQL クエリをインターセプトし、ユーザー パラメータがインジェクションされていないか、またその結果として SQL クエリ本来の目的や構造が変化していないかを確認します。

## 前提条件

- アプリケーションが Datadog tracer で計装されていることを確認してください。
- App and API Protection を有効にする必要があります。[App and API Protection のセットアップ][1] を参照してください。
- ルール更新と In-App WAF ポリシーを配信できるよう、Remote Configuration を有効にしてください。[Remote Configuration の有効化][2] を参照してください。

### ライブラリの互換性


| エクスプロイト種別                       | .NET             | Python           | Go                      | Java             | Node.js          | PHP              | Ruby              |
|------------------------------------|------------------|------------------|-------------------------|------------------|------------------|------------------|-------------------|
| サーバー サイド リクエスト フォージェリー (SSRF) | v3.3.0           | v2.15.0           | v1.70.1                 | v1.42.0          | v5.20.0, v4.44.0 | Q1 '25 に利用可能 | Q1 '25 に利用可能 |
| Local File Inclusion (LFI)         | v3.5.0           | v2.15.0           | [orchestrion][3] v1.0.0 | v1.42.0          | v5.24.0, v4.48.0 | Q1 '25 に利用可能 | Q1 '25 に利用可能 |
| SQL Injection (SQLi)               | v3.4.0           | v2.16.0          | v1.70.1                 | v1.42.0          | v5.25.0, v4.49.0 | Q1 '25 に利用可能 | Q4 '24 に利用可能 |
| コマンドインジェクション                  | v3.4.0           | v2.15.0          | Q4 '24 に利用可能        | v1.45.0          | v5.25.0, v4.49.0 | Q1 '25 に利用可能 | Q1 '25 に利用可能 |

## Exploit Prevention を有効化する


1. [In-App WAF][4] (**Security > App and API Protection > Protection > In-App WAF**) に移動します。
2. サービスに Datadog 管理ポリシーを適用している場合は、次の手順に従ってください。
   a. ポリシーを複製します。たとえば、**Managed - Block attack tools** ポリシーを使用できます。

    {{< img src="security/application_security/threats/clone-policy.png" alt="ポリシーを複製" width="100%" >}}
   b. ポリシー名と説明を追加します。

    {{< img src="security/application_security/threats/clone-policy-modal.png" alt="ポリシー複製モーダル" width="100%" >}}
   c. 作成したポリシーをクリックし、**Local File Inclusion** ルール セットを選択します。**Local File Inclusion exploit** ルールのブロックを有効にします。

    {{< img src="security/application_security/threats/local-file-inclusion.png" alt="Local File Inclusion" width="100%" >}}
   d. 同様に、**Server-side Request Forgery** ルール セットを選択し、**Server-side request forgery** exploit ルールのブロックを有効にします。

    {{< img src="security/application_security/threats/server-side-request-forgery.png" alt="サーバー サイド リクエスト フォージェリーのエクスプロイト" width="100%" >}}
3. サービスにカスタム ポリシーを適用している場合は、ポリシー複製の手順 (2.a と 2.b) を省略できます。そのまま Exploit Prevention ルールを **blocking** モードで設定してください (2.c と 2.d)。


## AAP でエクスプロイト試行を確認する

Exploit Prevention を有効にすると、AAP がエクスプロイトの試行を検知した時点で、そのリクエストをブロックします。Exploit Prevention の検知結果には常にスタック トレースが付随するため、コード内のどこに脆弱性があるのかを明確に把握でき、修正に向けた道筋を立てやすくなります。

{{< img src="security/application_security/threats/exploit-prevention-detection.png" alt="Exploit Prevention の検知" width="100%" >}}

さらに AAP は、ブロックされたすべてのトレースを関連付け、サービスを狙っている攻撃者 IP アドレスを切り分けたシグナルも生成します。攻撃元の IP を一括でブロックする、といった対応が可能です。

{{< img src="security/application_security/threats/signal-correlating-blocked-traces.png" alt="ブロックされたトレースの関連付けシグナル" width="100%" >}}

## 参考資料

{{< partial name="whats-next/whats-next.html" >}}

[1]: /ja/security/application_security/setup
[2]: /ja/agent/remote_config/?tab=configurationyamlfile#enabling-remote-configuration
[3]: /ja/tracing/trace_collection/automatic_instrumentation/dd_libraries/go/#overview
[4]: https://app.datadoghq.com/security/appsec/in-app-waf