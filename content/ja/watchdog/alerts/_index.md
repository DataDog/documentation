---
title: Watchdog アラート
---

## 概要

Watchdog はシステムおよびアプリケーション上の異常をプロアクティブに探します。そして、異常の発生状況、他のシステムへの影響、根本原因などの情報が [Watchdog アラートエクスプローラー][1]に表示されます。

{{< img src="watchdog/watchdog.png" alt="エラーログの進行中のログ異常アラートが 1 つ、エラーログの解決済みログ異常アラートが 1 つ、根本原因分析によって解決されたエラーレートアラートが 1 つ表示されている Watchdog Alerts ページ" >}}

## Watchdog アラートの詳細

アラート概要カードには、以下の項目があります。

{{< img src="watchdog/alerts/alerts_overview.png" alt="sms-service の send-sms エンドポイントにおけるエラーレートの上昇を示す Watchdog アラートカードのスクリーンショット" style="width:100%;">}}

1. **Status**: 異常は `ongoing` (進行中)、`resolved` (解決済み)、`expired` (期限切れ) のいずれかになります (48 時間以上継続中の異常は `expired` です)。
3. **Timeline**: 異常が発生した期間が記述されます。
4. **Message**: 異常の内容が説明されます。
5. **Graph**: 異常が視覚的に表現されます。
6. **Tags**: 異常の範囲が表示されます。
7. [**Impact**][4] (利用可能な場合): 異常がどのユーザー、ビュー、またはサービスに影響を及ぼすかが説明されます。

アラート概要カードの任意の場所をクリックすると、アラートの詳細ペインが表示されます。

アラート概要カードの情報を繰り返すだけでなく、**Overview** タブには、以下のフィールドを 1 つ以上含めることができます。

* **Expected Bounds**: **Show expected bounds** チェックボックスをクリックします。グラフの色が変わり、予想される動作と異常な動作が区別されます。
* **Suggested Next Steps**: 異常な動作の調査およびトリアージの手順が説明されます。
* **Monitors**: アラートに関連付けされたモニターがリストされます。表示されるモニターにはそれぞれ、現在のアラートのメトリクスとそのスコープに含まれる関連タグがあります。

さらに、Watchdog は異常が再発した際に通知するために作成可能な 1 つ以上のモニターを提案します。これらのモニターはまだ存在していないため、テーブルではその状態が `suggested` として記載されています。**Enable Monitor** をクリックして、組織に提案されたモニターを有効にします。一連のアイコンがポップアップ表示され、新しいモニターを開く、編集する、複製する、ミュートする、または削除することができます。

## Watchdog アラートエクスプローラー

Watchdog アラートフィードの絞り込みには、タイムレンジ、検索バー、ファセットを使用できます。

* **タイムレンジ**: 右上にあるタイムレンジセレクターを使用し、特定の時間範囲内で検出されたアラートを表示します。過去 6 か月までのアラートを表示できます。
* **検索バー**: **Filter alerts** 検索ボックスにテキストを入力すると、アラートのタイトルを検索できます。
* **ファセット**: Watchdog アラートフィードの左側には、以下の検索ファセットがあります。対応するボックスにチェックを入れると、アラートをファセットで絞り込むことができます。

利用可能なファセット:

| すべてのアラートグループ    | 説明                                                                     |
|---------------------|---------------------------------------------------------------------------------|
| アラートカテゴリ      | すべての `apm`、`infrastructure` または `logs` アラートを表示。                          |
| アラートタイプ          | APM やインフラストラクチャーインテグレーションのメトリクスを使用してアラートを選択します。            |
| Alert Status        | ステータス (`ongoing` (進行中)、`resolved` (解決済み)、`expired` (期限切れ)) に基づいてアラートを選択します。     |
| APM プライマリタグ     | 表示するアラートのある[定義済み APM プライマリタグ][6]。                        |
| 環境         | 表示するアラートのある環境。`env` タグの詳細については、[統合サービスタグ付け][5]を参照してください。|
| サービス             | 表示するアラートのあるサービス。`service` タグの詳細については、[統合サービスタグ付け][5]を参照してください。|
| End User Impacted   | (要 RUM)。Watchdog が影響を受けるエンドユーザーを発見した場合。詳細については、[影響分析][4]を参照してください。 |
| Root Cause          | (要 APM)。Watchdog が異常または重大な障害の根本原因を発見した場合。詳細は[根本原因分析][9]を参照してください。 |
| チーム                | 影響を受けるサービスを担当するチーム。[サービスカタログ][7]からリッチ化されます。  |
| ログ異常の種類    | この種類のログ異常のみ表示します。サポートされている種類は、新しいログパターンと、既存のログパターンの増加です。|
| ログのソース          | このソースからのログを含むアラートのみ表示します。                           |
| ログのステータス          | このログステータスのログを含むアラートのみ表示します。                         |

## Watchdog アラートカバレッジ

Watchdog アラートは、複数のアプリケーションとインフラストラクチャーのメトリクスをカバーしています。

{{< tabs >}}
{{% tab "ログ管理" %}}

取り込まれたログはインテークレベルで分析され、Watchdog が検出したパターンと `environment`、`service`、`source`、`status` タグについて集計を行います。
これらの集計されたログは、以下のような異常な動作がないかスキャンされます。

* 警告またはエラーステータスを持つログの出現。
* 警告やエラーステータスのログの急増。

すべてのログ異常はログエクスプローラーに[インサイト][3]として表示され、検索コンテキストとロールに適用された制限に一致します。
Watchdog が特に `severe` (重大) と判断したログ異常は [Watchdog アラートエクスプローラー][1]に表示され、[Watchdog ログモニター][2] をセットアップすることでアラートを発することができます。
`severe` (重大) な異常とは以下のように定義されます。

* エラーログが含まれている。
* 10 分以上続いている (一時的なエラーを除外するため)。
* 大幅に増加している (小幅な増加を除外するため)。
* `noise` スコアが低く設定されている (特定のサービスに対して過多なアラートを避けるため)。`noise` スコアはサービスレベルで次のように計算されます。
    * エラーパターンの数を見る (多いほどノイズが多い)。
    * パターンが互いにどれだけ近いかを計算する (近いほどノイズが多い)。

#### 必要なデータ履歴

Watchdog は予想される動作のベースラインを確立するために、ある程度のデータが必要です。ログ異常に関しては、最低限必要な履歴は 24 時間です。
最低限の履歴が揃った後、Watchdog は異常を検出し始め、履歴が増えるほどに改善されます。最も良いパフォーマンスは 6 週間の履歴で得られます。

#### ログ異常検出を無効にする

ログ異常検出を無効にするには、[ログ管理パイプラインページ][4]に移動し、Log Anomalies トグルをクリックします。

[1]: https://app.datadoghq.com/watchdog
[2]: /ja/monitors/types/watchdog/
[3]: /ja/watchdog/insights?tab=logmanagement#explore-insights
[4]: https://app.datadoghq.com/logs/pipelines
{{% /tab %}}
{{% tab "APM" %}}

Watchdog はすべてのサービスとリソースをスキャンして、以下のメトリクスに異常がないか調べます。

  * エラー率
  * レイテンシー
  * ヒット数（リクエスト率）

Watchdog はほとんど使われていないエンドポイントやサービスを除外することで、ノイズを減らし、少ないトラフィックにおける異常の検出を避けます。また、ヒットレートに異常があってもレイテンシーやエラーレートに影響がなければ、その異常は無視されます。

#### 必要なデータ履歴

Watchdog は予想される動作のベースラインを確立するために、ある程度のデータが必要です。メトリクス異常に関しては、最低限必要な履歴は 2 週間です。
最低限の履歴が揃った後、Watchdog は異常を検出し始め、履歴が増えるほどに改善されます。最も良いパフォーマンスは 6 週間の履歴で得られます。

{{% /tab %}}
{{% tab "Infrastructure" %}}

Watchdog は以下のインテグレーションからインフラストラクチャーメトリクスを調べます。

  * [システム][1]: ホストレベルのメモリ使用量 (メモリリーク) と TCP 再送率。
  * [Redis][2]
  * [PostgreSQL][3]
  * [NGINX][4]
  * [Docker][13]
  * [Kubernetes][14]
  * [Amazon Web Services][5]:
    * [S3][6]
    * [ELB/ALB/NLB][7]
    * [CloudFront][8]
    * [DynamoDB][9]
    * [RDS][10]
    * [ECS][11]
    * [Lambda][12]

#### 必要なデータ履歴

Watchdog は予想される動作のベースラインを確立するために、ある程度のデータが必要です。メトリクス異常に関しては、最低限必要な履歴は 2 週間です。
最低限の履歴が揃った後、Watchdog は異常を検出し始め、履歴が増えるほどに改善されます。最も良いパフォーマンスは 6 週間の履歴で得られます。

[1]: /ja/integrations/system/
[2]: /ja/integrations/redisdb/
[3]: /ja/integrations/postgres/
[4]: /ja/integrations/nginx/
[5]: /ja/integrations/amazon_web_services/
[6]: /ja/integrations/amazon_s3/
[7]: /ja/integrations/amazon_elb/
[8]: /ja/integrations/amazon_cloudfront/
[9]: /ja/integrations/amazon_dynamodb/
[10]: /ja/integrations/amazon_rds/
[11]: /ja/containers/amazon_ecs/?tab=awscli
[12]: /ja/serverless/
[13]: /ja/containers/docker/?tab=standard
[14]: /ja/containers/kubernetes/installation/?tab=operator
{{% /tab %}}
{{< /tabs >}}

### カスタム異常検出

Watchdog は、モニターやダッシュボードと同じ季節性アルゴリズムを使用しています。他のメトリクスに異常がないか探したり、感度をカスタマイズするには、以下のアルゴリズムが利用可能です。

* [異常検知モニター][10]
* [予測モニター][11]
* [外れ値モニター][12]

## Watchdog アラートの入手先

Datadog 内で Watchdog アラートが表示される場所は以下の通りです。

* [Watchdog アラートエクスプローラー][1]
* 個別の [APM サービス詳細画面][3]
* [サービスカタログ][7]内
* [Watchdog Insights パネル][8]内、すべてのエクスプローラーで使用できます

### APM ページの Watchdog 双眼鏡

Watchdog が APM メトリクスに異常を検出すると、[APM サービスカタログ][7]の影響を受けるサービスの横にピンクの Watchdog 双眼鏡アイコンが表示されます。

{{< img src="watchdog/service_list.png" alt="サービスカタログの画面、5 つのサービスが表示されています。Web ストアのサービス名の後にピンクの双眼鏡のアイコンがついています。" style="width:75%;" >}}

[Watchdog Insights][8] カルーセルで[サービス詳細画面][3]のトップに移動すると、メトリクス異常の詳細を確認することができます。

Watchdog のアイコンは、メトリクスグラフにも表示されます。

{{< img src="watchdog/latency_graph.png" alt="サービスのレイテンシー (秒) をY軸に、時間帯を X 軸にとったグラフ。グラフ全体がピンク色で表示され、上部に「May 2: 13:31 Ongoing」と表示されている" style="width:75%;" >}}

双眼鏡のアイコンをクリックすると、詳細が書かれた Watchdog アラートのカードが表示されます。

## アーカイブされたアラートの管理

Watchdog アラートをアーカイブするには、サイドパネルを開き、右上隅のフォルダアイコンをクリックします。アーカイブすると、アラートがエクスプローラーから非表示になり、Datadog の他の場所 (ホームページなど) からも非表示になります。アラートがアーカイブされると、関連するサービスやリソースの横にピンクの Watchdog 双眼鏡アイコンが表示されなくなります。

アーカイブされたアラートを見るには、[Watchdog アラートエクスプローラー][1]の左上の *Show _N_ archived alerts** のチェックボックスオプションを選択します。このオプションは、少なくとも 1 つのアラートがアーカイブされている場合にのみ利用可能です。また、各アラートを誰がいつアーカイブしたかを確認したり、アーカイブされたアラートをフィードに復元したりすることができます。

**注**: アーカイブ後であっても、Watchdog はサービスやリソースに関連する問題にフラグを立てます。

[1]: /ja/watchdog
[3]: /ja/tracing/services/service_page/
[4]: /ja/watchdog/impact_analysis/
[5]: /ja/getting_started/tagging/unified_service_tagging/
[6]: /ja/tracing/guide/setting_primary_tags_to_scope/
[7]: /ja/tracing/service_catalog/
[8]: /ja/watchdog/insights?tab=logmanagement#explore-insights
[9]: /ja/watchdog/rca/
[10]: /ja/monitors/types/anomaly/
[11]: /ja/monitors/types/forecasts/?tab=linear
[12]: /ja/monitors/types/outlier/?tab=dbscan