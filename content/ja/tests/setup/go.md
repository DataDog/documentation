---
aliases:
- /ja/continuous_integration/setup_tests/go
- /ja/continuous_integration/tests/go
- /ja/continuous_integration/tests/setup/go
code_lang: go
code_lang_weight: 60
further_reading:
- link: /continuous_integration/tests/containers/
  tag: ドキュメント
  text: コンテナ内でテスト用に環境変数を転送する
- link: /continuous_integration/tests
  tag: ドキュメント
  text: テスト結果とパフォーマンスを確認する
- link: /tests/test_impact_analysis/go
  tag: ドキュメント
  text: Test Impact Analysis を使用してテスト ジョブを高速化する
- link: /continuous_integration/troubleshooting/
  tag: ドキュメント
  text: CI Visibility のトラブルシューティング
title: Go テスト
type: multi-code-lang
---

## 互換性

サポートされているテストフレームワーク:

- `testing` パッケージ

## レポート方法の設定

テスト結果を Datadog に送信するには、Datadog Go ライブラリを設定する必要があります:

{{< tabs >}}

{{% tab "CI Provider with Auto-Instrumentation Support" %}}
{{% ci-autoinstrumentation %}}
{{% /tab %}}

{{% tab "Cloud CI Provider" %}}
{{% ci-agentless %}}
{{% /tab %}}

{{% tab "On-Premises CI Provider" %}}
{{% ci-agent %}}
{{% /tab %}}

{{< /tabs >}}

## Orchestrion のインストール

Orchestrion は、コンパイル時に Go のソース コードを処理し、`dd-trace-go` を使ってインスツルメンテーションを自動挿入するツールです。

次のコマンドを使用して、[https://github.com/datadog/orchestrion][1] から `orchestrion` をインストールします:

```bash
$ go install github.com/DataDog/orchestrion@latest
```

  - <details><summary>Optional: project <tt>go.mod</tt> registration</summary>

    >  You can automatically add `orchestrion` to your project's dependencies by running:
    > ```bash
    > $ orchestrion pin
    > ```
    > This command has the following effects:
    > 1. Create a new `orchestrion.tool.go` file containing content similar to:
    >     ```go
    >     // Code generated by `orchestrion pin`; DO NOT EDIT.
    >
    >     // This file is generated by `orchestrion pin`, and is used to include a blank import of the
    >     // orchestrion package(s) so that `go mod tidy` does not remove the requirements rom go.mod.
    >     // This file should be checked into source control.
    >
    >     //go:build tools
    >
    >     package tools
    >
    >     import _ "github.com/DataDog/orchestrion"
    >     ```
    > 2. Run `go get github.com/DataDog/orchstrion@<current-release>` to make sure the project version corresponds to the
    >    one currently being used
    > 3. Run `go mod tidy` to make sure your `go.mod` and `go.sum` files are up-to-date
    >
    > If you do not run this command, it is done automatically when required. Once done, the version of `orchestrion`
    > used by this project can be controlled directly using the `go.mod` file, as you would control any other dependency.
    </details>


Orchestrion は Go の [公式リリース ポリシー][go-releases] に合わせて、最新 2 世代の Go リリースをサポートします。古い Go リリースでも正しく動作する可能性はありますが、動作しない古いリリースについて Datadog はサポートできません。

これに加えて、Orchestrion は [Go モジュール][go-modules] を使用しているプロジェクトのみをサポートします。

[go-releases]: https://go.dev/doc/devel/release#policy
[go-modules]: https://pkg.go.dev/cmd/go#hdr-Modules__module_versions__and_more

## テストのインスツルメンテーション

ライブラリを設定するため、次の環境変数を設定します:

`DD_CIVISIBILITY_ENABLED=true` (必須)
: Test Optimization 製品を有効化します。

`DD_ENV` (必須)
: テストを実行している環境 (例: 開発者のワークステーションで実行する場合は `local`、CI プロバイダー上で実行する場合は `ci`)。

go test コマンドの先頭に `orchestrion` を付けて実行します:

```bash
$ orchestrion go test -race ./...
```

`orchestrion pin` をまだ実行していない場合、`orchestrion pin` が自動実行されるため、次のようなメッセージが表示されることがあります:

```
  ╭──────────────────────────────────────────────────────────────────────────────╮
  │                                                                              │
  │  Warning: github.com/DataDog/orchestrion is not present in your go.mod       │
  │  file.                                                                       │
  │  In order to ensure build reliability and reproductibility, orchestrion      │
  │  will now add itself in your go.mod file by:                                 │
  │                                                                              │
  │      1. creating a new file named orchestrion.tool.go                        │
  │      2. running go get github.com/DataDog/orchestrion@v0.9.4                 │
  │      3. running go mod tidy                                                  │
  │                                                                              │
  │  You should commit the resulting changes into your source control system.    │
  │                                                                              │
  ╰──────────────────────────────────────────────────────────────────────────────╯
```

### 代替手段

_Orchestrion_ は本質的に、標準の Go ツールチェーンの `-toolexec` プロキシです。`orchestrion go` を使う代わりに、`go` 側で `-toolexec` 引数を受け付けるコマンドであれば、手動で `-toolexec` 引数を指定することもできます:

```console
$ go build -toolexec 'orchestrion toolexec' .
$ go test -toolexec 'orchestrion toolexec' -race .
```

[1]: https://github.com/datadog/orchestrion

## 参考資料
{{< partial name="whats-next/whats-next.html" >}}