---
aliases:
- /ja/events/guides/migrating_from_stream_to_explorer
further_reading:
- link: https://www.datadoghq.com/blog/datadog-events/
  tag: ブログ
  text: Datadog イベントの改善によるトラブルシューティングの迅速化
kind: documentation
title: 新イベント機能への移行
---

<div class="alert alert-warning">
Datadog のレガシーイベントストリームとイベントモニターは、<strong>2022 年 6 月 30 日</strong>に廃止します。Datadog は、すべてのお客様を新しく改良されたイベントエクスペリエンスに移行します。このページには、この移行に関する重要な情報が記載されています。廃止日までに、このページの手順に従って、既存のイベント可視化およびモニターが引き続き適切に動作することを確認してください。</div>


## なぜイベント機能を変更するのですか？

10 年以上前に開始された Datadog のイベントストリームは、最も初期の機能の 1 つです。新しいイベントエクスペリエンスには、イベントからさらに大きな価値を得ることができる多くの新機能が含まれています。具体的には、イベント分析、イベントからメトリクスを生成する機能、イベントを後処理するパイプラインを作成する機能、ログ管理や APM など他の Datadog 製品と連携した、よりフレンドリーで直感的なクエリ構文などです。

## 移行スケジュールを教えてください。

<strong>2022 年 3 月</strong> - 新しいイベントエクスプローラーと分析にアクセスできるようになります。Datadog は、API で管理されていないお客様のダッシュボードやモニターの移行を開始します。

<strong>2022 年 5 月 5 日</strong> - イベントストリームは廃止し、イベントエクスプローラーに移行します。

<strong>2022 年 5 月 19 日</strong> - Datadog は移行されていないイベントモニターの評価は続けますが、この日からその編集はできなくなります。新しいイベントモニターは、新しい構文を使用する必要があります。

<strong>2022 年 6 月 30 日</strong> - Datadog は、移行されていないイベントモニターの評価を停止します。レガシーイベントモニターが動作しなくなります。

## どのようなアクションが必要ですか？

外部の API ベースのツール (Terraform やスクリプトなど) を使用してダッシュボードやモニターを管理<strong>していない</strong>場合、<strong>お客様側での対応は必要ありません</strong>。Datadog は、2022 年 4 月 30 日までにお客様のダッシュボードとモニターを移行します。Datadog は、古いモニターをそのまま残しますが、それらはミュートされ、遅くとも 2022 年 6 月 30 日までに Datadog はその評価を停止します。

<strong>Terraform や他の API ベースのスクリプトを使用</strong>して<strong>ダッシュボード</strong>のすべてまたは一部を管理している場合、Datadog はイベントウィジェットやオーバーレイのクエリを新しい構文に移行しますが、2022 年 6 月 30 日までに同期を取るためにスクリプトを更新する必要があります。

<strong>Terraform やその他の API ベースのスクリプトを使用</strong>して<strong>モニター</strong>のすべてまたは一部を管理している場合、2022 年 6 月 30 日までに更新する必要があります。この日以降、Datadog は移行されていないモニターの新バージョンを作成し、既存のモニターをミュートして、アラートが継続されるようにします。

また、Datadog は、アップデートを提案したり、モニターにアップデートを適用することで、モニターの移行を支援することができます。

## 新機能は？

### イベントエクスプローラー

{{< img src="events/explorer/events-overview.png" alt="イベントエクスプローラー" style="width:80%;" >}}

イベントエクスプローラーは、インフラストラクチャーやサービス、または監視アラートによって生成された最新のイベントを表示します。これは、イベントストリームに代わるもので、より親しみやすく直感的なクエリ構文を提供します。詳しくは、[イベントエクスプローラー][1]を参照してください。

### イベント分析

{{< img src="events/events-analytics.png" alt="イベントアナリティクス" stype="width:40%;" >}}

エクスプローラーでのイベントの表示や検索に加え、時系列、トップリスト、テーブルとしてグラフ化し、指定したクエリのイベント数をグループ化することができるようになりました。詳しくは、[イベントアナリティクス][2]をご覧ください。

また、イベント検索クエリから 15 ヶ月間保持される[メトリクスを生成][3]し、過去のイベントに基づきモニターやアラートを作成できます。

{{< img src="events/generate-metrics.png" alt="イベント検索クエリによるメトリクスのイメージ。" >}}


### ダッシュボードでイベントをグラフ化する

{{< img src="events/graph-events.png" alt="イベントアナリティクス" stype="width:40%;" >}}

ダッシュボード内で、指定したクエリのイベントを、時系列グラフ、クエリ値、トップリスト、テーブルなどでグラフ化できるようになりました。

例えば、[Monitor Notifications Overview][4] ダッシュボードは、モニターアラートイベントの傾向を分析し、構成の改善とアラートの疲労を軽減するのに役立ちます。

### 新イベントモニター体験

イベントモニターは、他の製品 (ログ、RUM、APM) と同じ標準化された機能セットを使用するように移植され、さらに機能を追加しています。

イベントモニターを作成する際、従来の空白で埋めるタイプのクエリから、新しいクエリ検索フィールドにオートコンプリートが追加されました。

{{< img src="events/guides/events-migration-monitor-new.png" alt="モニタークエリ構文の新しい UI" style="width:100%;" >}}

新しいクエリ検索では、ブール演算子やワイルドカードなどの新しい機能により、イベントモニターで複雑なクエリを使用することができます。

### パイプライン

Datadog は、JSON 形式のイベントを自動的にパースします。イベントが JSON 形式でない場合は、処理パイプラインで順次イベントを連結することにより、パースされ、リッチ化されます。プロセッサーは、半構造化テキストから意味のある情報や属性を抽出し、ファセットとして再利用します。パイプラインを通過する各イベントは、すべてのパイプラインフィルターに対してテストされます。もしフィルターにマッチすれば、次のパイプラインに移る前に、すべてのプロセッサーが順次適用されます。

## 予約済み属性

このリストでは、イベントとともに自動的に取り込まれる予約属性について説明します。

| 属性 | 説明                                                                                                                                                                                                                                |
|-----------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| `host`    | メトリクスで定義された送信元ホストの名前。Datadog で一致したホストから、対応するホストタグが自動的に取得され、イベントに適用されます。Agent では、この値が自動的に設定されます。                          |
| `source`  | これは、インテグレーション名、またはイベントの生成元に対応します。インテグレーション名と一致する場合、対応するパーサーとファセットが自動的にインストールされます。たとえば、`nginx`、`postgresql` などです。 |
| `status`  | これは、イベントのレベルまたは重大度に対応します。      |
| `service` | イベントを生成するアプリケーションまたはサービスの名前。 |
| `message` | デフォルトでは、Datadog は `message` 属性の値をイベントエントリーの本文として取り込みます。 |                     

## 何が変わったのですか？

**注:** イベント送信の流れは従来通りです。これまで通り、API、Agent、メールでのイベント送信機能を使用してイベントを送信することができます。

### イベントの集計が実行されず、UI にも表示されなくなりました
Datadog は、イベントの集計を自動的に行わなくなり、`aggregation_key`属性でイベントをグループ化しなくなりました。UI にイベントの集計が表示されなくなりました。

### イベントコメントがサポートされなくなり、UI にも表示されなくなりました
API を使って `user_update` イベントタイプで作成されたコメントは、通常のイベントとして表示されます。

### クエリのステータスリマッピング
一部のステータス値が変更になりました。

| レガシーステータス | 新しいステータス |
|---------------|------------|
| success       | ok         |
| 警告       | warn       |
| info          | info       |
| error         | error      |

### クエリのソースリマッピング
多くのイベントソース名が変更されています。影響を受ける[ソース名][5]の全リストをご覧ください。

### モニター評価ウィンドウは 48 時間に制限されています。
モニターは 48 時間を超えて評価されることはありません。より長い評価ウィンドウを使用する必要がある場合は、イベントから[カスタムメトリクスを生成][3]して、評価ウィンドウが最大 1 ヶ月になるメトリクスモニターを使用することができます。

### 最大 4 つのファセットのみでグループ化できます。
(従来: 無制限グループ) グループの最高頻度値であるトップバリューは、グループの総数に基づいて制限されています。例えば、あるモニターがファセットの制限回数より多くトリガーした場合、トップグループでソートし、上位 N グループのみを表示します。例えば、2 つのファセットでグループ化し、1 つのファセットが `host` である場合、N = 30 の結果ホストとなります。
  * 1 つのファセットで 1000 個のトップバリューの制限があります。
  * 2 つのファセットでは、1 ファセットあたり 30 個のトップバリューの制限があります (最大 900 グループ)。
  * 3 つのファセットでは、1 ファセットあたり 10 個のトップバリューの制限があります (最大 1000 グループ)。
  * 4 つのファセットでは、1 グループあたり 5 個のトップバリューの制限があります (最大 625 グループ)。

### モニターの回復しきい値はサポートされなくなりました
イベントモニターのしきい値は、もはや `warning_recovery` と `critical_recovery` のしきい値タイプをサポートしません。新しいイベントモニターでは、回復しきい値を削除する必要があります。

これらの機能を使用している場合は、[サポートに連絡][6]して、別の解決策を見つけるための支援を得てください。

## 例

### 新旧イベントクエリ構文例

GitHub または Chef からのイベントを表示する
: レガシー構文</br>
`sources:github,chef`
: 新しい構文</br>
`source:(github OR chef)`

`env-prod` のタグが付いたイベントを表示する
: レガシー構文</br>
`tags:env-prod`
: 新しい構文</br>
`tags:env-prod`

`#env-prod` または `#db` のタグが付いたイベントを表示する
: レガシー構文</br>
`tags:env-prod,db`, `tags:env-prod OR db`
: 新しい構文</br>
`tags:(env-prod OR db)`

`#security-group:sg-123` と `#role:common-node` のタグが付いたイベントを表示する
: レガシー構文</br>
`tags:security-group:sg-123 AND role:common-node`
: 新しい構文 </br>
`tags:(security-group:sg-123 AND role:common-node)`

ワイルドカードを使用して接頭辞や接尾辞を検索する
: レガシー構文</br>
利用不可
: 新しい構文 </br>
`*web` は `web` で終わるすべてのイベントメッセージにマッチします</br>
`source:amazon*` は、ソースが `amazon` で始まるすべてのイベントにマッチします

### 新旧イベントモニター API 構文例

[イベントモニター API][7] に新しいモニタークエリ構文 (「イベント V2 アラートクエリ」セクション参照) が追加され、平均値とカーディナリティのロールアップメソッドと必須属性の数が減少しました。

過去 24 時間に Slack のイベントがない
: レガシー構文</br>
`events('priority:all sources:slack').rollup('count').last('1d') < 1`
: 新しい構文 </br>
`events("source:slack").rollup("count").last("1d") < 1`

メンテナンスのためにマークされた EC2 インスタンス
: レガシー構文 </br>
`events('priority:all "Upcoming AWS maintenance event"').by('name,host').rollup('count').last('2d') >= 1`
: 新しい構文 </br>
`events("Upcoming AWS maintenance event").rollup("count").by("name,host").last("2d") >= 1`

今日、Zabbix または Prometheus がサービスのアラートをトリガーした
: レガシー構文 </br>
`events('tags:service priority:all status:error sources:prometheus sources:zabbix).rollup('count').last('1d') > 0`
: 新しい構文 </br>
`events("source:(prometheus OR zabbix) status:error tags:service").rollup("count").last("1d") > 0`

データセンターで、サービス `datadog-agent` のイベントを受信していない
: レガシー構文 </br>
レガシーイベントモニターは、カーディナリティロールアップをサポートしていません。
: 新しい構文 </br>
`events("service:datadog-agent").rollup("cardinality", "datacenter").by("service").last("15m") < 1`

## その他の参考資料

{{< partial name="whats-next/whats-next.html" >}}


[1]: /ja/events/explorer
[2]: /ja/events/explorer/#event-analytics
[3]: /ja/events/#generate-custom-metrics-from-events
[4]: https://app.datadoghq.com/dash/integration/30532/monitor-notifications-overview
[5]: /ja/events/guides/new_events_sources/
[6]: /ja/help/
[7]: /ja/api/latest/monitors/#create-a-monitor