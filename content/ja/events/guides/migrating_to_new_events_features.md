---
title: 新イベント機能への移行
kind: documentation
aliases: /events/guides/migrating_from_stream_to_explorer
---
<div class="alert alert-warning">
  このガイドを参考に、レガシーイベントストリームからイベントエクスプローラーに移行してください。イベントエクスプローラーは、2022 年第 1 四半期にすべてのお客様にロールアウトされる予定です。早期アクセスのリクエストは、<a href="/help/">Datadog サポート</a>にお問い合わせください。レガシーイベントの情報をお探しの場合は、<a href="/events/stream/">イベントストリームのドキュメント</a>を参照してください。</div>

イベントストリームは、Datadog の最も古い機能の 1 つです。イベントエクスプローラーの導入とそれに伴う変更は、イベントのクエリー構文、エクスプローラーや分析ビュー、処理パイプライン、その他の機能が、ログなどの他の Datadog 製品と同じように動作することを意味します。詳細は、[イベントエクスプローラー][1]を参照してください。

## あなたの組織にとって意味すること

* 新しいイベント (移行後) は、[イベントエクスプローラー][2]またはダッシュボードウィジェットやイベントオーバーレイにのみ表示されます。

* 古いイベント (移行前) は、残りの保存期間 (13 ヶ月) の間、[イベントストリーム][2]で引き続き表示されます。

このガイドでは、組織のイベントモニターとダッシュボードウィジェットを移行して、新しいイベント機能の恩恵を受けられるようにする方法と、従来のイベントストリームとストレージが廃止されたときに対応できるようにする方法について説明します。また、[変更点の詳細](#details-the-changes)を提供します。

## 移行プロセス

1. **アーリーアクセスを申し込みます。**イベントエクスプローラー非公開ベータ版です。[サポートに連絡][3]し、アクセスをリクエストしてください。イベントエクスプローラーがあなたの組織で有効になると、サポートチームから通知が送られます。メインナビゲーションにある Events メニューから、既存の Stream と並んで、新しいエクスプローラーやその他の機能にアクセスすることができます。

   {{< img src="events/guides/navigation.png" alt="イベントナビゲーション" style="width:100%;" >}}

   <div class="alert alert-warning">ここで立ち止まらないでください！新しいクエリ構文を使用してイベントモニターとイベント用ダッシュボードウィジェットを作成するには、Datadog サポートが組織の新機能を有効にし、次のステップで説明するように、既存のイベントモニターとダッシュボードウィジェットを新しい構文に移行する必要があります。</div>

2. **新しいイベント機能を有効にするためにサポートに連絡してください。**組織を新しいクエリ構文に切り替えるためにサポートに依頼してください。Datadog は、自動的に正しいバックエンドにクエリをルーティングします。古いクエリは引き続き古いバックエンドに、移行されたクエリは新しいバックエンドに送られるので、安全に移行できます。切り替えを有効にすると、従来のクエリ構文でモニターやダッシュボードウィジェットを作成できなくなるため、従来の API への呼び出しはエラーで失敗しますが、既存のモニターやダッシュボードはレポートを維持します。

3. **Datadog サーバーに保存されているデータを移行します。** 新しいイベントには新しいクエリ構文と異なるモニター機能があるため (詳細な変更点は以下を参照)、イベントクエリを含むイベントモニターとイベントダッシュボードウィジェットの定義を更新する必要があります。API キーを使用してアカウントに接続し、データを変換するこの[オープンソースの移行スクリプト][4]を使用してください。Datadog に依頼する場合は、[サポートにお問い合わせください][3]。

4. **外部で構成したデータを移行します (Terraform、API)。**Datadog の設定を外部の API ベースのスクリプトや Terraform などのツールで管理している場合、コンフィギュレーションファイルのダッシュボードやモニター定義を更新してください。そうしないと、次回のデプロイ時に古いクエリ構文が再び適用され、更新されたクエリが上書きされてしまいます。以下に説明する構文の変更を確認し、[移行スクリプト][4]を使用して、変換されたクエリがどのように見えるかを確認します。この段階での支援については、[サポートにお問い合わせください][3]。

5. **イベントモニターに基づく SLO がある場合**、新しいモニターを指すようにその定義を更新します。

6. **サポートに連絡して、古いパイプラインを無効化します。**移行が完了したことを[サポートに連絡][3]すると、旧パイプラインがオフになります。その後、すべてのクエリは新しいバックエンドにルーティングされ、古いスタイルのクエリはエラーを返します。

## 変更内容の詳細

### イベント API
[イベントをクエリする API エンドポイント][5]では、クエリ構文を使用しません。その代わり、タグやソースを含めたり除外したりするためのパラメータを使用します。そのため、これを使用するスクリプトでは、ステータス値を参照しない限り、何も変更する必要はありません (ステータス値は変更されています)。[ステータスリマッピング](#status-remapping)を参照してください。

### イベントクエリ構文
新しいイベントクエリは、他の製品 (ログ、RUM) と同じ検索クエリ構文を使用し、製品間で標準化されたエクスペリエンスを提供します。更新された検索クエリ構文では、ブール演算子やワイルドカードを使用したより高度なクエリがサポートされています。そのため、既存のイベントモニターやダッシュボードウィジェットのクエリ構文を変更する必要があります。

#### ステータスリマッピング

一部のステータス値が変更になりました。

| レガシーステータス | 新しいステータス |
|---------------|------------|
| success       | OK         |
| 警告       | WARN       |
| info          | INFO       |
| error         | ERROR      |

#### 新旧イベントクエリ構文例

GitHub または Chef からのイベントを表示する
: レガシー構文</br>
`sources:github,chef`
: 新しい構文</br>
`source:(github OR chef)`

`env-prod` のタグが付いたイベントを表示する
: レガシー構文</br>
`tags:env-prod`
: 新しい構文</br>
`tags:env-prod`

`#env-prod` または `#db` のタグが付いたイベントを表示する
: レガシー構文</br>
`tags:env-prod,db`, `tags:env-prod OR db`
: 新しい構文</br>
`tags:(env-prod OR db)`

`#security-group:sg-123` と `#role:common-node` のタグが付いたイベントを表示する
: レガシー構文</br>
`tags:security-group:sg-123 AND role:common-node`
: 新しい構文 </br>
`tags:(security-group:sg-123 AND role:common-node)`

ワイルドカードを使用して接頭辞や接尾辞を検索する
: レガシー構文</br>
利用不可
: 新しい構文 </br>
`*web` は `web` で終わるすべてのイベントメッセージにマッチします</br>
`source:amazon*` は、ソースが `amazon` で始まるすべてのイベントにマッチします


### イベントモニター
イベントモニターも、他の製品 (ログ、RUM、トレース) と同じ標準的な機能セットを使用するように移植され、新しい機能が追加されています。

#### イベントモニタークエリ構文

イベントモニターを作成する際、従来の空白で埋めるタイプのクエリから、新しいクエリ検索フィールドにオートコンプリートが追加されました。

**変更前:**
{{< img src="events/guides/events-migration-monitor-legacy.png" alt="モニタークエリ構文のレガシー UI" style="width:100%;" >}}

**変更後:**
{{< img src="events/guides/events-migration-monitor-new.png" alt="モニタークエリ構文の新しい UI" style="width:100%;" >}}

つまり、イベントモニターでは、ブール演算子やワイルドカードなど、上記のような機能を追加して複雑なクエリを使用することができます。

#### 新旧イベントモニター API 構文例

[イベントモニター API][6] に新しいモニタークエリ構文 (「イベント V2 アラートクエリ」セクション参照) が追加され、平均値とカーディナリティのロールアップメソッドと必須属性の数が減少しました。

過去 24 時間に Slack のイベントがない
: レガシー構文</br>
`events('priority:all sources:slack').rollup('count').last('1d') < 1`
: 新しい構文 </br>
`events("source:slack").rollup("count").last("1d") < 1`

メンテナンスのためにマークされた EC2 インスタンス
: レガシー構文 </br>
`events('priority:all "Upcoming AWS maintenance event"').by('name,host').rollup('count').last('2d') >= 1`
: 新しい構文 </br>
`events("Upcoming AWS maintenance event").rollup("count").last("2d") >= 1`

今日、Zabbix または Prometheus がサービスのアラートをトリガーした
: レガシー構文 </br>
`events('tags:service priority:all status:error sources:prometheus sources:zabbix).rollup('count').last(‘1d’) > 0`
: 新しい構文 </br>
`events("source:(prometheus OR zabbix) status:error").rollup("count").by("service").last("1d") > 0`

データセンターで、サービス `datadog-agent` のイベントを受信していない
: レガシー構文 </br>
レガシーイベントモニターは、カーディナリティロールアップをサポートしていません。
: 新しい構文 </br>
`events("service:datadog-agent").rollup("cardinality", "datacenter").by("service").last("15m") < 1`


#### その他のイベントモニター変更

* **モニター評価ウィンドウは 48 時間に制限されています。**モニターは 48 時間を超えて評価されることはありません。より長い評価ウィンドウを使用する必要がある場合は、イベントからカスタムメトリクスを生成して、評価ウィンドウが最大 1 ヶ月になるメトリクスモニターを使用することができます。

* **タグで結果をグループ化するには、タグをファセットとして追加します。**任意のタグからファセットを作成します。イベントエクスプローラーで、
  1. ファセットバーの上部にある **Add** をクリックします。
  2. ファセットとして追加したいタグを選択します。
  3. **Add** をクリックします。

* **最大 4 つのファセットでグループ化できます。**(従来: 無制限グループ) グループの最高頻度値であるトップバリューは、グループの総数に基づいて制限されています。例えば、あるモニターがファセットの制限回数より多くトリガーした場合、トップグループでソートし、上位 N グループのみを表示します。例えば、3 つのファセットと 1 つのファセットが `host` である場合、N = 30 の結果ホストとなります。
  * 1 つのファセットで 1000 個のトップバリューの制限があります。
  * 2 つのファセットでは、1 ファセットあたり 30 個のトップバリューの制限があります (最大 900 グループ)。
  * 3 つのファセットでは、1 ファセットあたり 10 個のトップバリューの制限があります (最大 1000 グループ)。
  * 4 つのファセットでは、1 グループあたり 5 個のトップバリューの制限があります (最大 625 グループ)。

### その他の廃止されたイベント機能

* **イベントアグリゲーションは UI に表示されなくなりました**が、API では引き続き利用可能です。
* **イベントコメントは、UI でサポートされなくなりました。**API を使って `user_update` イベントタイプで作成されたコメントは、通常のイベントとして表示されます。
* **UI から新しいイベントを作成することはできなくなりました**が、新しいイベントを投稿するための API は引き続き使用できます。

これらの機能を使用している場合は、[サポートに連絡][3]して、別の解決策を見つけるための支援を得てください。


[1]: /ja/events/explorer/
[2]: https://app.datadoghq.com/event/explorer
[3]: /ja/help/
[4]: https://github.com/DataDog/events-v2-migration-script
[5]: /ja/api/latest/events/#query-the-event-stream
[6]: /ja/api/latest/monitors/#create-a-monitor