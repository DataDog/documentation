---
description: デプロイ実行をフィルタリング/グループ化するためのファセットについて説明します。
further_reading:
- link: continuous_delivery/explorer/
  tag: ドキュメント
  text: デプロイをクエリして可視化する方法を学ぶ
title: デプロイ実行ファセット
---

{{< callout url="https://docs.google.com/forms/d/e/1FAIpQLScNhFEUOndGHwBennvUp6-XoA9luTc27XBwtSgXhycBVFM9yA/viewform?usp=sf_link" btn_hidden="false" header="プレビューに参加!" >}}
CD Visibility はプレビュー中です。この機能に興味がある場合は、フォームに入力してアクセスをリクエストしてください。
{{< /callout >}}

## 概要

ファセットは、パイプラインから取得したユーザー定義のタグと属性です。[定性](#qualitative-facets) と [定量](#quantitative-measures) の両方のデータ分析に活用できます。ファセットを使うと、[ダッシュボード][2] や [ノートブック][3] に表示される検索クエリ上で、デプロイを柔軟に操作できます。

[ファセットの作成](#creating-facets) は、[デプロイ実行を検索する][5] うえで **必須ではありません**。オートコンプリートは既存のファセットも利用しますが、受信しているデプロイ実行に一致する入力であれば、ファセットがなくても適用されます。

[Deployment Executions ページ][4] には、`Environment`、`Deployment Status`、`Deployment Provider` など、標準で用意されたファセットが含まれています。CD Visibility Explorer では、ファセットを使って次のことができます:

- [デプロイ実行を検索してフィルタリングする][5]
- デプロイや環境の分析を行う
- デプロイ完了後のトラブルシューティングを開始する

[**Software Delivery** > **CD Visibility** > **Executions**][4] に移動すると、デプロイ実行リストの左側に表示されるファセット一覧にアクセスできます。

{{< img src="/continuous_delivery/explorer/facets.png" text="CD Visibility Explorer の Deployment Executions ページにあるファセット一覧" style="width:100%" >}}

### 定性ファセット

定性ファセットは、次のような場合に使用します:

- **値の相対的な傾向** を把握したい
- **ユニーク値を数えたい**
- 特定の値に対してデプロイ実行を頻繁に **フィルタ** したい
たとえば、環境タグのファセットを使えば、トラブルシューティングの対象を development、staging、production といった環境に絞り込めます。<br>

**注:** タグでフィルタするだけならファセットは必須ではありません。ただし、調査でよく使うタグにファセットを定義しておくと、解決までの時間を短縮できます。

### 定量メジャー

定量メジャーは、次のような場合に使用します:

- 複数のデプロイ実行から値を **集計** したい
- 値の範囲でデプロイ実行を **レンジ フィルタ** したい
- その値でデプロイ実行を **ソート** したい

#### タイプ

メジャーは long (整数) または double (小数) のいずれかの型を取り、どちらの型でも同等の機能を利用できます。

#### 単位

メジャーは、クエリ実行時と表示時に値の桁違いを扱えるよう、単位をサポートしています (秒単位の **time**、バイト単位の **size**)。単位はフィールドの性質ではなく、メジャー自体のプロパティです。

たとえば、ナノ秒で記録される `duration` メジャーを考えます。`env:staging` のデプロイでは `duration:10000000` (10 ミリ秒)、`env:qa` のデプロイでは `duration:5000000` (5 ミリ秒) という値だとします。`duration:>2ms` を使えば、両方の環境にまたがって、同じ条件でデプロイ実行タグをまとめてクエリできます。検索クエリの詳細は [検索構文][6] を参照してください。

## ファセット パネル

検索バーは、データをフィルタリングしたりグループ化したりするための最も多機能な操作手段です。一方で、多くのケースでは、ファセット パネルの方がシンプルにデータをたどれます。ファセットを開くと、現在のクエリ範囲における内容のサマリーが表示されます。

検索バーと URL には、ファセット パネルでの選択内容が自動的に反映されます。

- **Facets (定性)** には、ユニーク値の上位リストと、それぞれに一致するデプロイ実行数が表示されます。
- **Measures (定量)** には、最小値と最大値を示すスライダーが表示されます。スライダーを動かすか数値を入力して、検索クエリの上下限を指定できます。

### ファセットのグルーピング

ファセットは、ファセット リスト内で意味のあるテーマごとにグループ化されています。ファセットにグループを割り当てたり変更したりしても、影響するのはファセット リストの表示だけで、検索や分析には影響しません。

### ファセットのフィルタリング

ファセット パネルの *Search facets* ボックスを使うと、ファセット リスト全体を絞り込み、操作したいファセットへ素早く移動できます。*Search facets* は、ファセットの表示名とフィールド名を使って結果を絞り込みます。

## ファセットの作成

デプロイ実行の属性やタグに対してファセットを作成しなくても、デプロイ実行の検索はできます。ただし、特定のデプロイ実行属性に分かりやすい説明を付けたいときや、属性値を Facets リストに表示したいときにはファセットが役立ちます。

### Deployment Details サイド パネルからファセットを作成する

Deployment Details サイド パネルから作成すると、ファセットの詳細の多くがあらかじめ入力された状態になります。

{{< img src="continuous_delivery/explorer/create_facet.png" alt="Deployment Details サイド パネルからファセットを作成する" style="width:100%;">}}

1. ファセット化したいフィールドを含むデプロイ実行を、[Deployment Executions ページ][4] で開きます。
2. 一覧から対象のデプロイ実行を選択して、Deployment Details サイド パネルを開きます。
3. 目的のフィールドをクリックし、そこからファセットを作成します:

   - フィールドが数値の場合は、ファセットまたはメジャーのどちらでも作成できます。
   - フィールドが文字列の場合は、ファセットのみ作成できます。

### ファセット リストからファセットを作成する

目的のフィールドを持つデプロイ実行を見つけられない場合は、ファセット パネルで **+ Add** をクリックして、ファセットを直接作成します。

{{< img src="continuous_delivery/explorer/add_facet.png" alt="ファセット サイド パネルからファセットを追加する" style="width:30%;">}}

このファセットの元になるフィールド (key) 名を指定します:

- 環境タグにはタグのキー名を使います。
- デプロイ実行の属性には、先頭に `@` を付けた属性パスを使います。

現在のビューに含まれるデプロイ実行の内容をもとに、オートコンプリートが適切なフィールド名の入力を支援します。ただし、ここには基本的に任意の値を指定できます。たとえば、Datadog がまだ該当するデプロイ実行を受信していない場合でも問題ありません。

## 参考資料

{{< partial name="whats-next/whats-next.html" >}}

[1]: /ja/monitors/types/ci
[2]: /ja/dashboards/
[3]: /ja/notebooks/
[4]: https://app.datadoghq.com/ci/deployments/executions
[5]: /ja/continuous_delivery/explorer#deployment-executions
[6]: /ja/continuous_delivery/explorer/search_syntax