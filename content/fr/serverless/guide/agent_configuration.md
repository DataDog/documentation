---
kind: documentation
title: Configuration de l'Agent sans serveur
---

## Présentation

Le [principal fichier de configuration][1] de l'Agent s'intitule `datadog.yaml`. Pour l'Agent sans serveur, les options de ce fichier sont passées via des variables d'environnement. Le nom de ces variables correspond généralement à celui de l'option de configuration correspondante, avec un format snake case en majuscules. Par exemple, utilisez la variable d'environnement `DD_API_KEY` pour définir votre clé d'API Datadog. 

### Configuration de base

| Variable d'environnement                   | Description                                                                                                                                                                                                        |
|--------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| `DD_API_KEY`                   | La variable d'environnement définissant votre clé d'API Datadog en texte brut. **Une** variable d'environnement est requise pour la clé. Voir les [variables d'environnement de la CLI sans serveur][7].                                                                                              |
| `DD_KMS_API_KEY`               | La variable d'environnement définissant votre clé d'API Datadog avec KMS. **Une** variable d'environnement est requise pour la clé. Voir les [variables d'environnement de la CLI sans serveur][7].                                                                        |
| `DD_API_KEY_SECRET_ARN`        | La variable d'environnement définissant votre clé d'API Datadog avec un gestionnaire de secrets. **Une** variable d'environnement est requise pour la clé. Voir les [variables d'environnement de la CLI sans serveur][7].                                                                           |
| `DD_LOG_LEVEL`                 | Définit le niveau du [log de l'Agent Datadog][8].                                                                                                                                                                      |
| `DD_SERVERLESS_FLUSH_STRATEGY` | La stratégie de nettoyage de l'Agent Datadog. Valeurs autorisées : `end` ou `periodically[,millisecondes]`. Par exemple, la variable d'environnement `DD_SERVERLESS_FLUSH_STRATEGY=periodically,100` définit un nettoyage toutes les 100 ms.                                                                                                                  |
| `DD_ENV`                       | Définit le tag `env` global pour toutes les données émises.                                                                                                                                                                |
| `DD_TAGS`                      | Tags de host séparés par des espaces. Exemple : `simple-tag-0 tag-key-1:tag-value-1`.                                                                                                                                  |
| `DD_SITE`                      | Le site auquel vous transmettez vos métriques, traces et logs. Définissez votre site Datadog sur `{{< region-param key="dd_site" >}}`. Valeur par défaut : `datadoghq.com`.                                                                  |
| `DD_DD_URL`                    | Paramètre facultatif pour remplacer l'URL utilisée pour l'envoi de métriques.                                                                                                                                                        |
| `DD_URL`                       | Alias de `DD_DD_URL`. Ignoré si la valeur `DD_DD_URL` est déjà définie.                                                                                                                                                      |
| `DD_TRACE_ENABLED`             | Active la collecte de traces. Valeur par défaut : `true`. Pour en savoir plus sur les variables d'environnement permettant de recueillir des traces.                                                                                       |
| `DD_TAGS`                      | Liste des tags. Ces derniers sont ajoutés dans l'application à chaque métrique, événement, log, trace et check de service émis par cet Agent.                                                                                                         |
| `DD_TAG_VALUE_SPLIT_SEPARATOR` | Sépare les valeurs de tag en fonction d'un séparateur précis. S'applique uniquement aux tags de host, ainsi qu'aux tags provenant des intégrations de conteneur. Cette variable d'environnement n'a aucune incidence sur les tags appliqués aux métriques DogStatsD, ni aux tags recueillis par d'autres intégrations. |
|

### Configuration de la collecte de logs

| Variable d'environnement                                  | Description                                                                                                                                                                                                                          |
|-----------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| `DD_LOGS_ENABLED`                             | Définissez ce paramètre sur `true` pour activer la collecte de logs avec l'Agent Datadog.                                                                                                                                                          |
| `DD_LOGS_CONFIG_LOGS_DD_URL`                       | Définit l'endpoint et le port à utiliser lorsque les logs passent par un proxy. Puisque les logs sont transmis via TCP, le proxy doit être capable de gérer les connexions TCP. La chaîne doit respecter le format `<ENDPOINT>:<PORT>`.                                  |
| `DD_LOGS_CONFIG_LOGS_NO_SSL`                  | Désactive le chiffrement SSL. Utilisez uniquement ce paramètre lorsque des logs sont transmis localement à un proxy. Il est alors fortement recommandé de gérer le chiffrement SSL côté serveur.                                             |
| `DD_LOGS_CONFIG_PROCESSING_RULES`             | Règles globales de traitement qui sont appliquées à l'ensemble des logs. Les règles `exclude_at_match`, `include_at_match` et `mask_sequences` sont disponibles. Pour en savoir plus, consultez la section [Règles globales de traitement][2].                                            |
| `DD_LOGS_CONFIG_FORCE_USE_HTTP`               | Par défaut, l'Agent envoie des logs au sein de lots HTTPS vers le port 443, tant qu'une connectivité HTTPS peut être établie au lancement de l'Agent. Le cas contraire, l'Agent rebascule vers un envoi TCP. Définissez ce paramètre sur `true` pour toujours envoyer vos logs via HTTPS (recommandé). |
| `DD_LOGS_FORCE_USE_TCP`                       | Par défaut, les logs sont envoyés via HTTPS dès que possible. Définissez ce paramètre sur `true` pour toujours les envoyer via TCP. Si `DD_LOGS_CONFIG_FORCE_USE_HTTP` est défini sur `true`, ce paramètre est ignoré.                                                            |
| `DD_LOGS_CONFIG_USE_COMPRESSION`              | Ce paramètre s'applique à l'envoi de logs via HTTPS. Lorsqu'il est défini sur `true`, l'Agent compresse les logs avant de les envoyer.                                                                                                                 |
| `DD_LOGS_CONFIG_COMPRESSION_LEVEL`            | Ce paramètre accepte les valeurs comprises entre `0` (aucune compression) et `9` (compression maximale, mais utilisation plus intensive des ressources). Il s'applique uniquement lorsque le paramètre `DD_LOGS_CONFIG_USE_COMPRESSION` est défini sur `true`.                                                |
| `DD_LOGS_CONFIG_BATCH_WAIT`                   | La durée maximale, en secondes, pendant laquelle l'Agent Datadog attend que les lots de logs se remplissent avant de les envoyer. Valeur par défaut : `5`.                                                                                                                                     |
| `DD_LOGS_CONFIG_OPEN_FILES_LIMIT`             | Le nombre maximum de fichiers pouvant être suivis simultanément. Valeur par défaut : `500`.                                                                                                                                                          |
| `DD_LOGS_CONFIG_FILE_WILDCARD_SELECTION_MODE` | La stratégie définissant les correspondances de wildcard à utiliser en priorité si le nombre de fichiers dépasse la limite.  Valeurs autorisées : `by_name` et `by_modification_time`.                                                                                               |
| `DD_LOGS_CONFIG_LAMBDA_LOGS_TYPE`             | La source des logs à exporter. La valeur doit correspondre à une liste d'éléments `function`, `platform` et `extension` séparés par des espaces. Valeur par défaut : tous les logs.                                                                                                    |

### Configuration APM

| Variable d'environnement              | Description                                                                                                                                                                                                                           |
|---------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| `DD_APM_ENABLED`          | Définissez ce paramètre sur `true` pour activer l'Agent APM. Valeur par défaut : `true`.                                                                                                                                                                                    |
| `DD_APM_ENV`              | Le tag d'environnement appliqué aux traces. Si cette variable n'est pas définie, la valeur est obtenue à partir de `DD_ENV`. Si `DD_ENV` n'est pas défini, la valeur est obtenue à partir du tag `env:` défini dans `DD_TAGS`. |
| `DD_APM_RECEIVER_PORT`    | Le port sur lequel le récepteur de traces effectue son écoute. Définissez ce paramètre sur `0` pour désactiver le récepteur HTTP. Valeur par défaut : `8126`.                                                                                                                               |
| `DD_APM_RECEIVER_SOCKET`  | Accepte les traces via des sockets de domaine Unix. Ce paramètre est désactivé par défaut. Lorsqu'il est défini, il doit pointer vers un fichier de socket valide.                                                                                                                      |
| `DD_APM_DD_URL`           | Définit l'endpoint et le port à utiliser lorsque les traces APM passent par un proxy. La chaîne doit respecter le format `<ENDPOINT>:<PORT>`. Puisque les traces sont transmises via TCP, le proxy doit être capable de gérer les connexions TCP.                                                        |
| `DD_APM_REPLACE_TAGS`     | Définit un ensemble de règles permettant de remplacer ou de supprimer certains tags qui contiennent des [informations potentiellement sensibles][3].                                                                                                                |
| `DD_APM_IGNORE_RESOURCES` | Une liste d'exclusion d'expressions régulières. Chaque trace dont le nom d'une ressource correspond à l'une des expressions est ignorée. Utilisez une liste d'expressions séparées par des virgules et ajoutez des guillemets autour de cette liste. Exemple : `"^foo$", "bar$"`.                                              |
| `DD_APM_LOG_THROTTLING`   | Définissez ce paramètre sur `true` pour limiter à 10 le nombre total d'avertissements et d'erreurs pour chaque intervalle de 10 secondes. Valeur par défaut : `true`.                                                                                                                                                    |

### Configuration réseau avancée

| Variable d'environnement             | Description                                                                                                                                                                                                                                                                              |
|--------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| `DD_SKIP_SSL_VALIDATION` | Définissez cette option sur `true` pour que l'Agent ignore la validation des certificats SSL/TLS. Valeur par défaut : `false`.                                                                                                                                                                                |
| `DD_MIN_TLS_VERSION`     | Cette option définit la version minimale de TSL pour l'envoi de données à l'admission Datadog spécifiée dans `DD_SITE` ou `DD_URL`. Valeurs autorisées : `tlsv1.0`, `tlsv1.1`, `tlsv1.2` ou `tlsv1.3`. Les valeurs ne sont pas sensibles à la casse. Valeur par défaut : `tlsv1.2`. |

### Paramètres de proxy

| Variable d'environnement        | Description                                                       |
|---------------------|-------------------------------------------------------------------|
| `DD_PROXY_HTTP`     | URL HTTP à utiliser comme proxy pour les requêtes `http`.                |
| `DD_PROXY_HTTPS`    | URL HTTPS à utiliser comme proxy pour les requêtes `https`.              |
| `DD_PROXY_NO_PROXY` | Liste d'URL, séparées par des espaces, pour lesquelles aucun proxy ne doit être utilisé. |

Pour en savoir plus sur les paramètres de proxy, consultez la [documentation relative au proxy de l'Agent v6][6].

### DogStatsD (métriques custom)

Envoyez des métriques custom avec le [protocole StatsD][5] :

| Variable d'environnement                                      | Description                                                                                                                                                                                                                                                                                                                                                                                                                                             |
|---------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| `DD_DOGSTATSD_NON_LOCAL_TRAFFIC`                  | Effectue une écoute des paquets DogStatsD issus d'autres conteneurs (requis pour envoyer des métriques custom).                                                                                                                                                                                                                                                                                                                                                                    |
| `DD_DOGSTATSD_SOCKET`                             | Le chemin vers le socket Unix à écouter. Doit être dans le volume `rw` monté.                                                                                                                                                                                                                                                                                                                                                                                 |
| `DD_DOGSTATSD_ORIGIN_DETECTION`                   | Active la détection de conteneurs et le tagging pour les métriques de socket Unix.                                                                                                                                                                                                                                                                                                                                                                                         |
| `DD_DOGSTATSD_TAGS`                               | Une liste de tags supplémentaires séparés par des espaces à ajouter à l'ensemble des métriques, événements et checks de services reçus par ce serveur DogStatsD. Exemple : `"env:golden group:retrievers"`.                                                                                                                                                                                                                                                                                                   |
| `DD_USE_DOGSTATSD`                                | Active ou désactive l'envoi de métriques custom à partir de la bibliothèque DogStatsD.                                                                                                                                                                                                                                                                                                                                                                                    |
| `DD_DOGSTATSD_PORT`                               | Remplace le port DogStatsD de l'Agent.                                                                                                                                                                                                                                                                                                                                                                                                                      |
| `DD_BIND_HOST`                                    | Le host sur lequel DogStatsD et les traces basent leur écoute. Ce paramètre est ignoré par APM lorsque `apm_config.apm_non_local_traffic` est activé, et ignoré par DogStatsD lorsque `dogstatsd_non_local_traffic` est activé. L'Agent de trace envoie des métriques à ce host. <br/> **Remarque** : la valeur par défaut `localhost` n'est pas valable dans les environnements IPv6 pour lesquels DogStatsD effectue son écoute sur `::1`. Pour y remédier, définissez cette valeur sur `127.0.0.1`. |
| `DD_DOGSTATSD_ORIGIN_DETECTION_CLIENT`            | Lorsque ce paramètre est défini sur `true`, l'Agent utilise un ID de conteneur fourni par le client pour enrichir les métriques, événements et checks de service en leur ajoutant des tags de conteneur. <br/> **Remarque** : pour bénéficier de cette fonctionnalité, vous devez utiliser un client compatible avec la version 1.2 du protocole DogStatsD.                                                                                                                                                                                                                                    |
| `DD_DOGSTATSD_BUFFER_SIZE`                        | La taille du buffer, en octets, servant à recevoir les paquets StatsD.                                                                                                                                                                                                                                                                                                                                                                                                |
| `DD_DOGSTATSD_STATS_ENABLE`                       | Publie les statistiques internes de DogStatsD sous forme d'expvar Go.                                                                                                                                                                                                                                                                                                                                                                                                       |
| `DD_DOGSTATSD_QUEUE_SIZE`                         | Configure la taille de la file d'attente interne du serveur DogStatsD. Toute réduction de la taille de cette file d'attente réduit la consommation en mémoire maximale du serveur DogStatsD, mais augmente également le nombre de paquets ignorés.                                                                                                                                                                                                                               |
| `DD_DOGSTATSD_STATS_BUFFER`                       | Définit le nombre d'éléments figurant dans le buffer circulaire de statistiques DogStatsD.                                                                                                                                                                                                                                                                                                                                                                                  |
| `DD_DOGSTATSD_STATS_PORT`                         | Le port du serveur expvar Go.                                                                                                                                                                                                                                                                                                                                                                                                                      |
| `DD_DOGSTATSD_SO_RCVBUF`                          | **Systèmes POSIX uniquement** : définit le nombre d'octets alloués au buffer de réception de socket DogStatsD. Par défaut, le système d'exploitation définit cette valeur. Cette variable vous permet d'augmenter la taille du buffer, sans avoir à modifier la valeur par défaut du système d'exploitation. La valeur maximale acceptée dépend du système d'exploitation.                                                                                                                   |
| `DD_DOGSTATSD_METRICS_STATS_ENABLE`               | Lorsque ce paramètre est défini sur `true`, DogStatsD recueille des statistiques de base (nombre et date de dernière détection) à propos des métriques traitées. Exécutez la commande de l'Agent `dogstatsd-stats` pour consulter ces statistiques.                                                                                                                                                                                                                                                         |
| `DD_DOGSTATSD_NO_AGGREGATION_PIPELINE`            | Active le pipeline sans agrégation dans DogStatsD. Ce pipeline reçoit des métriques avec un timestamp et les transmis à l'admission sans aucun traitement supplémentaire (à part le tagging).                                                                                                                                                                                                                                                                             |
| `DD_DOGSTATSD_NO_AGGREGATION_PIPELINE_BATCH_SIZE` | Le nombre maximal de métriques dans les charges utiles envoyées par le pipeline sans agrégation à l'admission.                                                                                                                                                                                                                                                                                                                                                                 |
| `DD_STATSD_FORWARD_HOST`                          | Transmet chaque paquet reçu par le serveur DogStatsD et envoyé par un autre serveur StatsD. Vérifiez que les paquets transmis constituent bien des paquets StatsD standard, et **non** des paquets DogStatsD : en effet, il est possible que l'autre serveur StatsD ne gère par ce type de paquet.                                                                                                                                                                                                                  |
| `DD_STATSD_FORWARD_PORT`                          | Le port auquel transmettre les paquets StatsD.                                                                                                                                                                                                                                                                                                                                                                                          |
| `DD_STATSD_METRIC_NAMESPACE`                      | Définit un espace de nommage pour toutes les métriques StatsD provenant de ce host. Un préfixe correspondant à l'espace de nommage est ajouté au nom de chaque métrique reçue, avant son envoi à Datadog.                                                                                                                                                                                                                                                                                                          |

[1]: https://github.com/DataDog/datadog-agent/blob/main/pkg/config/config_template.yaml

[2]: https://docs.datadoghq.com/fr/agent/logs/advanced_log_collection/#global-processing-rules

[3]: https://docs.datadoghq.com/fr/tracing/setup_overview/configure_data_security/#replace-rules-for-tag-filtering

[4]: https://docs.datadoghq.com/fr/tracing/troubleshooting/agent_rate_limits/#max-connection-limit

[5]: /fr/developers/dogstatsd/

[6]: /fr/agent/configuration/proxy/#agent-v6

[7]: /fr/serverless/libraries_integrations/cli/#environment-variables

[8]: /fr/agent/troubleshooting/debug_mode/?tab=agentv6v7#agent-log-level