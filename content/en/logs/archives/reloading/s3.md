---
title: Log Archive Reloading
kind: documentation
private: true
beta: true
aliases:
  - /guides/archive_reloading
further_reading:
- link: "logs/explorer"
  tag: "Documentation"
  text: "See how to explore your logs"
- link: "logs/archives/s3"
  tag: "Documentation"
  text: "Learn how to create an S3 log archive"
---

<div class="alert alert-warning">
This feature is in private beta. Request early access by emailing support@datadoghq.com. Reloading is currently only supported for AWS S3 Archives, and for Datadog users of the Datadog US site.
</div>

Once you are [archiving the logs you manage in Datadog to your own S3 bucket][1], you can reload logs from your archives back into your Datadog account when you need them. This is especially useful if you wish to query or analize log data that is either (A) very old, or (B) had been excluded from indexing when it was originally sent to your Datadog account. Reloaded logs become avialable in your Log Explorer, and all its features--including search, patterns, and analytics--are available on reloaded log events just as if they were fresh, new log events. 

You can reload logs from specific time ranges and query filters to meet specific needs. This document shows you how to configure and use this feature. 

## Configuration

In order to reload log events from your archives, Datadog uses the IAM Role in your AWS account that you configured for [your AWS integration][2]. If you have not yet created that Role, [follow these steps to do so][3]. To allow that Role to reload log events from your archives, add the following permission statement to its IAM policies (be sure to edit the bucket names and, if desired, specify the paths that contain your log archives):

```
{
    "Version": "2012-10-17",
    "Statement": [
        {
            "Sid": "DatadogUploadLogArchives",
            "Effect": "Allow",
            "Action": [
                "s3:PutObject"
            ],
            "Resource": [
                "arn:aws:s3:::<MY_BUCKET_NAME_1_/_MY_OPTIONAL_BUCKET_PATH_1>/*",
                "arn:aws:s3:::<MY_BUCKET_NAME_2_/_MY_OPTIONAL_BUCKET_PATH_2>/*"
            ]
        },
        {
            "Sid": "DatadogReloadLogArchivesListBucket",
            "Effect": "Allow",
            "Action": "s3:ListBucket",
            "Resource": [
                "arn:aws:s3:::<MY_BUCKET_NAME_1>",
                "arn:aws:s3:::<MY_BUCKET_NAME_2>"
            ]
        },
        {
            "Sid": "DatadogReloadLogArchivesGetObject",
            "Effect": "Allow",
            "Action": "s3:GetObject",
            "Resource": [
                "arn:aws:s3:::<MY_BUCKET_NAME_1_/_MY_OPTIONAL_BUCKET_PATH_1>/*",
                "arn:aws:s3:::<MY_BUCKET_NAME_2_/_MY_OPTIONAL_BUCKET_PATH_2>/*"
            ]
        }
    ]
}
```

## Updating Legacy S3 Archives for Reloading

Originally, Datadog's AWS S3 archiving feature depended on your S3 bucket policy to grant appropriate write access to your S3 bucket (this is the industry standard for S3 log archival). But for added scurity, Datadog now writes to your AWS S3 log archives using the IAM Role in your AWS account that you configured for [your AWS integration][2]. 

Datadog only supports reloading from archives that have been configured to use role delegation. Once you have modified your Datadog IAM role to include the IAM policy above, simply edit your archive in the Log Configuration page, select which AWS Account + Role combination you wish to write and reload your archives, and then save your archive. 

## Starting an Archive Reload Job

To start reloading log events from your S3 archives, go to the [Historical Views tab][4] of the [Logs Configuration page][5] in your Datadog account. Select [the "Reload from Archives" button][6]. 

{{< img src="logs/archives/log_historical_views.png" alt="Reload from Archives" responsive="true" style="width:75%;">}}

Complete the reload form and select "Reload from Archives" to initiate the reload job. The reloaded results will go to their own special index called a "Historical View" and will have all existing facets applied. If you wish to reload from an archive that no longer exists, [follow these instructions to create that archive again][1].

{{< img src="logs/archives/log_reload_from_archives.png" alt="Reload from Archives" responsive="true" style="width:75%;">}}

Once you have started a reload job, the job will appear as "pending" in [the Historical Views tab][4]. When it completes it will appear as "active" and will link you to the log explorer where you can find the reloaded log events.

How long a reload job takes to completed depends on the volume of data that exists in the archive for the time-range queried on, and on the count of log events that match the reload query. Reloads over large archives or large time periods can take hours to complete.

## Private Beta Limitations

While Archive Reloading is in private beta, the following limitations apply:

1. You can only reload up to 300 Million log events with one reload job.
2. You can only reload archived content that is older than 24 hours. 

## Reload Query Rules

Reload query filters can include any of the following arguments:

* `service`
* `source`
* `status`
* `host`
* any attribute beginning with `@`
* raw-text searches (which are applied on the `message` attribute)

The following rules currently apply to what reload queries are supported:

1. Reloading by tags is not yet supported.
2. Use of wildcards is supported.
3. Special characters (`+ - = && || > < ! ( ) { } [ ] ^ " ~ * ? : \ /`) [must be properly escaped][7].
4. Querying by `service` is required.

### Reload Query Examples

For example, the following reload query will reload all log events from the "foo" and "bar" services whose `http.url_details.path` attribute includes the string "my/endpoint" and whose message includes the string "GET":

`service:(foo OR bar) @http.url_details.path:*my\/endpoint* GET`

The following reload queries are not currently supported:

* `@http.url_details.path:*my\/endpoint* GET` <br>(missing `service` argument)
* `service:(foo OR bar) env:prod @http.url_details.path:*my\/endpoint* GET` <br>(uses a tag, `env`, or else does not properly escape `:` in the raw text search for `env:prod`, <br>should be `env\:prod` or `"env:prod"`)
* `service:(foo OR bar) GET http://myapp:1234/users` <br>(does not properly escape the `:` and `/` characters in the raw text search for `GET http://myapp:1234/users`, <br>should be `GET http\:\/\/myapp\:1234\/users` or `"GET http://myapp:1234/users"`)

## Historical View Names

The following rules currently apply to how you can name historical views: 

1. names must start with a lower-case letter
2. names can only contain lower-case alpha-numerical characters or the "-" character
3. names must be unique (including formerly deleted views)

## Using Historical Views

Once a reload job is completed, you can find and use the reloaded content in the Log Explorer exactly as you can all your other indexed log content. You can select your Historical View from the index selector, and you can use the time range selector to expand to the relevant time-frame. The Logs Search, Patterns, and Analytics features are all fully functional on reloaded content for in-depth investigations. 

## Deleting Historical Views

When you are finished with your reloaded log content and no longer wish to retain it in hot storage in your Datadog account, you can schedule it for deletion, which will occur 24 hours later. To do this, go to [the Historical Views tab][4], hover over a historical view and select and confirm its deletion from the trash can icon on the far right. If you or a teammate wish to unschedule this Historical View from deletion, they have 24 hours to do so by selecting the "undo" icon at the far-right of the historical view. 

{{< img src="logs/archives/log_archive_reload_deletion.gif" alt="Delete Reloaded Content" responsive="true" style="width:75%;">}}

## Further Reading

{{< partial name="whats-next/whats-next.html" >}}

[1]: /logs/archives/s3
[2]: https://app.datadoghq.com/account/settings#integrations/amazon-web-services
[3]: /integrations/amazon_web_services/?tab=allpermissions#installation
[4]: /logs/pipelines/historical-views
[5]: /logs/pipelines
[6]: /logs/pipelines/historical-views/add
[7]: /logs/explorer/search/#escaping-of-special-characters
