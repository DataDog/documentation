---
title: Go Tests
code_lang: go
type: multi-code-lang
code_lang_weight: 60
aliases:
  - /continuous_integration/setup_tests/go
  - /continuous_integration/tests/go
  - /continuous_integration/tests/setup/go
further_reading:
    - link: "/continuous_integration/tests/containers/"
      tag: "Documentation"
      text: "Forwarding Environment Variables for Tests in Containers"
    - link: "/continuous_integration/tests"
      tag: "Documentation"
      text: "Explore Test Results and Performance"
    - link: "/tests/test_impact_analysis/go"
      tag: "Documentation"
      text: "Speed up your test jobs with Test Impact Analysis"
    - link: "/continuous_integration/troubleshooting/"
      tag: "Documentation"
      text: "Troubleshooting CI Visibility"
---

{{< site-region region="gov" >}}
<div class="alert alert-warning">Test Optimization is not available in the selected site ({{< region-param key="dd_site_name" >}}) at this time.</div>
{{< /site-region >}}

{{< callout url="#" btn_hidden="true" header="Join the Preview!" >}}
Test optimization for Go is in Preview.
{{< /callout >}}

## Compatibility

Supported test frameworks:

- `testing` package

## Configuring reporting method

To report test results to Datadog, you need to configure the Datadog Go library:

{{< tabs >}}

{{% tab "Cloud CI Provider" %}}
{{% ci-agentless %}}
{{% /tab %}}

{{% tab "On-Premises CI Provider" %}}
{{% ci-agent %}}
{{% /tab %}}

{{< /tabs >}}

## Installing Orchestrion

Orchestrion is a tool to process Go source code at compilation time and automatically insert instrumentation using `dd-trace-go`.

Install `orchestrion` from [https://github.com/datadog/orchestrion][1] using the command:

```bash
$ go install github.com/DataDog/orchestrion@latest
```

  - <details><summary>Optional: project <tt>go.mod</tt> registration</summary>

    >  You can automatically add `orchestrion` to your project's dependencies by running:
    > ```bash
    > $ orchestrion pin
    > ```
    > This command has the following effects:
    > 1. Create a new `orchestrion.tool.go` file containing content similar to:
    >     ```go
    >     // Code generated by `orchestrion pin`; DO NOT EDIT.
    >
    >     // This file is generated by `orchestrion pin`, and is used to include a blank import of the
    >     // orchestrion package(s) so that `go mod tidy` does not remove the requirements rom go.mod.
    >     // This file should be checked into source control.
    >
    >     //go:build tools
    >
    >     package tools
    >
    >     import _ "github.com/DataDog/orchestrion"
    >     ```
    > 2. Run `go get github.com/DataDog/orchstrion@<current-release>` to make sure the project version corresponds to the
    >    one currently being used
    > 3. Run `go mod tidy` to make sure your `go.mod` and `go.sum` files are up-to-date
    >
    > If you do not run this command, it is done automatically when required. Once done, the version of `orchestrion`
    > used by this project can be controlled directly using the `go.mod` file, as you would control any other dependency.
    </details>


Orchestrion supports the two latest releases of Go, matching Go's [official release policy][go-releases]. It may
function correctly with older Go releases, but Datadog cannot support older releases that do not work.

In addition to this, Orchestrion only supports projects using [Go modules][go-modules].

[go-releases]: https://go.dev/doc/devel/release#policy
[go-modules]: https://pkg.go.dev/cmd/go#hdr-Modules__module_versions__and_more

## Instrumenting tests

Set the following environment variables to configure the library:

`DD_CIVISIBILITY_ENABLED=true` (Required)
: Enables the Test Optimization product.

`DD_ENV` (Required)
: Environment where the tests are being run (for example: `local` when running tests on a developer workstation or `ci` when running them on a CI provider).

Prefix your go test command with `orchestrion`:

```bash
$ orchestrion go test -race ./...
```

If you have not run `orchestrion pin`, you may see a message similar to the following appear, as `orchestrion pin` is automatically executed:

```
  ╭──────────────────────────────────────────────────────────────────────────────╮
  │                                                                              │
  │  Warning: github.com/DataDog/orchestrion is not present in your go.mod       │
  │  file.                                                                       │
  │  In order to ensure build reliability and reproductibility, orchestrion      │
  │  will now add itself in your go.mod file by:                                 │
  │                                                                              │
  │      1. creating a new file named orchestrion.tool.go                        │
  │      2. running go get github.com/DataDog/orchestrion@v0.9.4                 │
  │      3. running go mod tidy                                                  │
  │                                                                              │
  │  You should commit the resulting changes into your source control system.    │
  │                                                                              │
  ╰──────────────────────────────────────────────────────────────────────────────╯
```

### Alternative

_Orchestrion_ at the core is a standard Go toolchain `-toolexec` proxy. Instead of using `orchestrion go`, you can
also manually provide the `-toolexec` argument to `go` commands that accept it:

```console
$ go build -toolexec 'orchestrion toolexec' .
$ go test -toolexec 'orchestrion toolexec' -race .
```

[1]: https://github.com/datadog/orchestrion

## Further reading
{{< partial name="whats-next/whats-next.html" >}}
