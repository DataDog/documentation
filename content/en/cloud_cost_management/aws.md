---
title: AWS
kind: documentation
further_reading:
- link: "/cloud_cost_management/"
  tag: "Documentation"
  text: "Cloud Cost Management"
- link: "/cloud_cost_management/azure"
  tag: "Documentation"
  text: "Gain insights into your Azure bill"
- link: "/cloud_cost_management/google_cloud"
  tag: "Documentation"
  text: "Gain insights into your Google Cloud bill"
---

{{< site-region region="gov" >}}
<div class="alert alert-warning">Cloud Cost Management is not supported for this site.</div>
{{< /site-region >}}

## Overview

To set up Cloud Cost Management in Datadog, you should:
1. Have an AWS account with billing access
2. Have the AWS integration installed in Datadog
3. Follow the steps below to create a Cost and Usage report

## Setup

### Prerequisite: generate a Cost and Usage Report

[Create a Cost and Usage Report][1] in AWS under the **Legacy Pages** section. At this time, there is no support for creating Cost and Usage Report data exports.

Select the following content options:

* **Include resource IDs**
* **Split cost allocation data** (Enables ECS Cost Allocation. You must also opt in to [AWS Split Cost Allocation][10] in Cost Explorer preferences).
* **"Refresh automatically"**

Select the following Delivery options:

* Time granularity: **Hourly**
* Report versioning: **Create new report version**
* Compression type: **GZIP** or **Parquet**
* Format: `text/csv` or `Parquet`

### Configure the AWS integration

Navigate to [Setup & Configuration][7] and select an AWS account from the dropdown menu to pull costs from.

**Note**: Datadog recommends sending a Cost and Usage Report from an [AWS **management account**][2] for cost visibility into related **member accounts**. If you send a Cost and Usage report from an AWS **member account**, ensure that you have selected the following options in your **management account's** [preferences][3]:

* **Linked Account Access**
* **Linked Account Refunds and Credits**
* **Linked Account Discounts**

This ensures complete cost accuracy by allowing periodic cost calculations against the AWS Cost Explorer.

### Locate the Cost and Usage Report

If you have navigated away from the report that you created in the setup prerequisites section, follow AWS documentation to find and [view your Cost and Usage Reports details][4].

To enable Datadog to locate the Cost and Usage Report, complete the fields with their corresponding details:

* **Region**: This is the region your bucket is located. For example, `us-east-1`.
* **Bucket Name**: This is the name of the s3 bucket that the CUR is saved to.
* **Report Path Prefix**: This is the folder name. If viewing **Report path prefix** from the AWS details page, this is the first section of the path. For example, if **Report path prefix** is displayed as `cur-report-dir/cost-report`, you would enter `cur-report-dir`.
* **Report Name**: This is the name you entered when you generated the report in the prerequisite section. If viewing the **Report path prefix** from the AWS details page, this is the second half of the path. For example, if **Report path prefix** is displayed as `cur-report-dir/cost-report`, you would enter `cost-report`.

**Note**: Datadog only supports CURs generated by AWS. Do not modify or move the files generated by AWS, or attempt to provide access to files generated by a 3rd party.

### Configure access to the Cost and Usage Report

Configure AWS to ensure Datadog has permissions to access the CUR and the s3 bucket it is stored in by [creating a policy][5] using the following JSON:

{{< code-block lang="yaml" collapsible="true" >}}
{
  "Version": "2012-10-17",
  "Statement": [
      {
          "Sid": "DDCloudCostReadBucket",
          "Effect": "Allow",
          "Action": [
              "s3:ListBucket"
          ],
          "Resource": "arn:aws:s3:::BUCKETNAME"
      },
      {
          "Sid": "DDCloudCostGetBill",
          "Effect": "Allow",
          "Action": [
              "s3:GetObject"
          ],
          "Resource": "arn:aws:s3:::BUCKETNAME/REPORT_PREFIX/REPORT_NAME/*"
      },
      {
          "Sid": "DDCloudCostCheckAccuracy",
          "Effect": "Allow",
          "Action": [
              "ce:Get*"
          ],
          "Resource": "*"
      },
      {
          "Sid": "DDCloudCostListCURs",
          "Action": [
              "cur:DescribeReportDefinitions"
          ],
          "Effect": "Allow",
          "Resource": "*"
      },
      {
          "Sid": "DDCloudCostListOrganizations",
          "Action": [
              "organizations:Describe*",
              "organizations:List*"
          ],
          "Effect": "Allow",
          "Resource": "*"
      }
  ]
}
{{< /code-block >}}

**Tip:** Make note of the name you created for this policy for next steps.

### Attach the policy to the Datadog integration role

Attach the new S3 policy to the Datadog integration role.

1. Navigate to **Roles** in the AWS IAM console.
2. Locate the role used by the Datadog integration. By default it is named **DatadogIntegrationRole**, but the name may vary if your organization has renamed it. Click the role name to open the role summary page.
3. Click **Attach policies**.
4. Enter the name of the S3 bucket policy created above.
5. Click **Attach policy**.

**Note:** Data can take up to 48 to 72 hours after setup to stabilize in Datadog.

## Cost types

Visualize your ingested data using out of the box cost types. Datadog's cloud cost metric names contain various terms that describe how they are calculated.

### Amortized vs. unblended costs
**Amortized** cost metrics, distribute pre-payments (like up-front savings plans fees) across the entire discount term (accrual basis). As savings plans are applied to covered usage, the costs for that savings plan appear as usage charges. The unused portion appears on the accrual date. As a caveat of AWS reporting, the unused portion of an RI Fee always appears on the first of the month (i.e. this type of fee is not amortized across the billing period).

**Unblended** cost metrics show all charges on the date that they were incurred (cash basis). These metrics match the AWS invoice exactly.

### Net costs
**Net** costs apply private discounts directly to usage. The cost for a specific resource or tag represents the actual effective cost after all savings are realized.

If you have private discounts and you're not using a `net` metric, those discounts will show as separate, negative-valued line items with no tags. Rather than attributing the costs to actual usage, they are treated as global discounts.

### Shared resources allocated
Metrics with the suffix `.shared.resources.allocated` include additional Datadog-powered [container cost allocation][11]. These metrics contain all of the same costs as the AWS metric, but with additional breakdowns and insights for container workloads.

### Cost metrics summary

In general:
- `aws.cost.net.amortized.shared.resources.allocated` provides the most complete cost allocation for specific workloads and teams.
- If you do not have container cost allocation, use `aws.cost.net.amortized`.
- If you do not have net amortized costs, use `aws.cost.amortized.shared.resources.allocated` or `aws.cost.amortized`.

| Metric               | Description           |
| -------------------- | --------------------- |
| `aws.cost.net.amortized.shared.resources.allocated` | All of your AWS net amortized costs, with additional breakdown and insights for container workloads. Requires [container cost allocation][11].|
| `aws.cost.net.amortized` | Net amortized costs (accrual basis), without container cost breakdowns. |
| `aws.cost.net.unblended` | Net unblended costs (cash basis). Matches the AWS invoice, with specialized discounts pre-calculated within usage costs. |
| `aws.cost.amortized.shared.resources.allocated` | All of your AWS amortized costs, with additional breakdown and insights for container workloads. Requires [container cost allocation][11].|
| `aws.cost.amortized` | Amortized costs (accrual basis), without container cost breakdowns. |
| `aws.cost.unblended` | Unblended costs (cash basis). Matches the AWS invoice. |
| `aws.cost.ondemand`  | Costs based on the list rate provided by AWS, excluding all savings plans, reservations, discounts, taxes, and fees. |

## Tag enrichment

Datadog adds tags to the ingested cost data using many sources, described in detail below.

- Cost and Usage Report columns
- AWS Resource Tags
- AWS Account Tags
- AWS Integration Tags
- Out of the Box Tags
- Container workload tags
- Tag pipelines

### Cost and Usage Report Columns

All string-valued columns from the AWS [Cost and Usage Report (CUR)][6] are added as tags on cost metrics.

To ensure consistency, Datadog normalizes tag keys using underscores and lower case. For example, the CUR column `lineItem/resourceId` maps to the tag key `line_item/resource_id`. Tag values are generally unmodified - maintaining exact casing and most special characters.

**Examples:**

|CUR Column|CUR Value|Cloud Cost Tag|
|---|---|---|
|lineItem/resourceId|i-02261970f1b34be4f|line_item/resource_id:i-02261970f1b34be4f|
|product/region|us-east-1|product/region:us-east-1|
|product/usagetype|DataTransfer-Regional-Bytes|product/usagetype:DataTransfer-Regional-Bytes|

### AWS Resource Tags

AWS resource tags are [user-defined tags][12] that appear in the AWS console when viewing a particular resource, like an EC2 instance or S3 bucket.

When the Datadog AWS integration is enabled, Datadog automatically collects resource tags for most AWS resources. These tags are applied to all costs found in the CUR for a given resource.

If the AWS integration is not enabled, you can enable resource tag enrichment by activating [cost allocation tags][13] in AWS billing. This feature allows you to select a subset of resource tag keys to include as columns in the AWS CUR.

### AWS Account Tags
AWS Organizations supports [user-defined tags][14] on organizational units and accounts. Datadog automatically fetches and applies these tags to cost data associated with those accounts.

_Requires the Datadog AWS Integration on the tagged accounts._

### AWS Integration Tags

These are tags set on the AWS Integration tile in the Datadog integrations page. They are applied to all costs found in the CUR for the associated AWS account.

### Out of the Box Tags
Datadog adds out-of-the-box tags to ingested cost data to help you further break down and allocate your costs. These tags are derived from your [Cost and Usage Report (CUR)][6] and make it easier to discover and understand cost data.

The following out-of-the-box tags are available for filtering and grouping data:

| Tag                          | Description       |
| ---------------------------- | ----------------- |
| `aws_product`                | The AWS service being billed.|
| `aws_product_family`         | The category for the AWS service being billed (for example, Compute or Storage).|
| `aws_management_account_name`| The AWS management account name associated with the item.|
| `aws_management_account_id`  | The AWS management account ID associated with the item.|
| `aws_member_account_name`    | The AWS member account name associated with the item.|
| `aws_member_account_id`      | The AWS member account ID associated with the item.|
| `aws_cost_type`              | The type of charge covered by this item (for example, Usage, or Tax).|
| `aws_pricing_term`           | Whether the usage is Reserved, Spot, or On-Demand.|
| `aws_reservation_arn`        | The ARN of the Reserved Instance that the item benefited from.|
| `aws_savings_plan_arn`       | The ARN of the Savings Plan the item benefited from.|
| `aws_usage_type`             | The usage details of the item (for example, BoxUsage:i3.8xlarge).|
| `aws_operation`              | The operation associated with the item (for example, RunInstances).|
| `aws_region`                 | The region associated with the item.|
| `aws_availability_zone`      | The availability zone associated with the item.|
| `aws_resource_id`            | The resource ID associated with the item.|
| `aws_instance_type`          | The instance types associated with your items.|
| `aws_instance_family`        | The instance family associated with your item (for example, Storage optimized).|
| `is_aws_ec2_compute`         | Whether the usage is related to EC2 compute.|
| `is_aws_ec2_compute_on_demand`| Whether the usage is on-demand.|
| `is_aws_ec2_compute_reservation`| Whether the usage is associated with a Reserved Instance.|
| `is_aws_ec2_capacity_reservation`| Whether the usage is associated with a Capacity Reservation.|
| `is_aws_ec2_spot_instance`   | Whether the usage is associated with a Spot Instance.|
| `is_aws_ec2_savings_plan`    | Whether the usage is associated with a Savings Plan.|

#### Cost and observability correlation

Viewing costs in context of observability data is important to understand how infrastructure changes impact costs, identify why costs change, and optimize infrastructure for both costs and performance. Datadog updates resource identifying tags on cost data for top AWS products to simplify correlating observability and cost metrics. 

For example, to view cost and utilization for each RDS database, you can make a table with `aws.cost.amortized`, `aws.rds.cpuutilization`, and `aws.rds.freeable_memory` (or any other RDS metric) and group by `dbinstanceidentifier`. Or, to see Lambda usage and costs side by side, you can graph `aws.lambda.concurrent_executions` and `aws.cost.amortized` grouped by `functionname`.

The following out-of-the-box tags are available:
| AWS Product                  | Tag       |
| ---------------------------- | ----------------- |
| ec2                | `instance_id`|
| s3         | `bucketname`|
| rds         | `dbinstanceidentifier`|
| lambda         | `functionname`|
| dynamodb         | `tablename`|
| elasticache      | `cacheclusterid`|
| cloudfront (distribution)  | `distributionid`|
| cloudfront (function)  | `functionname`|
| ec2 natgateway | `natgatewayid`|
| redshift         | `clusteridentifier`|
| kinesis         | `streamname`|
| queue         | `queuename`|
| sns         | `topicname`|
| elb (application, gateway, network) | `loadbalancer`|
| elb (all other costs) | `loadbalancername` |

For tags on containerized environments, see [Container Cost Allocation][11].

### Container Orchestrators

With container cost allocation, tags are added from the workloads incurring the cost. This includes tags from Kubernetes pods and nodes and ECS tasks and containers.

_Requires [container cost allocation][11]._

### Tag Pipelines

Finally, all of your [tag pipeline][15] rulesets are applied, providing complete cost allocation when infrastructure tagging is not possible.

## Billing conductor
Billing conductor enables you to simplify your bill by customizing the billing rates, distributing credits and fees, and sharing overhead costs at your discretion. You can also select which accounts to include in the CUR.

To create a billing conductor CUR, follow the [AWS Cost and Usage Reports user guide][8]. Ensure the CUR meets [Datadog's requirements][9].
After the billing conductor CUR is created, follow the Cloud Cost Management instructions above to set it up in Datadog.

## Further reading
{{< partial name="whats-next/whats-next.html" >}}

[1]: https://docs.aws.amazon.com/cur/latest/userguide/cur-create.html
[2]: https://docs.aws.amazon.com/awsaccountbilling/latest/aboutv2/consolidated-billing.html
[3]: https://us-east-1.console.aws.amazon.com/cost-management/home?region=us-east-1#/settings
[4]: https://docs.aws.amazon.com/cur/latest/userguide/view-cur.html
[5]: https://docs.aws.amazon.com/IAM/latest/UserGuide/access_policies_create-console.html
[6]: https://docs.aws.amazon.com/cur/latest/userguide/data-dictionary.html
[7]: https://app.datadoghq.com/cost/setup
[8]: https://docs.aws.amazon.com/cur/latest/userguide/cur-data-view.html
[9]: https://docs.datadoghq.com/cloud_cost_management/?tab=aws#prerequisite-generate-a-cost-and-usage-report
[10]: https://docs.aws.amazon.com/cur/latest/userguide/enabling-split-cost-allocation-data.html
[11]: https://docs.datadoghq.com/cloud_cost_management/container_cost_allocation/#tags
[12]: https://docs.aws.amazon.com/tag-editor/latest/userguide/tagging.html
[13]: https://docs.aws.amazon.com/awsaccountbilling/latest/aboutv2/activating-tags.html
[14]: https://docs.aws.amazon.com/organizations/latest/userguide/orgs_tagging.html
[15]: https://docs.datadoghq.com/cloud_cost_management/tag_pipelines
