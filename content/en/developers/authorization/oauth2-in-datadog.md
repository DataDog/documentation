---
title: OAuth2 in Datadog
kind: documentation
---

## Overview

### Clients
An OAuth2 client is the component of an application that enables users to authorize the application access to Datadog resources on the user's behalf. OAuth2 defines two types of clients: public clients and confidential clients. 

Public clients are typically used for browser-based applications and are not capable of storing confidential information. Examples of public clients include OAuth clients for [Datadog Apps][3]. [Confidential clients][4] have the ability to store sensitive data and require an additional `client_secret` to make authorization requests. OAuth clients for data integrations are confidential clients. 

### Client credentials
When you create an OAuth client, a set of client credentials is issued in the form of a Client ID, and optionally, a Client Secret for confidential clients. The Client ID is used to identify your client when making requests to the authorization and token endpoints. The Client Secret, if issued, is used to authenticate the client when making requests to the authorization endpoints. The Client Secret should be immediately copied and stored securely as it is a confidential password exposed only once upon client creation. 

## OAuth Protocol
Outlined below is a step-by-step overview of what your application needs to do in order to implement the OAuth protocol end-to-end once your **confidential** client is created. For more information on client creation and publishing, see the [integration-specific OAuth documentation][5].

1. Create and configure your OAuth client

2. After a user installs your integration, they’ll see a button that says “Connect Accounts” under the Configure tab on the integration tile. When the user clicks this button, they are taken to the `onboarding_url` that you provided as a part of the OAuth client creation process. This page should be the sign-in page for your platform.

3. After the user signs in, redirect them to the [Datadog authorize endpoint][6] with the appropriate url parameters, which includes the added `code_challenge` parameter generated by your application (see [PKCE](###PKCE) for how to derive the  `code_challenge`).
    
    - **Note**: your application must save the `code_verifier` for the token request in step 5.

    - In order to build this URL, you should use the `site` query parameter that will be provided on the redirect to your `onboarding_url`. The format of the domain should match the below format. The `authorize` path can then be appended to this constructed URL:

        `https://{<custom_subdomain>,app,us3,us5}.{datadoghq,ddog-gov}.{com,eu}`


4. Once the user clicks Authorize on this page, a POST request is automatically made by Datadog to the authorize endpoint. The user is then redirected to the `redirect_uri` that you provided during OAuth Client creation with the authorization `code` parameter in the query component.

5. From the `redirect_uri`, make a POST request to the Datadog token endpoint that includes the authorization code from step 4, the `code_verifier` from step 3, and your OAuth client ID and secret.

    - In order to build this URL, you should use the `site` query parameter that will be provided on the redirect to your `redirect_uri`. The format of the domain should match the below format. The `token` path can then be appended to this constructed URL.

        `https://{<custom_subdomain>,app,us3,us5}.{datadoghq,ddog-gov}.{com,eu}`


6. Upon success, you receive your `access_token` and `refresh_token` in the response body. Your application should then display a confirmation page with the message: “You may now close this tab”.

7. You can now use the `access_token` to make calls to Datadog API endpoints by sending it in as a part of the authorization header of your request:

    ```headers = {"Authorization": "Bearer {}".format(access_token)}```

8. Be sure to call the [API Key Creation Endpoint][7] to generate an API key that will allow you to send data in on behalf of Datadog users.

    Note: If the `API_KEYS_WRITE` scope has not been added to your client, this step will fail.

    This endpoint generates an API Key that is only shown once. **Please ensure that you store this value in a secure database or location**.

**Note**: It's recommended to surface error messages on your UI if errors arise from these endpoints at any point in the flow. 

### Kicking off authorization from a third-party location 
Users can kick off authorization from within Datadog, by going to the integration tile and clicking "Connect Accounts", but they can also kick off authorization from the integration's external website if desired. For example, if there's an integration configuration page on your website that Datadog users will use, you can give users the option to kick off authorization from there as well.

When kicking off authorization from a third-party location (anywhere outside of the Datadog integration tile), the Datadog site (i.e. EU, US1, US3, or US5) must be taken into account when routing them through the authorization flow and building out the URL for the `authorization` and `token` endpoints. To ensure that users are authorizing in their correct site, always direct users to the US1 Datadog site (app.datadoghq.com), and from there the user will have a choice to select their region. After the site is selected, ensure that all followup API calls use the selected site.


## Authorization Code Grant Flow With PKCE
### Overview
While the OAuth2 protocol supports several grant flows, the [authorization code grant flow][8] with [PKCE](###PKCE) is the recommended grant type for long-running applications in which a user grants explicit consent once and client credentials can be securely stored. This grant type allows applications to securely obtain a unique authorization code and exchange it for an access token that enables them to make requests to Datadog APIs.

The authorization code grant flow consists of three main steps:

1. The application [requests authorization from a user][6] to access a set of Datadog scopes

2. When a user clicks authorize, the application [obtains a unique authorization code][12]

3. The application [exchanges the authorization code for an access token][10], which is used to access Datadog APIs

### PKCE
[Proof key for code exchange (PKCE)][11] is an extension of the OAuth2 authorization code grant flow to protect OAuth2 clients from interception attacks. If an attacker intercepts the flow and gains access to the authorization code before it is returned to the application, it can be used to obtain the access tokens and gain access to Datadog APIs.

To mitigate such attacks, the PKCE extension introduces additional parameters to securely correlate an authorization request with a token request throughout the grant flow: 

- [code verifier][12], a dynamically-generated cryptographic random string. 
- [code challenge][13], a transformation of the code verifier.
- [code challenge method][14], the method used to derive the `code_challenge` from the `code_verifier`. You must use [SHA-256][16] for computing the `code_challenge`.

The [PKCE protocol][11] should be integrated into the Authorization Code grant flow:

1. The application generates a `code_verifier` random string and derives the corresponding `code_challenge` using the `code_challenge_method`.

2. The application sends an authorization request to Datadog with the `code_challenge` and `code_challenge_method` parameters to obtain an authorization code.

3. The application sends a token request to Datadog with the authorization code and `code_verifier` to obtain an access token. The token endpoint verifies the authorization code by transforming the `code_verifier` using the `code_challenge_method`, and comparing it with the original `code_challenge` value.


[1]: https://datatracker.ietf.org/doc/html/rfc6749
[2]: https://docs.datadoghq.com/api/latest/scopes/
[3]: https://docs.datadoghq.com/developers/datadog_apps/#oauth-api-access
[4]: https://datatracker.ietf.org/doc/html/rfc6749#section-3.2.1
[5]: /developers/integrations/oauth_for_data_integrations
[6]: /developers/authorization/oauth2_endpoints##request-authorization-from-a-user
[7]: /developers/authorization/oauth2_endpoints#api-key-creation
[8]: https://tools.ietf.org/html/rfc6749#section-4.1
[9]: /developers/authorization/oauth2_endpoints#api-key-creation##obtain-an-authorization-code
[10]: /developers/authorization/oauth2_endpoints#api-key-creation##exchange-authorization-code-for-access-token
[11]: https://datatracker.ietf.org/doc/html/rfc7636
[12]: https://datatracker.ietf.org/doc/html/rfc7636#section-4.1
[13]: https://datatracker.ietf.org/doc/html/rfc7636#section-4.2
[14]: https://datatracker.ietf.org/doc/html/rfc7636#section-4.3
[15]: https://datatracker.ietf.org/doc/html/rfc6234#section-4.1