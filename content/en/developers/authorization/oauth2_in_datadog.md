---
title: OAuth2 in Datadog
kind: documentation
description: Learn about how Datadog uses OAuth 2.0.
further_reading:
- link: "/developers/authorization/oauth2_endpoints"
  tag: "Documentation"
  text: "Learn how to use the OAuth 2.0 authorization endpoints"
---

## Overview

Datadog uses the [OAuth 2.0 (OAuth2) Authorization Framework][1] to allow users to securely authorize third-party applications' access to restricted Datadog resources on behalf of the user. The access that applications have is determined by [scopes][2], which enable users to grant explicit consent for a specific set of granular permissions requested by the application. 

### Clients and credentials

An OAuth2 client is the component of an application that enables users to authorize the application access to Datadog resources on the user's behalf. OAuth2 defines two types of clients: public and [confidential][4]. 

Public Clients
: Typically used for browser-based applications and are not capable of storing confidential information. Examples of public clients include OAuth clients for [Datadog Apps][3]. 

Confidential Clients
: Capable of storing sensitive data and requires an additional `client_secret` to make authorization requests. OAuth clients for data integrations are confidential clients. 

When you create an OAuth client, a set of client credentials is issued in the form of a client ID, and optionally, a client secret for confidential clients. 

Client ID 
: Used to identify your client when making requests to the authorization and token endpoints. 

Client Secret 
: If issued, used to authenticate the client when making requests to the authorization endpoints. Immediately copy and store the client secret securely as it is a confidential password exposed only once upon client creation. 

## Implement an OAuth protocol

This section contains a step-by-step overview on how to prepare your application for implementing the OAuth protocol end-to-end once your **confidential** client is created. 

1. Create and configure your OAuth client in the [Developer Platform][16]. 

2. After a user installs your integration, they can see a button to connect their account on the **Configure** tab in the integration tile. 

   When a user clicks this button, they are directed to the `onboarding_url` that you provided as a part of the OAuth client creation process. This page should be the sign-in page for your platform.

3. Once a user signs in, direct them to the [OAuth2 Authorization documentation][6] with the appropriate URL parameters, which includes the added `code_challenge` parameter generated by your application.

   To learn how to derive the `code_challenge` parameter, see the [PKCE](#pkce) section. Your application must save `code_verifier` for the token request in Step 5.

   In order to build this URL, use the `site` query parameter that is provided on the redirect to your `onboarding_url`. The format of the domain should match the following format. You can append the `authorize` path to this constructed URL: `https://{<custom_subdomain>,app,us3,us5}.{datadoghq,ddog-gov}.{com,eu}`.

4. Once a user clicks **Authorize**, Datadog makes a POST request to the authorize endpoint. The user is redirected to the `redirect_uri` that you provided when setting up the OAuth Client with the authorization `code` parameter in the query component.

5. From the `redirect_uri`, make a POST request to the Datadog token endpoint that includes the authorization code from Step 4, the `code_verifier` from Step 3, and your OAuth client ID and secret.

   In order to build this URL, use the `site` query parameter that is provided on the redirect to your `redirect_uri`. The format of the domain should match the following format. You can append the `token` path to this constructed URL: `https://{<custom_subdomain>,app,us3,us5}.{datadoghq,ddog-gov}.{com,eu}`.

6. Upon success, you receive your `access_token` and `refresh_token` in the response body. Your application should display a confirmation page with the following message: `You may now close this tab`.

7. Use the `access_token` to make calls to Datadog API endpoints by sending it in as a part of the authorization header of your request: ```headers = {"Authorization": "Bearer {}".format(access_token)}```.

8. Call the [API Key Creation endpoint][7] to generate an API key that allows you to send data on behalf of Datadog users.

   If the `API_KEYS_WRITE` scope has not been added to your client, this step fails. This endpoint generates an API Key that is only shown once. **Store this value in a secure database or location**. 

If you notice errors from these endpoints at any point in the process, take a look at the error messages in the UI. For more information about client creation and publishing, see the [OAuth for Datadog Integrations][5].

## Authorization code grant flow with PKCE

While the OAuth2 protocol supports several grant flows, the [authorization code grant flow][8] [with PKCE](#pkce) is the recommended grant type for long-running applications where a user grants explicit consent once and client credentials can be securely stored. 

This grant type allows applications to securely obtain a unique authorization code and exchange it for an access token that enables them to make requests to Datadog APIs. The authorization code grant flow consists of three steps:

1. The application [requests authorization from a user][6] to access a set of Datadog scopes.
2. When a user clicks **Authorize**, the application [obtains a unique authorization code][12].
3. The application [exchanges the authorization code for an access token][10], which is used to access Datadog APIs.

### Use the PKCE extension

[Proof key for code exchange (PKCE)][11] is an extension of the OAuth2 authorization code grant flow to protect OAuth2 clients from interception attacks. If an attacker intercepts the flow and gains access to the authorization code before it is returned to the application, they can obtain access tokens and gain access to Datadog APIs.

To mitigate such attacks, the PKCE extension includes the following parameters to securely correlate an authorization request with a token request throughout the grant flow: 

| Parameter             | Definition                                                                                                                           |
|-----------------------|--------------------------------------------------------------------------------------------------------------------------------------|
| Code Verifier         | A dynamically-generated cryptographic random string.                                                                                 |
| Code Challenge        | A transformation of the code verifier.                                                                                               |
| Code Challenge Method | The method used to derive the `code_challenge` from the `code_verifier`. You must use [SHA-256][16] to compute the `code_challenge`. |

The [PKCE protocol][11] integrates with the authorization code grant flow by completing the following actions:

- The application generates a `code_verifier` random string and derives the corresponding `code_challenge` using the `code_challenge_method`.

- The application sends an authorization request to Datadog with the `code_challenge` and `code_challenge_method` parameters to obtain an authorization code.

- The application sends a token request to Datadog with the authorization code and `code_verifier` to obtain an access token. The token endpoint verifies the authorization code by transforming the `code_verifier` using the `code_challenge_method` and comparing it with the original `code_challenge` value.

## Further Reading

{{< partial name="whats-next/whats-next.html" >}}

[1]: https://datatracker.ietf.org/doc/html/rfc6749
[2]: https://docs.datadoghq.com/api/latest/scopes/
[3]: https://docs.datadoghq.com/developers/datadog_apps/#oauth-api-access
[4]: https://datatracker.ietf.org/doc/html/rfc6749#section-3.2.1
[5]: /developers/integrations/oauth_for_data_integrations
[6]: /developers/authorization/oauth2_endpoints##request-authorization-from-a-user
[7]: /developers/authorization/oauth2_endpoints#api-key-creation
[8]: https://tools.ietf.org/html/rfc6749#section-4.1
[9]: /developers/authorization/oauth2_endpoints#api-key-creation##obtain-an-authorization-code
[10]: /developers/authorization/oauth2_endpoints#api-key-creation##exchange-authorization-code-for-access-token
[11]: https://datatracker.ietf.org/doc/html/rfc7636
[12]: https://datatracker.ietf.org/doc/html/rfc7636#section-4.1
[13]: https://datatracker.ietf.org/doc/html/rfc7636#section-4.2
[14]: https://datatracker.ietf.org/doc/html/rfc7636#section-4.3
[15]: https://datatracker.ietf.org/doc/html/rfc6234#section-4.1
[16]: https://app.datadoghq.com/apps