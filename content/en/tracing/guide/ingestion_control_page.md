---
title: Ingestion Control Page v2
kind: documentation
aliases:
    - /account_management/billing/usage_control_apm/
    - /tracing/app_analytics/
description: "Learn how to control Ingestion and Indexing rates with Tracing without Limits."
---

<div class="alert alert-warning">
  Ingestion Control page v2 is in private beta. Contact <a href="/help/">Datadog support</a> to request access for your organization. The support team will send you a notification when the new ingestion control page is enabled for your organization. The Ingestion Control page v2 replaces the former <a href="/tracing/trace_retention_and_ingestion/#ingestion-controls">Ingestion Controls</a></div>

The Ingestion Control page gives agent and tracing libraries level visibility on the ingestion configuration of your applications and services. From the [ingestion control configuration page][1] , you can :
- Investigate and act on potential ingestion configuration issues (Agent limited CPU or RAM resources).
- Check service level ingestion configuration and adjust traces-per-second sampling rates for high throughput services.
- Understand which ingestion mechanisms are responsible for sampling most of your traces.

{{< img src="tracing/trace_indexing_and_ingestion/ingestion_control_page.png" style="width:100%;" alt="Ingestion Control Page Overview" >}}

All metrics used in the page are based on live traffic data of the **past 1 hour**. Any agent or library configuration change will be reflected in the page.

## Summary accross all environments

Get an overview of the total ingested data over the past hour, the active APM intrastructure (hosts, fargate tasks and serverless functions), as well as an estimation of your monthly ingestion quota. If the quota is less than `100%`, the projected ingested data fits in your [monthly allotment][2] of 150GB per host.

## Service Table View

The service table contains information by service about the ingestion configuration :

Services
: The name of each service sending traces to Datadog. The table contains root and non-root services that ingested data in the over the past one hour.

Ingested Traces/s
: Average number of traces per second ingested into Datadog for the service over the past one hour.

Ingested Bytes/s
: Average number of bytes per second ingested into Datadog for the service over the past one hour.

Downstream Bytes/s
: Average number of bytes per second ingested into Datadog for which the service is responsible of the ingestion. This includes the bytes of all descending child spans, as well as spans caught by the [Error sampler][3], the [Rare sampler][4] and the [App Analytics][5] mechanism.

Traffic Breakdown
: A detailed breakdown of the destination of every trace generated by the service. See [Traffic Breakdown](#traffic-breakdown) for more information.

Ingestion Configuration
: Shows `Automatic` if the [default head-based sampling mechanism][6] from the Agent applies. If the ingestion was configured in the tracing libraries with [user-defined rules][7], the service is marked as `Configured`. To configure ingestion for a service, read how to [change the Default Ingestion Rate](#change-the-default-ingestion-rate) from the UI.

Infrastructure
: Hosts, containers and functions on which the service is running.

Service status
: Shows `Limited Resource` when some spans are dropped due to the datadog agent reaching CPU or RAM limits, `Legacy Setup` when some spans are ingested through the legacy [App Analytics mechanism][5], and `OK` the rest of the time.

Filter the page by environment, configuration and status to view services for which you need to take an action. To reduce the global ingestion volume, sort the table by the `Downstream Bytes/s` column to view services responsible for the largest share of your ingestion.

**Note:** The table is powered by the [usage metrics][8] `datadog.estimated_usage.apm.ingested_spans` and `datadog.estimated_usage.apm.ingested_bytes`. These metrics are tagged by `service`, `env` and `ingestion_reason`.

### Traffic breakdown

The Traffic Breakdown column breaks down the destination of all traces originating from the service. It gives you an estimation of the share of traffic that is ingested vs dropped, and for which reasons.

{{< img src="tracing/trace_indexing_and_ingestion/service_traffic_breakdown.png" style="width:100%;" alt="traffic breakdown of trace ingestion" >}}

The breakdown is composed of the following parts:

- **Complete traces ingested** (blue): The percentage of traces that have been ingested by Datadog.
- **Complete traces not retained** (gray): The percentage of traces that have intentionally not been forwarded to Datadog by the agent or the tracer. This can happen for one of two reasons depending on your configuration:

    1. By default, the [agent distributes an ingestion rate][6] to services depending of services traffic.
    2. When the service is manually [configured][7] to ingest a certain percentage of traces at the tracing library level

- **Complete traces dropped by the tracer rate limiter** (orange): When you choose to manually set the service ingestion rate as a percentage with rules, a rate limiter is set to 100 traces per second by default is automatically enabled. See the [rate limiter][7] documentation to manually configure this rate.

- **Traces dropped due to the agent CPU or RAM limit** (red): This mechanism may drop spans and create incomplete traces. To remediate to the issue, upscale the agent infra CPU/memory allocation.

## Service Ingestion Summary

Click on any service row to view the Service Ingestion Summary, a detailed view providing actionable insights on the ingestion configuration of the service.


{{< img src="tracing/trace_indexing_and_ingestion/service_ingestion_summary.png" style="width:100%;" alt="Service Ingestion Summary" >}}

Explore the **Ingestion reasons Breakdown** to see which specific mechanisms are responsible for your service ingestion. Each ingestion reason relates to one specific [ingestion mechanism][9]. After changing your service ingestion configuration, you can observe the decrease of ingested bytes/spans in this timeseries graph based on the past hour of ingested data.

If most of your service ingestion is due to decisions taken by upstream services, investigate the detail of the top uptream decision makers. For instance, if your service is non-root, (meaning that it **never decides** to sample traces), observe all upstream services responsible for your non-root service ingestion. Configure upstream root services to reduce your overall ingestion volume.

For further investigations, use the [APM Trace - Estimated Usage Dashboard][10], which provides global ingestion information as well as breakdown graphs by `service`, `env` and `ingestion reason`.

### Configure the service ingestion rate

Click the `Manage Ingestion Rate` cog button to configure your service ingestion rate.

{{< img src="tracing/trace_indexing_and_ingestion/service_ingestion_rate_config.png" style="width:100%;" alt="Change the Service Ingestion Rate" >}}

To specify that a specific percentage of a service's traffic should be sent, add a generated code snippet to your tracer configuration for that service.

1. Select the service you want to change the ingested span percent for.
2. Choose the service language.
3. Choose the desired ingestion percentage.
4. Apply the appropriate configuration generated from these choices to the indicated service and redeploy.
5. Confirm on the Ingestion Control Page that your new percentage has been applied. A share of the Ingestion Reason Breakdown should be allocated to `ingestion_reason:rule`.

[1]: https://app.datadoghq.com/apm/traces/ingestion-control
[2]: /pricing/?product=apm--continuous-profiler
[3]: /tracing/trace_ingestion/mechanisms#error-traces
[4]: /tracing/trace_ingestion/mechanisms#rare-traces
[5]: /tracing/trace_ingestion/mechanisms#single-spans-app-analytics
[6]: /tracing/trace_ingestion/mechanisms#in-the-agent
[7]: /tracing/trace_ingestion/mechanisms#in-tracing-libraries-user-defined-rules
[8]: /tracing/trace_retention_and_ingestion/usage_metrics
[9]: /tracing/trace_ingestion/mechanisms
[10]: https://app.datadoghq.com/dash/integration/30337/app-analytics-usage
