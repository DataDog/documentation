---
title: Ingestion Controls
kind: documentation
aliases:
    - /tracing/trace_ingestion/control_page
    - /tracing/trace_ingestion/ingestion_control_page
    - /account_management/billing/usage_control_apm/
    - /tracing/app_analytics/
    - /tracing/guide/ingestion_control_page/
    - /tracing/trace_ingestion/ingestion_controls
description: "Learn how to control Ingestion rates with APM."
further_reading:
- link: "/tracing/trace_pipeline/ingestion_mechanisms/"
  tag: "Documentation"
  text: "Ingestion Mechanisms"
- link: "/tracing/trace_pipeline/trace_retention/"
  tag: "Documentation"
  text: "Trace Retention"
- link: "/tracing/trace_pipeline/metrics/"
  tag: "Documentation"
  text: "Usage Metrics"
---

{{< img src="tracing/apm_lifecycle/ingestion_sampling_rules.png" style="width:100%; background:none; border:none; box-shadow:none;" alt="Ingestion Sampling Rules" >}}

Ingestion controls affect what traces are sent by your applications to Datadog. Stats and [metrics][1] are always calculated based on all traces, and are not impacted by ingestion controls.

The Ingestion Control page provides visibility at the Agent and tracing libraries level into the ingestion configuration of your applications and services. From the [ingestion control configuration page][2], you can:
- Investigate and act on potential ingestion configuration issues, such as limited CPU or RAM resources for the Agent.
- Check service-level ingestion configuration and adjust traces-per-second sampling rates for high throughput services.
- Understand which ingestion mechanisms are responsible for sampling most of your traces.

{{< img src="tracing/trace_indexing_and_ingestion/ingestion_control_page.png" style="width:100%;" alt="Ingestion Control Page Overview" >}}

All metrics used in the page are based on live traffic data of the **past 1 hour**. Any Agent or library configuration change is reflected in the page.

## Summary across all environments

Get an overview of the total ingested data over the past hour, and an estimation of your monthly usage against your monthly allocation, calculated with the active APM intrastructure (hosts, Fargate tasks, and serverless functions).

If the monthly usage is under `100%`, the projected ingested data fits in your [monthly per-host allotment][3]. A quota over `100%` means that the monthly ingestion volume is projected to be over your monthly allocation.

## Service table view

The service table contains information by service about the ingestion configuration:

Name
: The name of each service sending traces to Datadog. The table contains root and non-root services for which data was ingested in the past one hour.

Ingested Traces/s
: Average number of traces per second ingested into Datadog for the service in the past one hour.

Ingested Bytes/s
: Average number of bytes per second ingested into Datadog for the service in the past one hour.

Downstream Bytes/s
: Average number of bytes per second ingested, including spans from downstream services whose ingestion decisions are set at this service. This includes the bytes of all descending child spans, as well as spans caught by the [Error sampler][4], the [Rare sampler][5], and the [App Analytics][6] mechanism.

Traffic Breakdown
: A detailed breakdown of the destination of every trace generated by the service. See [Traffic breakdown](#traffic-breakdown) for more information.

Ingestion Configuration
: Shows `Automatic` if the [default head-based sampling mechanism][7] from the Agent applies. If the ingestion was configured in the tracing libraries with [user-defined rules][8], the service is marked as `Configured`. For more information about configuring ingestion for a service, read about [changing the default ingestion rate](#configure-the-service-ingestion-rate).

Infrastructure
: Hosts, containers, and functions on which the service is running.

Service status
: Shows `Limited Resource` when some spans are dropped due to the Datadog Agent reaching CPU or RAM limits set [in its configuration][12], `Legacy Setup` when some spans are ingested through the legacy [App Analytics mechanism][6], and `OK` the rest of the time.

Filter the page by environment, configuration, and status to view services for which you need to take an action. To reduce the global ingestion volume, sort the table by the `Downstream Bytes/s` column to view services responsible for the largest share of your ingestion.

**Note**: The table is powered by the [usage metrics][9] `datadog.estimated_usage.apm.ingested_spans` and `datadog.estimated_usage.apm.ingested_bytes`. These metrics are tagged by `service`, `env` and `ingestion_reason`.

### Traffic breakdown

The Traffic Breakdown column breaks down the destination of all traces originating from the service. It gives you an estimate of the share of traffic that is ingested and dropped, and for which reasons.

{{< img src="tracing/trace_indexing_and_ingestion/service_traffic_breakdown.png" style="width:100%;" alt="Traffic breakdown of trace ingestion" >}}

The breakdown is composed of the following parts:

- **Complete traces ingested** (blue): The percentage of traces that have been ingested by Datadog.
- **Complete traces not retained** (gray): The percentage of traces that have intentionally not been forwarded to Datadog by the Agent or the tracer. This can happen for one of two reasons depending on your configuration:

    1. By default, the [Agent distributes an ingestion rate][7] to services depending on service traffic.
    2. When the service is manually [configured][8] to ingest a certain percentage of traces at the tracing library level.

- **Complete traces dropped by the tracer rate limiter** (orange): When you choose to manually set the service ingestion rate as a percentage with rules, a rate limiter is automatically enabled, set to 100 traces per second by default. See the [rate limiter][8] documentation to manually configure this rate.

- **Traces dropped due to the Agent CPU or RAM limit** (red): This mechanism may drop spans and create incomplete traces. To fix this, increase the CPU and memory allocation for the infrastructure that the Agent runs on.

## Service ingestion summary

Click on any service row to view the Service Ingestion Summary, a detailed view providing actionable insights on the ingestion configuration of the service.

{{< img src="tracing/trace_indexing_and_ingestion/service_ingestion_summary.png" style="width:100%;" alt="Service Ingestion Summary" >}}

Explore the **Ingestion reasons breakdown** to see which mechanisms are responsible for your service ingestion. Each ingestion reason relates to one specific [ingestion mechanism][10]. After changing your service ingestion configuration, you can observe the increase or decrease of ingested bytes and spans in this timeseries graph based on the past hour of ingested data.

If most of your service ingestion is due to decisions taken by upstream services, investigate the detail of the top upstream decision makers. For example, if your service is non-root, (meaning that it **never decides** to sample traces), observe all upstream services responsible for your non-root service ingestion. Configure upstream root services to reduce your overall ingestion volume.

For further investigations, use the [APM Trace - Estimated Usage Dashboard][11], which provides global ingestion information as well as breakdown graphs by `service`, `env` and `ingestion reason`.

### Configure the service ingestion rate

Click **Manage Ingestion Rate** to configure your service ingestion rate.

{{< img src="tracing/trace_indexing_and_ingestion/service_ingestion_rate_config.png" style="width:100%;" alt="Change the Service Ingestion Rate" >}}

To specify that a specific percentage of a service's traffic should be sent, add a generated code snippet to your tracer configuration for that service.

1. Select the service you want to change the ingested span percent for.
2. Choose the service language.
3. Choose the desired ingestion percentage.
4. Apply the appropriate configuration generated from these choices to the indicated service and redeploy.
5. Confirm on the Ingestion Control Page that your new percentage has been applied. A share of the Ingestion Reason Breakdown should be allocated to `ingestion_reason:rule`.


## Further Reading

{{< partial name="whats-next/whats-next.html" >}}

[1]: /tracing/metrics/metrics_namespace/
[2]: https://app.datadoghq.com/apm/traces/ingestion-control
[3]: https://www.datadoghq.com/pricing/?product=apm--continuous-profiler#apm--continuous-profiler
[4]: /tracing/trace_pipeline/ingestion_mechanisms/#error-traces
[5]: /tracing/trace_pipeline/ingestion_mechanisms/#rare-traces
[6]: /tracing/trace_pipeline/ingestion_mechanisms/#single-spans-app-analytics
[7]: /tracing/trace_pipeline/ingestion_mechanisms/#in-the-agent
[8]: /tracing/trace_pipeline/ingestion_mechanisms/#in-tracing-libraries-user-defined-rules
[9]: /tracing/trace_pipeline/metrics
[10]: /tracing/trace_pipeline/ingestion_mechanisms/
[11]: https://app.datadoghq.com/dash/integration/30337/app-analytics-usage
[12]: /tracing/troubleshooting/agent_rate_limits/#maximum-cpu-percentage
