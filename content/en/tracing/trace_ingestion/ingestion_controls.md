---
title: Ingestion Controls
kind: documentation
aliases:
    - /tracing/trace_ingestion/control_page
    - /tracing/trace_ingestion/ingestion_control_page
    - /account_management/billing/usage_control_apm/
    - /tracing/app_analytics/
description: "Learn how to control span ingestion"
further_reading:
- link: "/tracing/trace_ingestion/mechanisms/"
  tag: "Documentation"
  text: "Ingestion Mechanisms"
- link: "/tracing/trace_retention/"
  tag: "Documentation"
  text: "Trace Retention"
- link: "/tracing/trace_retention/usage_metrics/"
  tag: "Documentation"
  text: "Usage Metrics"
---

{{< img src="tracing/live_search_and_analytics/tracing_without_limits_lifecycle-1.png" style="width:100%; background:none; border:none; box-shadow:none;" alt="Trace Journey" >}}

Ingestion controls affect what traces are sent by your applications to Datadog. Stats and metrics are always calculated based on all traces, and are not impacted by ingestion controls.

Many instrumented services send 100% of their traces to Datadog by default. The Datadog Agent does not drop or sample any spans by default at volumes of up to 50 traces per second. It is common for high-volume services or services that experience intermittent traffic to not send 100% of spans by default. This 50-traces-per-second default ingestion is based on Intelligent Retention and keeps diverse traces by default.

Navigate to the [Ingestion Control][1] page to get an overview of the ingestion configuration across all your services

{{< img src="tracing/trace_indexing_and_ingestion/IngestionControls.png" style="width:100%;" alt="Retention Filters" >}}

**Note:** If you are seeing numbers below 100% for Ingestion Rate, ensure you are using Agent 6.19+ or 7.19+ as these versions increased the default rate.

In Datadog, on the [Ingestion Control page][1], you can see the following information:

Root Service
: The name of each service instrumented and sending traces to Datadog.

Data Ingested
: Amount of data ingested by Datadog over the selected time period.

Ingestion Rate
: A percentage from 0 to 100% of how many of the spans that are produced by the service are being ingested by Datadog.Any number lower than 100% means some traces are not being ingested by Datadog from the Datadog Agent, and these traces are be dropped by the Datadog Agent after metrics and stats have been calculated.

Ingestion Breakdown
: A detailed breakdown of the destination of every trace generated by the service. See [Ingestion Breakdown](#ingestion-breakdown) for more information.

Tracers Configuration
: Shows `Default` unless changed by using the instructions in-app to configure the tracer. See [Change the Default Ingestion Rate](#change-the-default-ingestion-rate) for more information. If all hosts with this service deployed are configured to send a specific volume of traces, this indicator displays `Fully Configured`. If only a portion of hosts with this service deployed are configured, the label instead shows `Partially Configured`.

Dropped Spans
: The percentage of incoming spans dropped by the Datadog Agent.If this percent is higher than 0%, the service can be configured by clicking anywhere on the service row.See [Change the Default Ingestion Rate](#change-the-default-ingestion-rate) for more information.

Traces Ingested per Second
: Average number of traces per second ingested into Datadog for the service over the selected time period.

Spans Ingested
: Number of spans ingested by Datadog over the selected time period.

In addition to the Data Ingestion column for each retention filter, there are also two metrics `datadog.estimated_usage.apm.ingested_spans` and `datadog.estimated_usage.apm.ingested_bytes`. These metrics are tagged by `service` and `env`, and top lists are available within the [Trace Analytics Dashboard][2] to show where the highest ingestion volumes are occurring. See the [Usage Metrics][3] documentation for more information.

### Change the default ingestion rate

{{< img src="tracing/trace_indexing_and_ingestion/ChangeIngestRate3.mp4" style="width:100%;" alt="Change the Data Ingestion Rate" video=true >}}

To specify that a specific percentage of a service's traffic should be sent, add a generated code snippet to your tracer configuration for that service.

1. Select the service you want to change the ingested span percent for.
2. Choose the service language.
3. Choose the desired ingestion percentage.
4. Apply the appropriate configuration generated from these choices to the indicated service and redeploy.
5. Confirm on the Data Ingestion page that your new percentage has been applied.

#### (Recommended) Setting the global ingestion rate to 100%

In order to ingest 100% of your traces in Datadog for all services for live search and analytics as well as to have the most control with retention filters, Datadog recommends configuring all services to send 100% of traces by default.

To configure for 100% ingestion on every service instrumented with a Datadog tracing library, set the following environment variable in the tracer configuration:

```
DD_TRACE_SAMPLE_RATE=1.0
```

**Note:** This may impact your bill if your total ingestion exceeds the included GBs. For more information, see the [APM Billing][4] page.

### Ingestion breakdown

The Ingestion Breakdown column breaks down the destination of all traces originating from the service. It can help you understand lower than expected ingestion rates and missing traces.

{{< img src="tracing/trace_indexing_and_ingestion/IngestionBreakdown.png" style="width:100%;" alt="breakdown of traces ingested" >}}

The breakdown is composed of the following parts:

- **Complete traces ingested** (green): The percentage of traces that have been ingested by Datadog.
- **Complete traces not retained** (gray): The percentage of traces that have intentionally not been forwarded to Datadog by the Agent or the tracer. This can happen for one of two reasons depending on your configuration:

    1. By default, the Agent and the tracers intelligently set the service ingestion rate. See [Change the Default Ingestion Rate](#change-the-default-ingestion-rate) to configure this behavior.
    2. When you change the default ingestion rate to less than 100%.

- **Complete traces dropped by the tracer rate limiter** (orange): When you choose to [configure the ingestion rate of a service](#change-the-default-ingestion-rate), you explicitly define the ingestion rate that your service should have. However, as a protection mechanism, a rate limiter set to 100 traces per second by default is automatically enabled. To configure this rate limiter, [open a support ticket][5] to have someone help guide you through the process.

- **Traces dropped due to the Agent CPU limit** (red): The Agent has a configuration option allowing users to limit the usage of the CPU. After this limit is reached the Agent stops accepting traces from the tracers. Change the [Agent configuration][6] to configure how much CPU to allocate to the Agent.

### Traces dropped before ingestion

100% trace ingestion cannot be achieved if you have not set the environment variable configuration `DD_TRACE_SAMPLE_RATE=1.0` for Tracing without Limits, and:
- your applications generate above 50 traces per second;
- your applications send intermittent traffic loads; or
- your applications traces are large in size or otherwise have complicated trace payloads.

In this case, some traces are dropped by the Datadog Agent *after* stats are computed, so that metrics calculated are based on 100% of your traces.

If you are seeing ingestion rates below 100% within Datadog and would like to send all your traces, enable Tracing without Limits by setting the environment variable as described above. If you have questions, contact [support][5].

{{< img src="tracing/trace_indexing_and_ingestion/VisualIndicator.png" style="width:100%;" alt="Root services not sending 100% of traces" >}}


## App Analytics to Tracing Without Limits

Before October 20, 2020, Datadog offered App Analytics to index spans for performing analytics. While this is no longer the recommended setup configuration and is not needed to use [Trace Explorer][7], the legacy instructions are available within the [App Analytics][8] setup page.

All existing App Analytics filters have been automatically transitioned to Retention Filters. You can continue to use the unchanged filters or modify them as needed. Transitioned filters are marked with an *i* representing Legacy App Analytics Filters.

**Note:** Existing App Analytics filters can be edited within Datadog, but only by editing the transitioned [retention filters][9]. Legacy filters are read only on the [settings][10] page in-app.

{{< img src="tracing/trace_indexing_and_ingestion/MigratedRetentionFilter.png" style="width:100%;" alt="Visual indicator of App Analytics filter migrated to a retention filter" >}}

## Further Reading

{{< partial name="whats-next/whats-next.html" >}}

[1]: https://app.datadoghq.com/apm/traces/ingestion-control
[2]: https://app.datadoghq.com/dash/integration/30337/app-analytics-usage
[3]: /tracing/trace_retention/usage_metrics
[4]: /account_management/billing/apm_distributed_tracing/
[5]: /help/
[6]: https://github.com/DataDog/datadog-agent/blob/master/pkg/config/config_template.yaml#L736-L741
[7]: /tracing/trace_explorer
[8]: /tracing/legacy_app_analytics/
[9]: https://app.datadoghq.com/apm/traces/retention-filters
[10]: https://app.datadoghq.com/apm/settings
