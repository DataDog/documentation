---
title: Upgrade The RUM Browser SDK
kind: guide
further_reading:
- link: '/real_user_monitoring/explorer'
  tag: 'Documentation'
  text: 'Visualize your RUM data in the Explorer'
- link: "https://www.datadoghq.com/blog/session-replay-datadog/"
  tag: "Blog"
  text: "Use Datadog Session Replay to view real-time user journeys"
---

## Overview 

Follow this guide to migrate between major versions of the RUM and Logs Browser SDKs.

## From v4 to v5

Browser RUM and Browser Logs SDKs v5 are available as of tk. We've introduced new configurations and privacy defaults for Session Replay, added the automatic collection of frustration signals, updated our performance metrics, updated our SDK parameters and APIs, and more.

Take notice of the below breaking changes as you upgrade your SDK. Changes are grouped by area of impact.

### General

#### SDK initialization parameters

**Action to take**: Replace the deprecated parameters with the new equivalent parameters in v5. The old parameter names are no longer available in v5.

| Deprecated parameter name (v4 or earlier) | New parameter name (v5) |
|-------------------------------------------|-------------------------|
| proxyUrl | proxy |
| sampleRate | sessionSampleRate |
| allowedTracingOrigins | allowedTracingUrls |
| tracingSampleRate | traceSampleRate |
| premiumSampleRate | sessionReplaySampleRate |
| replaySampleRate | sessionReplaySampleRate |

#### Public APIs

**Action to take**: Replace the deprecated APIs with the new equivalent APIs. The old APIs are no longer available in v5.

| Deprecated parameter name (v4 or earlier) | New parameter name (v5) |
|-------------------------------------------|-------------------------|
| DD_RUM.removeUser | [DD_RUM.clearUser][7] |
| DD_RUM.addRumGlobalContext | [DD_RUM.setGlobalContextProperty][8] |
| DD_RUM.removeRumGlobalContext | [DD_RUM.removeGlobalContextProperty][9] |
| DD_RUM.getRumGlobalContext | [DD_RUM.getGlobalContext][10] |
| DD_RUM.setRumGlobalContext | [DD_RUM.setGlobalContext][11] |
| DD_LOGS.addLoggerGlobalContext | [DD_LOGS.setGlobalContextProperty][8] |
| DD_LOGS.removeLoggerGlobalContext | [DD_LOGS.removeGlobalContextProperty][9] |
| DD_LOGS.getLoggerGlobalContext | [DD_LOGS.getGlobalContext][12] |
| DD_LOGS.setLoggerGlobalContext | [DD_LOGS.setGlobalContext][13] |
| logger.addContext | [logger.setContextProperty][14] |
| logger.removeContext | [logger.removeContextProperty][15] |

#### Intake domains
Intake domains are the domains of the endpoints to which the traffic is transmitted have been updated.

**Action to take**: If any, update your [Content Security Policy (CSP)][18] `connect-src` entry to use the new domain.

| Datadog site | Domain |
|--------------|--------|
| US1 | `connect-src https://browser-intake-datadoghq.com` |

#### Trusted events
In order to not collect incorrect or illegitimate data, the browser SDK now only listens to events generated by user actions and ignores events created by scripts. See [trusted events][19] for more details.

**Action to take**: If you rely on any programmatic events and want them to be taken into account by the SDK, add the `__ddIsTrusted` attribute to them, like below:

```javascript
const click = new Event('click')
click.__ddIsTrusted = true
document.dispatchEvent(click)
```

**Action to take**: If you rely heavily on programmatic events, such as in an automated UI test environment, for example, you can allow all untrusted events by setting `allowUntrustedEvents: true`.

#### Before send return type
In order to have a consistent return type for the beforeSend API, we have updated its signature to the following:

```javascript
beforeSend(event: any, context?: any) => boolean
```

The implementation has not changed. If no value is returned, the event is not discarded.

**Action to take**: Ensure that `beforeSend` returns `true` to keep the event and false to discard it. This resolves any related typescript compilation errors.

### Session Replay

#### Session Replay masking

The default Session Replay masking setting `defaultPrivacyLevel` has been changed from `mask-user-input` to `mask`. This makes your Session Replay recordings hide all data by default, making recordings less sensitive to view. For more information, see [Session Replay Browser Privacy Options][20].

**Action to take**: If you want to see more unmasked data in Session Replay, like non-sensitive HTML content or user-entered text, set `defaultPrivacyLevel` to `mask-user-input` or `allow`. 

#### Automatic recording of sessions sampled for Session Replay
Sessions that are sampled for Session Replay using [`sessionReplaySampleRate`][21] are automatically recorded at the start of the session. This means that you don't have to call the [`startSessionReplayRecording()`][22] method to capture a recording anymore. In other words, you won't accidentally miss any recordings.

**Action to take**: If you want to continue using the old recording behavior and customize when your recording starts, set `startSessionReplayRecordingManually` to `true`.

#### Only pay for Session Replay when the session captures a recording
Previously, sessions were determined to be Session Replay sessions through our sampling mechanism. Now, sessions are only be billed as Session Replay sessions if a recording is captured during the session. This makes it easier to track your Session Replay usage and bill. 

**No action needed**: This behavior automatically takes effect once you upgrade to SDK v5.

#### Default Session Replay sampling rate
With v5, the default `sessionReplaySampleRate` is 0 instead of 100. This means that if you don't include a sampling rate, no replays are recorded.

**Action to take**: To use Session Replay, set a sampling rate explicitly with `sessionReplaySampleRate: 100` (or another sampling rate).

### RUM

#### Frustration signals are collected automatically
We've simplified the collection of user interactions so that you only need to set `trackUserInteractions: true` to collect all interactions, including frustration signals. This means that you no longer need to set the `trackFrustrations` parameter separately.

**Action to take**: To track frustration signals, set `trackUserInteractions: true`. The `trackFrustrations` parameter can be removed.

#### Resource durations are omitted for frozen pages
We've updated our resource collection to omit durations of resources that were extended due to the page going into the background, for example, when the user clicks on a separate tab while the page is loading.

**No action needed**: This behavior automatically takes effect once you upgrade to SDK v5.

#### Resources and long tasks tracking
When using `replaySampleRate` or `premiumSampleRate` (both deprecated), resources and long tasks were automatically collected.

With the use of `sessionReplaySampleRate`, resources and long tasks collection need to be configured explicitly.

**Action to tak**e**: If you want to collect these events, ensure that `trackResources` and `trackLongTasks` are set to `true`.

#### Resource method names are in uppercase
In order to avoid having different values for the same method name depending on the case (POST vs post), method names are now consistently sent in uppercase.

**Action to take**: Update monitor or dashboard queries to use the `resource.method` field with uppercase values.

#### Before send action event
The beforeSend API allows access to contextual information of the collected events (see [Enrich and control RUM data][23]).

With the introduction of frustration signals, an action event can be associated with several DOM events.

Along with this update, the `context.event` attribute has been removed in favor of the `context.events` attribute.

**Action to take**: Update `beforeSend` code to use `context.events` instead of `context.event`.

```javascript
beforeSend: (event, context) => {
    if (event.type === 'action' && event.action.type === 'click') {
      // accessing browser events related to the action event
      // before, single event: context.event
      // now, multiple events: context.events
    }
  }
```

#### Before send in foreground periods
The `view.in_foreground_periods` attribute is not sent by the SDK anymore but computed directly from the backend.

**Action to take**: Update beforeSend code to not use `view.in_foreground_periods` anymore. If you were relying on this attribute for a specific use case, reach out to [Support][24] for assistance.

#### Before send performance entry
The beforeSend context `performanceEntry` attribute has been updated from the JSON representation to include the performance entry object directly.

Our exported `PerformanceEntryRepresentation` type has been removed in favor of the standard `PerformanceEntry` type.

**Action to take**: If the `PerformanceEntryRepresentation` type was used by the beforeSend code, use the `PerformanceEntry` type directly.

### Logs
#### Remove console error prefix
The "`console error:`" prefix in logs messages has been removed. This information can now be found in the `origin` attribute.

**Action to take**: Update monitor or dashboard queries using `"console error:"` prefix to use `@origin:console` instead.

#### Remove error.origin

Since the introduction of the `origin` attribute on all logs, `error.origin` was redundant and has now been removed.

**Action to take**: Update monitor or dashboard queries on `error.origin` to use `origin` instead.

#### Decouple main logger
The main logger (`DD_LOGS.logger`) configured context and level affected logs generated by console, report, network errors, and runtime errors, which led to surprising behavior.

**Action to take**: If you relied on the main logger level to exclude non-logger logs, use dedicated initialization parameters instead.

**Action to take**: If you relied on the main logger context to add context to non-logger logs, use global context instead.

## From v3 to v4

Several breaking changes were made to the RUM and Logs Browser SDK with the v4 version.

### Changes

#### Intake URLs

The URLs for where the RUM Browser SDK data is sent has changed. Ensure that your [Content Security Policy is up to date][1].

#### Minimal Typescript version support

The RUM Browser SDK v4 is not compatible with TypeScript earlier than v3.8.2. If you use TypeScript, ensure that the version is at least v3.8.2.

#### Tags syntax

The `version`, `env`, and `service` initialization parameters are sent as tags to Datadog. The RUM Browser SDK slightly sanitizes them to ensure that they don't generate multiple tags, and prints a warning if those values don't meet the tag requirements syntax.

#### Stricter initialization parameters typing

TypeScript types representing initialization parameters are stricter and may reject previously accepted unsupported parameters. If you get type-checking errors, ensure you are providing supported initialization parameters.

#### Privacy options precedence

When multiple privacy options are specified on the same element, Datadog applies the most restrictive option to avoid unexpectedly leaking sensitive data. For example, if both `dd-privacy-allow` and `dd-privacy-hidden` classes are specified on the same element, it is hidden instead of allowed.

#### Action names computation

When computing action names, the RUM Browser SDK removes text of child elements with the `data-dd-action-name` attribute from inner text.

For example, for the following `container` element, where previously the computed action name would be `Container sensitive data`, in v4, the computed action name is `Container`:
```html
<div id="container">
  Container
  <div data-dd-action-name="sensitive">sensitive data</div>
</div>
```


### Removals

#### XHR `_datadog_xhr` field

The RUM Browser SDK previously used a `_datadog_xhr` property on `XMLHttpRequest` objects representing its internal state. This property has been removed without replacement as it wasn't intended to be used externally.

#### `proxyHost` initialization parameter

The `proxyHost` initialization parameter has been removed. Use the `proxyUrl` initialization parameter instead.

#### Privacy options support

The privacy options `input-ignored` and `input-masked` are no longer valid. Instead, use the `mask-user-input` privacy option. 

Specifically, replace:

* `dd-privacy-input-ignored` and `dd-privacy-input-masked` class names with `dd-privacy-mask-user-input`
* `dd-privacy="input-masked"` and `dd-privacy="input-ignored"` attribute values with `dd-privacy="mask-user-input"`

## From v2 to v3

The Browser SDK v3 introduces [Session Replay][2]. With this major version update, several breaking changes were made to the RUM and Logs Browser SDKs.

### Changes
#### RUM errors

The RUM Browser SDK no longer issues [RUM errors][3] for failed XHR and Fetch calls. These failed network requests are still collected as [RUM resources][4], which contain the status code attribute.

To continue seeing the failed network requests as RUM errors, Datadog recommends intercepting the resource with the [beforeSend API][5], checking the `status_code` property, and manually sending an error with the [addError API][6].

```javascript
beforeSend: (event) => {
    if (event.type === 'resource' && event.resource.status_code >= 500) {
        datadogRum.addError(`${event.resource.method} ${event.resource.url} ${event.resource.status_code}`); // "GET https://www.example.com/ 504"
    }
}
```

#### RUM error source attribute

The RUM Browser SDK no longer lets you specify the source of an error collected with the [addError API][6]. All errors collected with this API have their source attribute set to `custom`. The [addError API][6] accepts a context object as its second parameter, which should be used to pass extra context about the error.

### Removals
#### RUM API

| Old API       | New API   |
| ------------- | --------- |
| addUserAction | addAction |

#### Initialization options

| Old options        | New options |
| ------------------ | ----------- |
| publicApiKey       | clientToken |
| datacenter         | site        |
| resourceSampleRate | NONE        |

#### TypeScript types

| Old types                    | New types                    |
| ---------------------------- | ---------------------------- |
| RumUserConfiguration         | RumInitConfiguration         |
| RumRecorderUserConfiguration | RumRecorderInitConfiguration |
| LogsUserConfiguration        | LogsInitConfiguration        |

## Further Reading

{{< partial name="whats-next/whats-next.html" >}}

[1]: /real_user_monitoring/faq/content_security_policy
[2]: /real_user_monitoring/session_replay
[3]: /real_user_monitoring/browser/collecting_browser_errors/
[4]: /real_user_monitoring/browser/monitoring_resource_performance/
[5]: /real_user_monitoring/browser/modifying_data_and_context/?tab=npm#enrich-and-control-rum-data
[6]: /real_user_monitoring/browser/collecting_browser_errors/?tab=npm#collect-errors-manually
[7]: /real_user_monitoring/browser/modifying_data_and_context/?tab=npm#clear-user-session-property
[8]: /real_user_monitoring/browser/modifying_data_and_context/?tab=npm#add-global-context-property
[9]: /real_user_monitoring/browser/modifying_data_and_context/?tab=npm#remove-global-context-property
[10]: /real_user_monitoring/browser/modifying_data_and_context/?tab=npm#read-global-context
[11]: /real_user_monitoring/browser/modifying_data_and_context/?tab=npm#replace-global-context
[12]: /api/latest/rum/
[13]: /api/latest/rum/
[14]: /api/latest/rum/
[15]: /api/latest/rum/
[16]: /api/latest/rum/
[17]: /api/latest/rum/
[18]: /integrations/content_security_policy_logs/?tab=firefox#use-csp-with-real-user-monitoring-and-session-replay
[19]: https://developer.mozilla.org/en-US/docs/Web/API/Event/isTrusted
[20]: /real_user_monitoring/session_replay/privacy_options/#configuration
[21]: /real_user_monitoring/guide/sampling-browser-plans/#setup
[22]: /real_user_monitoring/session_replay/#usage
[23]: /real_user_monitoring/browser/modifying_data_and_context/?tab=npm#enrich-and-control-rum-data
[24]: /help/