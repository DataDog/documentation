---
title: CloudPrem Ingress Configuration
description: Learn how to configure and manage ingress controllers for your CloudPrem deployment
further_reading:
- link: "/cloudprem/installation/"
  tag: "Documentation"
  text: "CloudPrem Installation"
- link: "/cloudprem/security/"
  tag: "Documentation"
  text: "CloudPrem Security"
---

## Overview

Ingress configuration is a critical component of your CloudPrem deployment that manages how external traffic reaches your services. A properly configured ingress controller ensures secure, efficient, and reliable access to your CloudPrem environment. It provides:

- **Traffic management**: Routes external requests to the appropriate CloudPrem services
- **Load balancing**: Distributes incoming traffic across multiple instances for better performance
- **TLS termination**: Handles HTTPS encryption and certificate management
- **Access control**: Enables you to define rules for who can access your CloudPrem deployment

## Public ingress

The public ingress is essential for enabling Datadog's control plane and query service to manage and query CloudPrem clusters over the public internet. It provides secure access to the CloudPrem gRPC API through the following mechanisms:

- Creates an internet-facing AWS Application Load Balancer (ALB) that accepts traffic from Datadog services
- Implements TLS encryption with SSL termination at the load balancer level
- Uses HTTP/2 (gRPC) for communication between the ALB and CloudPrem cluster
- Requires mutual TLS (mTLS) authentication where Datadog services must present valid client certificates
- Configures the ALB in TLS passthrough mode to forward client certificates to CloudPrem pods via the `X-Amzn-Mtls-Clientcert` header
- Rejects requests that are missing valid client certificates or the certificate header

This setup ensures that only authenticated Datadog services can access the CloudPrem cluster while maintaining secure encrypted communication end-to-end.

<!-- {{< img src="path/to/your/image-name-here.png" alt="TBD Public ingress diagram" style="width:100%;" >}} -->

## Internal ingress

The internal ingress enables log ingestion from Datadog Agents and other log collectors within your environment through HTTP.

<!-- {{< img src="path/to/your/image-name-here.png" alt="TBD Internal ingress with ALB provisioned by Helm chart" style="width:100%;" >}} -->

By default, the chart creates an internal AWS Application Load Balancer (ALB) to route HTTP traffic to the appropriate CloudPrem services based on the requested API endpoint path. However, if you prefer to use your own ingress controller (such as HAProxy, NGINX, or Traefik), you can disable the default internal ALB and configure your controller with the following routing rules:

```
rules:
- http:
    paths:
      # Ingest (Quickwit, ES, Datadog) endpoints to indexers
      - path: /api/v1/*/ingest
        pathType: ImplementationSpecific
        backend:
          service:
            name: <release name>-indexer
            port:
              name: rest
      - path: /api/v1/_elastic/bulk
        pathType: Prefix
        backend:
          service:
            name: <release name>-indexer
            port:
              name: rest
      - path: /api/v1/_elastic/*/_bulk
        pathType: ImplementationSpecific
        backend:
          service:
            name: <release name>-indexer
            port:
              name: rest 
      - path: /api/v2/logs
        pathType: Prefix
        backend:
          service:
            name: <release name>-indexer
            port:
              name: rest
      # Index management API endpoints to metastores
      - path: /api/v1/indexes
        pathType: Prefix
        backend:
          service:
            name: <release name>-metastore
            port:
              name: rest
      # Everything else to searchers
      - path: /*
        pathType: ImplementationSpecific
        backend:
          service:
            name: <release name>-searcher
            port:
              name: rest

```

<!-- {{< img src="path/to/your/image-name-here.png" alt="TBD Internal ingress using NGINX ingress controller" style="width:100%;" >}} -->

## Supported ingress controllers

<!-- This is generated by Cursor, if this is incorrect, I'll delete this entire section -->

CloudPrem supports various ingress controllers to accommodate different infrastructure requirements and preferences:

{{% collapse-content title="NGINX Configuration" level="h4" expanded=false %}}
```yaml
ingress:
  internal:
    create: false
  nginx:
    enabled: true
    annotations:
      kubernetes.io/ingress.class: nginx
      nginx.ingress.kubernetes.io/ssl-redirect: "true"
```
{{% /collapse-content %}}

{{% collapse-content title="HAProxy Configuration" level="h4" expanded=false %}}
```yaml
ingress:
  internal:
    create: false
  haproxy:
    enabled: true
    annotations:
      kubernetes.io/ingress.class: haproxy
```
{{% /collapse-content %}}

{{% collapse-content title="Traefik Configuration" level="h4" expanded=false %}}
```yaml
ingress:
  internal:
    create: false
  traefik:
    enabled: true
    annotations:
      kubernetes.io/ingress.class: traefik
```
{{% /collapse-content %}}


## Further reading

{{< partial name="whats-next/whats-next.html" >}} 