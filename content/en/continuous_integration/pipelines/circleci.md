---
title: Set up Tracing on a CircleCI Workflow
kind: documentation
aliases:
  - /continuous_integration/setup_pipelines/circleci
further_reading:
    - link: "/continuous_integration/pipelines"
      tag: "Documentation"
      text: "Explore Pipeline Execution Results and Performance"
    - link: "/continuous_integration/pipelines/custom_commands/"
      tag: "Documentation"
      text: "Extend Pipeline Visibility by tracing individual commands"
    - link: "/continuous_integration/troubleshooting/"
      tag: "Documentation"
      text: "Troubleshooting CI"
    - link: "/continuous_integration/pipelines/custom_tags_and_measures/"
      tag: "Documentation"
      text: "Extend Pipeline Visibility by adding custom tags and measures"
---

{{< site-region region="gov" >}}
<div class="alert alert-warning">CI Visibility is not available in the selected site ({{< region-param key="dd_site_name" >}}) at this time.</div>
{{< /site-region >}}

## Overview

[CircleCI][1] is a continuous integration and delivery platform that enables teams to build, test, and deploy software at scale. 

Set up tracing on CircleCI to optimize the performance of your pipelines, improve collaboration across teams, and ensure consistent, compliant build processes.

### Compatibility

| Pipeline Visibility | Platform | Definition |
|---|---|---|
| [Partial retries][12] | Partial pipelines | View partially retried pipeline executions. |
| Logs correlation | Logs correlation | Correlate pipeline and job spans to logs and enable [job log collection][10]. |
| [Custom spans][13] | Custom spans | Configure custom spans for your pipelines. |
| Custom pre-defined tags | Custom pre-defined tags | Set [custom tags][6] to all generated pipeline and job spans. |
| [Custom tags][14] [and measures at runtime][15] | Custom tags and measures at runtime | Configure [custom tags and measures][7] at runtime. |

## Configure the Datadog integration

The Datadog integration for [CircleCI][1] works by using [webhooks][2] to send data to Datadog.

1. For each project, go to **Project Settings > Webhooks** in CircleCI and add a new webhook:
   * **Webhook URL**: <code>https://webhook-intake.{{< region-param key="dd_site" >}}/api/v2/webhook/?dd-api-key=<API_KEY></code> where `<API_KEY>` is your [Datadog API key][3].
   * **Name**: `Datadog CI Visibility` or any other identifier name that you want to provide.
   * **Events**: Select `Workflow Completed` and `Job Completed`.
   * **Certificate verifications**: Enable this check.

2. Click **Add Webhook** to save the new webhook.

### Configure multiple projects in bulk

You can enable the hooks for many or all of your CircleCI projects in bulk, using [this Python script][9] which calls the Circle CI API.

The script requires:
- Python 3 and the requests package. For more info, run:
  ```shell
  ./service_hooks.py --help
  ```
- Your Datadog API key
- A Circle CI personal API token

To bulk-configure hooks for your projects:

1. Log in to your Circle CI account and follow all the projects for which you want to enable the hooks. Optionally, use the **Follow All** button on the Projects page.

2. Run the script either using environment variables `DD_API_KEY` and `DD_SITE`, or passing in flag parameters `--dd-api-key` and `--dd-site`:

   For example:

   ```shell
   ./service_hooks.py \
       --dd-api-key <DD_API_KEY> \
       --circle-token <CIRCLECI_TOKEN> \
       --dd-site {{< region-param key="dd_site" code="true" >}} \
       --threads 4
   ```

### Set custom tags
To set custom tags to all the pipeline and job spans generated by the integration, add to the **Webhook URL** a URL-encoded query parameter `tags`, with `key:value` pairs separated by commas. If a key:value pair contains any commas, surround it with quotes. For example, to add `key1:value1,"key2: value with , comma",key3:value3`, the following string would need to be appended to the **Webhook URL**:

`?tags=key1%3Avalue1%2C%22key2%3A+value+with+%2C+comma%22%2Ckey3%3Avalue3`

#### Integrate with Datadog Teams
To display and filter the teams associated with your pipelines, add `team:<your-team>` as a custom tag. The custom tag name must match your [Datadog Teams][8] team handle exactly.

### Enable log collection

The Datadog CircleCI integration collects logs from your finished CircleCI jobs and forwards them to Datadog.

To install and configure this integration, follow the [CircleCI setup guide][11].


## Visualize pipeline data in Datadog

The [Pipelines][4] and [Pipeline Executions][5] pages populate with data after the workflows finish.

**Note**: The Pipelines page shows data for only the default branch of each repository.

## Further reading

{{< partial name="whats-next/whats-next.html" >}}

[1]: https://circleci.com/
[2]: https://circleci.com/docs/2.0/webhooks
[3]: https://app.datadoghq.com/organization-settings/api-keys
[4]: https://app.datadoghq.com/ci/pipelines
[5]: https://app.datadoghq.com/ci/pipeline-executions
[6]: /continuous_integration/pipelines/circleci/#set-custom-tags
[7]: /continuous_integration/pipelines/custom_tags_and_measures/?tab=linux
[8]: /account_management/teams/
[9]: https://raw.githubusercontent.com/DataDog/ci-visibility-circle-ci/main/service_hooks.py
[10]: /continuous_integration/pipelines/circleci/#enable-log-collection
[11]: /integrations/circleci/#setup
[12]: /glossary/#partial-retry
[13]: /glossary/#custom-span
[14]: /glossary/#custom-tag
[15]: /glossary/#custom-measure