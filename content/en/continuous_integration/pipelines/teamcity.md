---
title: Set up Tracing on a TeamCity Pipeline
kind: documentation
aliases:
  - /continuous_integration/setup_pipelines/teamcity
further_reading:
  - link: "/continuous_integration/pipelines"
    tag: "Documentation"
    text: "Explore Pipeline Execution Results and Performance"
  - link: "/continuous_integration/troubleshooting/"
    tag: "Documentation"
    text: "Troubleshooting CI"
---

{{< site-region region="gov" >}}
<div class="alert alert-warning">CI Visibility is not available in the selected site ({{< region-param key="dd_site_name" >}}) at this time.</div>
{{< /site-region >}}

## Compatibility

- **Supported TeamCity versions**: 2021.2 or higher

- **Partial retries**: View partially retried pipeline executions

- **Queue time**: View amount of time pipeline jobs sit in the queue before processing

- **Pipeline failure reasons**: Identify pipeline failure reasons from error messages

## Configure the Datadog integration

The integration between [TeamCity][1] and Datadog CI Visibility is provided via a TeamCity [plugin][8]. The steps to
activate the integration are:
1. Download the [Datadog CI Integration plugin][5] on the TeamCity server by going to
Administration -> Plugins -> Browse Plugin Repository.
2. For the integration to work properly, a [TeamCity composite build][6] needs be added as the last build
of the build chain (this step can be skipped if there is already one). Namely, this build must have
a dependency on the current last build of the chain and no other builds depending on it. Build chains not having a
composite build as their last build will be ignored by the plugin.
3. The following configuration parameters need to be present for the TeamCity projects:
   * `datadog.ci.api.key`: having as value your [Datadog API Key][2].
   * `datadog.ci.site`: having as value {{< region-param key="dd_site" code="true" >}}.
   * `datadog.ci.enabled`: having as value `true` (`false`
   can be used to disable the plugin for a specific project).

   <br/>These configuration parameters can be defined either at TeamCity projects level
   or at the [TeamCity Root Project][11] level, with the latter meaning that the value will be propagated
   to all the projects. For example, to enable the plugin for all projects, you can add `datadog.ci.enabled` with value `true`
   to the Root Project. More information on defining configuration parameters are available in the [TeamCity Project Hierarchy][10] docs.
4. Enable the plugin by restarting the TeamCity server.

## Visualize pipeline data in Datadog

The [Pipelines][3] and [Pipeline Executions][4] pages populate with data after the pipelines finish.

**Note**: The Pipelines page shows data for only the default branch of each repository.

## Troubleshooting

All the logs generated by the Datadog CI Integration plugin are stored inside the `teamcity-server.log` file and can be
accessed from the TeamCity Server via Administration -> Diagnostic -> Server Logs. If the plugin is not behaving
correctly, these logs can be checked to get additional context on what might be wrong. When reaching out to us
to signal any issue with the plugin, please include these logs to facilitate the debugging on our side.

## Git User Information

The plugin retrieves the Git author and committer information based on the [TeamCity username style][7].
When the username styles "UserId" or "Author Name" are used, the related username doesn't contain the user email,
therefore an email is automatically generated by the plugin by adding @TeamCity at the end of the username.
For example, the plugin will generate john.doe@Teamcity as the git author email when the "UserId" username
style is used and the git author username is john.doe. It's important to note that the git author email is used for
[billing][9] purposes, therefore there might be cost implications when the two username styles mentioned above are used.
Please reach out to us if you have any questions about your use case.

## Plugin Repository

The [source code][8] of the Datadog CI Integration plugin is open source under the Apache 2.0 license.

## Further reading

{{< partial name="whats-next/whats-next.html" >}}

[1]: https://www.jetbrains.com/teamcity/
[2]: https://app.datadoghq.com/organization-settings/api-keys
[3]: https://app.datadoghq.com/ci/pipelines
[4]: https://app.datadoghq.com/ci/pipeline-executions
[5]: https://plugin-link.com
[6]: https://www.jetbrains.com/help/teamcity/composite-build-configuration.html
[7]: https://www.jetbrains.com/help/teamcity/git.html#General+Settings
[8]: https://github.com/DataDog/ci-teamcity-plugin
[9]: https://www.datadoghq.com/pricing/?product=ci-visibility#ci-visibility
[10]: https://www.jetbrains.com/help/teamcity/project.html#Project+Hierarchy
[11]: https://www.jetbrains.com/help/teamcity/project.html#Root+Project
