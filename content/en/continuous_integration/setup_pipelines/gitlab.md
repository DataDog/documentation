---
title: Setup Tracing on a GitLab Pipeline
kind: documentation
further_reading:
    - link: "/continuous_integration/explore_pipelines"
      tag: "Documentation"
      text: "Explore Pipeline Execution Results and Performance"
    - link: "/continuous_integration/troubleshooting/"
      tag: "Documentation"
      text: "Troubleshooting CI"
---

## Compatibility

Supported GitLab versions:
* GitLab.com (SaaS)
* GitLab >= 14.1 (self-hosted)

Additional supported versions with additional configuration:
* GitLab >= 13.7.0 (self-hosted), by enabling the `datadog_ci_integration` feature flag
* GitLab <= 13.7.0 (self-hosted), using the [webhooks integration](#integrating-through-webhooks).

## Enabling the Datadog integration

The [Datadog integration][1] is enabled by default in GitLab.com and GitLab self-hosted from version 14.1 onwards.

For versions between 13.7.0 and 14.1, you will need to enable the `datadog_ci_integration` [feature flag][2] to activate the integration. In order to do so, execute the following commands that use GitLab's [Rails Runner][4] depending on your installation type:

For Omnibus installations:

{{< code-block lang="shell" >}}
sudo gitlab-rails runner "Feature.enable(:datadog_ci_integration)"
{{< /code-block >}}

For installations from source:

{{< code-block lang="shell" >}}
sudo -u git -H bundle exec rails runner \
  -e production \
  "Feature.enable(:datadog_ci_integration)"
{{< /code-block >}}

For [Kubernetes deployments][5]:

{{< code-block lang="shell" >}}
kubectl exec -it <task-runner-pod-name> -- \
  /srv/gitlab/bin/rails runner "Feature.enable(:datadog_ci_integration)"
{{< /code-block >}}

## Configuring the Datadog integration

Configure the integration on a per project or group basis by going to **Settings > Integrations > Datadog** for each project or group you want to instrument. You can also activate the integration at the GitLab [instance level][10] by going to **Admin > Settings > Integrations > Datadog**, which will be applied to all existing and future projects.

Fill in the integration configuration settings:

**Active**
: Enables the integration.

**Datadog site**
: Specifies which [Datadog site][11] to send data to. Please note that only `datadoghq.com` is currently supported.<br/>
**Default**: `datadoghq.com`<br/>
**Possible values**: `datadoghq.com`

**API URL** (optional)
: Allows overriding the API URL used for sending data directly, only used in advanced scenarios.<br/>
**Default**: (empty, no override)

**API key**
: Specifies which API key to use when sending data. You can generate one in the [APIs tab][6] of the Integrations section on Datadog.

**Service** (optional)
: Specifies which service name to attach to each span generated by the integration. Use this to differentiate between GitLab instances.<br/>
**Default**: `gitlab-ci`

**Env** (optional)
: Specifies which environment (`env` tag) to attach to each span generated by the integration. Use this to differentiate between groups of GitLab instances (for exmaple, staging vs production).<br/>
**Default**: `none`

You can test the integration with the **Test settings** button (only available when configuring the integration on a project). After it's successful, click **Save changes** to finish the integration set up.

## Integrating through webhooks

As an alternative to using the native Datadog integration, you can use [webhooks][7] to send pipeline data to Datadog.

**Note**: The native Datadog integration is the recommended approach and the one that is actively under development. Use webhooks only if the native Datadog integration option is not available to you (for example, you have an older GitLab version and you're not able to upgrade).

Go to **Settings > Webhooks** in your repository (or GitLab instance settings), and add a new webhook:
* **URL**: `https://webhooks-http-intake.logs.datadoghq.com/v1/input/<API_KEY>` where `<API_KEY>` is one generated [here][6].
* **Secret Token**: leave blank
* **Trigger**: Select `Job events` and `Pipeline events`.

To set custom `env` or `service` parameters, use query parameters in the webhooks URL: `?env=<YOUR_ENV>&service=<YOUR_SERVICE_NAME>`

## Visualize pipeline data in Datadog

After the integration is successfully configured, both [Pipelines][8] and [Pipeline Executions][9] pages will start populating with data after pipelines finish.

**Note**: The Pipelines page shows data for only the default branch of each repository.


## Further reading

{{< partial name="whats-next/whats-next.html" >}}

[1]: https://docs.gitlab.com/ee/integration/datadog.html
[2]: https://docs.gitlab.com/ee/administration/feature_flags.html
[3]: https://support.gitlab.com/
[4]: https://docs.gitlab.com/ee/administration/operations/rails_console.html#using-the-rails-runner
[5]: https://docs.gitlab.com/ee/administration/troubleshooting/kubernetes_cheat_sheet.html#gitlab-specific-kubernetes-information
[6]: https://app.datadoghq.com/account/settings#api
[7]: https://docs.gitlab.com/ee/user/project/integrations/webhooks.html
[8]: https://app.datadoghq.com/ci/pipelines
[9]: https://app.datadoghq.com/ci/pipeline-executions
[10]: https://docs.gitlab.com/ee/user/admin_area/settings/project_integration_management.html
[11]: /getting_started/site/
