---
title: Setting up Infrastructure Vulnerability Management 
kind: documentation
further_reading:
- link: "/security/infrastructure_vulnerability/"
  tag: "Documentation"
  text: "Infrastructure Vulnerability Management"
---

{{< site-region region="gov" >}}
<div class="alert alert-warning">
Infrastructure Vulnerability Management is not available on the US1-FED Datadog site.
</div>
{{< /site-region >}}

{{< callout url="https://forms.gle/GwAWNEMSqyoao2fX6" >}}
  Infrastructure Vulnerability Management is in beta, but you can easily request access! Use this form to submit your request today.
{{< /callout >}}

## Prerequisites

- [Cloud Security Management][1] (using [Cloud Workload Security][2] or [Cloud Security Posture Management][3]).
- [Datadog Agent][4] 7.45.0 or higher for [Container Images][8].
- [Datadog Agent][4] 7.46.0 or higher for [ECS EC2 instances][9].
- [containerd][5] v1.5.6 or higher.
- [Helm Chart][6] v3.22.0 or higher.
- 5GB or more of free disk space on the Datadog Agent host. 

**Note**: In order for the Datadog Agent to scan for vulnerabilities, the free disk space must be equivalent to the size of your largest container image. If you have container images larger than 5GB, you would need to have additional equivalent free disk space on the host. 

## Setup

**Note**: This enables the Container Image Metadata collection (allowing you to explore container images) and SBOM (Software Bill of Materials) collection in your Datadog Agent (allowing you to scan libraries present in container images and hosts, and detect vulnerabilities).

{{< tabs >}}
{{% tab "Agent version >= 7.46.0" %}}

Add the following to your `values.yaml` configuration file:

```yaml
agents:
  containers:
    agent:
      env:
        - name: DD_CONTAINER_IMAGE_ENABLED
          value: "true"
        - name: DD_SBOM_ENABLED
          value: "true"
        - name: DD_SBOM_CONTAINER_IMAGE_ENABLED
          value: "true"
```
{{% /tab %}}
{{% tab "Agent version 7.45.x" %}}

```yaml
agents:
  containers:
    agent:
      env:
  - name: DD_CONTAINER_IMAGE_COLLECTION_SBOM_ENABLED
    value: "true"
  - name: DD_SBOM_ENABLED
    value: "true"
  - name: DD_CONTAINER_IMAGE_COLLECTION_METADATA_ENABLED
    value: "true"
  - name: DD_CONTAINER_IMAGE_ENABLED
    value: "true"
datadog:
  confd:
    container_image.yaml: |
      init_config:
      instances:
        - chunk_size: 5
    sbom.yaml: |
      init_config:
      instances:
        - chunk_size: 1
```
{{% /tab %}}
{{< /tabs >}}

### ECS EC2

To enable container and host vulnerability scanning on your [ECS EC2 instances][7], add the following environment variables to your `datadog-agent` container definition:

```yaml
{
    "containerDefinitions": [
        {
            "name": "datadog-agent",
             ...
            "environment": [
              ...
              {
                "name": "DD_CONTAINER_IMAGE_ENABLED",
                "value": "true"
              },
              {
                "name": "DD_SBOM_ENABLED",
                "value": "true"
              },
              {
                "name": "DD_SBOM_CONTAINER_IMAGE_ENABLED",
                "value": "true"
              }
            ]
        }
    ]
  ...
}
```
**Note**: If the agent fails to extract the SBOM from some container images, increase the Agent memory in the container definition:

```yaml
{
    "containerDefinitions": [
        {
            "name": "datadog-agent",
            "memory": 256,
            ...
        }
     ]
    ...
}
```

[1]: /security/cloud_security_management
[2]: /security/cloud_workload_security/
[3]: /security/cspm/
[4]: /agent/
[5]: https://kubernetes.io/docs/tasks/administer-cluster/migrating-from-dockershim/find-out-runtime-you-use/
[6]: /containers/kubernetes/installation/?tab=helm
[7]: /containers/amazon_ecs/?tab=awscli#setup
[8]: /security/infrastructure_vulnerability/setup/#setup
[9]: /security/infrastructure_vulnerability/setup/#ecs-ec2

## Further reading

{{< partial name="whats-next/whats-next.html" >}}