{{ if .img_param }}
    {{ .root.Scratch.Set "img_param" .img_param }}
{{ else }}
    {{ .root.Scratch.Set "img_param" "?ch=Width,DPR&fit=max" }}
{{ end }}
{{ $img_param := .root.Scratch.Get "img_param" }}

{{ $url := (print (.root.Site.Params.img_url) (printf "%s/%s" "images" .src)  ($img_param)) | safeURL }}

{{ $image_type_arr := split .src "." }}
{{ $image_ext := index $image_type_arr 1 }}
{{ $img_width := .width }}
{{ $img_height := .height }}
{{ $img_style := .style }}
{{ $img_class := .class }}
{{ $img_alt := .alt }}
{{ $disable_lazy := .disable_lazy }}

<picture {{ with $img_class }}class="{{ . }}"{{ end }}>
    <source srcset="{{ $url }}&auto=format&w=807 1x, {{ $url }}&auto=format&w=807&dpr=2 2x" media="(min-width: 1200px)">
    <source srcset="{{ $url }}&auto=format&w=670 1x, {{ $url }}&auto=format&w=670&dpr=2 2x" media="(min-width: 992px)">
    <source srcset="{{ $url }}&auto=format&w=496 1x, {{ $url }}&auto=format&w=496&dpr=2 2x" media="(min-width: 759px)">
    <source srcset="{{ $url }}&auto=format&w=496 1x, {{ $url }}&auto=format&w=496&dpr=2 2x" media="(min-width: 630px)">
    <source srcset="{{ $url }}&auto=format&w=496 1x, {{ $url }}&auto=format&w=496&dpr=2 2x" media="(min-width: 530px)">
    <source srcset="{{ $url }}&auto=format&w=360 1x, {{ $url }}&auto=format&w=360&dpr=2 2x" media="(min-width: 361px)">
    <source srcset="{{ $url }}&auto=format&w=360 1x, {{ $url }}&auto=format&w=360&dpr=2 2x" media="(min-width: 0px)">
    <img srcset="{{ $url }}&auto=format&w=807" {{ with $img_class }}class="{{ . }}"{{ end }} width="{{ $img_width }}" {{ with $img_height }}height="{{ . }}"{{ end }} {{ if ne $disable_lazy "true" }}loading="lazy"{{ end }} {{ with $img_alt }}alt="{{ . }}"{{ end }} {{ with $img_style }}style="{{ . | safeCSS }}"{{ end }} />
</picture>
