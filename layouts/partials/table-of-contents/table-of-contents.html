{{ $ctx := . }}
<div class="js-toc-container toc-container">
    <div class="toc">
        <div class="js-toc {{ if .Params.disable_toc }} d-none {{ else }} {{ end }}">
            {{ if ne .Params.disable_edit true }}
                {{ partial "page-edit.html" (dict "ctx" $ctx "type" "edit") }}
            {{ end }}
            <p class="text-uppercase text-gray-darkish font-semibold mb-2 toc-title js-toc-title {{ if .Params.disable_toc }} d-none {{ else }} {{ end }}">{{ i18n "table_of_contents_heading"}}</p>
            {{ if ne .Params.disable_toc true }}
              {{ if eq .Page.Type "reference" }}
                {{ $t := (index .Site.Data.reference "schema.tables") }}
                {{ $iterable_data := (index $t (.Title | lower)) }}
                <nav id="TableOfContents">
                  <ul>
                    {{ range $data := $iterable_data }}
                      <li><a href="#{{ $data.metadata.logical_name | anchorize }}">{{ index $data.metadata "docs::label" | default (index $data.metadata "docs::human_name") }}</a></li>
                    {{ end }}
                  </ul>
                </nav>
              {{else if eq .Page.Type "schema"}}
              {{ $schema_data := .Page.Params.list_section }}
                <nav id="TableOfContents">
                  <ul>
                    {{ range $key, $value := $schema_data}}
                      <li><a href="#{{ $key | anchorize }}">{{ $key | upper }}</a></li>
                    {{ end }}
                  </ul>
                </nav>
              {{ else }}
                {{ if in .RawContent "{{< site-region" }}
                  <nav id="TableOfContents">
                    <ul>
                    {{ $res := (findRE `<h([1-6]).*?>.*<\/h[1-6]>` .Content) }}
                    {{ $prevH := 100 }}
                    {{ $levelNested := 0 }}
                    {{ range $i, $head := $res }}
                      {{ $res := replaceRE `<h([1-6]).*?id=\"(.*)\".*?>(.*)<\/h[1-6]>` "$1,$2,$3" $head }}
                      {{ $s := split $res ","}}
                      {{ $hlevel := (index $s 0) }}
                      {{ $id := (index $s 1) }}
                      {{ $title := (index $s 2) }}

                      {{ if gt $hlevel $prevH }}
                          <ul>
                          {{ $levelNested = $prevH }}
                      {{ else if le $hlevel $levelNested }}
                          </li></ul>
                          {{ $levelNested = 0 }}
                      {{ else if ne $i 0 }}
                          </li>
                      {{ end }}

                      <li>
                          <a href="#{{ $id }}">{{ $title }}</a>

                      {{ $prevH = $hlevel }}
                    {{ end }}
                    </ul>
                  </nav>
                {{ else }}
                  {{ .TableOfContents }}
                {{ end }}
              {{ end }}
            {{ end }}
        </div>
    </div>
</div>

<div class="mobile-toc-toggle js-mobile-toc-toggle {{if eq .Params.disable_toc true }}d-none{{ else }}d-lg-none{{ end }}">
    <i class="icon-small-bookmark"></i>
    <i class="icon-small-x-2 d-none"></i>
</div>

<div class="js-mobile-toc-bg mobile-toc-bg"></div>
