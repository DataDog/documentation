{{ $context := .context }}
{{ $version := .version }}
{{ $apiData := index $context.Site.Data.api $version }}
{{ $codeExampleLookup := $apiData.CodeExamples }}

{{/* Simple template for code examples */}}
{{ $template := `
<h3 class="mb-2">Code Example</h3>
<div class="programming-lang-wrapper js-code-snippet-wrapper">
  <div class="code-snippet-wrapper js-code-block" data-code-lang-block="curl">
    <div class="code-snippet">
      <div class="highlight">
        <pre class="chroma">
          <code class="language-fallback" data-lang="fallback">{{ .curlExample }}</code>
        </pre>
      </div>
    </div>
  </div>
</div>
` }}

{{/* Generate a resource for each operation */}}
{{ range $operationId, $examples := $codeExampleLookup }}
  {{/* Create a simple curl example */}}
  {{ $curlExample := printf "curl -X POST 'https://api.datadoghq.com/api/v1/%s' -H 'DD-API-KEY: <API-KEY>' -H 'DD-APP-KEY: <APP-KEY>'" $operationId }}

  {{/* Create resource data */}}
  {{ $resourceData := dict "curlExample" $curlExample }}

  {{/* Generate the resource */}}
  {{ $resource := resources.FromString (printf "templates/code-%s.html" $operationId) $template }}
  {{ $processed := $resource | resources.ExecuteAsTemplate (printf "api-code-examples/%s.html" $operationId) $resourceData }}
{{ end }}
