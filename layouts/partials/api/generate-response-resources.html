{{/* Generate API response resources */}}
{{ $context := .context }}
{{ $apiExamples := $context.Site.Data.examples }}

{{ $responseTemplate := `
<div class="api-responses">
  {{ range $statusCode, $response := .responses }}
    <div class="response-{{ $statusCode }}" data-status="{{ $statusCode }}">
      <h4>{{ $statusCode }} Response</h4>
      {{ if $response.html }}
        {{ $response.html | safeHTML }}
      {{ else }}
        <pre><code>{{ $response.json | jsonify (dict "indent" "  ") }}</code></pre>
      {{ end }}
    </div>
  {{ end }}
</div>
` }}

{{ $requestTemplate := `
<div class="api-request-body">
  {{ if .request.html }}
    {{ .request.html | safeHTML }}
  {{ else }}
    <pre><code>{{ .request.json | jsonify (dict "indent" "  ") }}</code></pre>
  {{ end }}
</div>
` }}

{{ range $endpoint, $data := $apiExamples }}
  {{/* Generate response resource */}}
  {{ $responseResource := resources.FromString (printf "templates/response-%s.html" $endpoint) $responseTemplate }}
  {{ $processedResponse := $responseResource | resources.ExecuteAsTemplate (printf "api-responses/%s-processed.html" $endpoint) $data }}

  {{/* Generate request resource */}}
  {{ $requestResource := resources.FromString (printf "templates/request-%s.html" $endpoint) $requestTemplate }}
  {{ $processedRequest := $requestResource | resources.ExecuteAsTemplate (printf "api-requests/%s-processed.html" $endpoint) $data }}

  {{/* Cache references */}}
  {{ $context.Scratch.Set (printf "api-response-%s" $endpoint) $processedResponse.RelPermalink }}
  {{ $context.Scratch.Set (printf "api-request-%s" $endpoint) $processedRequest.RelPermalink }}
{{ end }}
