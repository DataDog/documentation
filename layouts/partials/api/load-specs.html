{{/* Shared partial for loading API specs with caching */}}
{{- $version  := .version | default "v1" -}}
{{- $cacheKey := printf "api:%s:full_spec" $version -}}
{{- $spec := "" -}}
{{- with (hugo.Store.Get $cacheKey) -}}
  {{- /* return cached */ -}}
  {{- $spec = . -}}
{{- else -}}
  {{- $apiData := index site.Data "api" -}}
  {{- if not $apiData -}}
    {{- errorf "Data namespace 'api' not found under /data. Expected /data/api/%s/full_spec.(yaml|yml|json)" $version -}}
  {{- end -}}

  {{- $verData := index $apiData $version -}}
  {{- if not $verData -}}
    {{- errorf "API data for version %q not found. Expected /data/api/%s/..." $version $version -}}
  {{- end -}}

  {{- $spec := index $verData "full_spec" -}}
  {{- if not $spec -}}
    {{- errorf "full_spec not found in .Site.Data.api.%s. Place full_spec.yaml|json at /data/api/%s/full_spec.(yaml|yml|json)" $version $version -}}
  {{- end -}}

  {{- /* Cache and return */ -}}
  {{- hugo.Store.Set $cacheKey $spec -}}
{{- end -}}

{{- return $spec -}}
