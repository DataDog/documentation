
{{ $context := .context }}
{{ $operationId := .operationid }}
{{ $version := .version }}

{{/* Generate resources if not already done */}}
{{ if not ($context.Scratch.Get "resources-generated") }}
  {{ partial "api/generate-resources.html" (dict "context" $context "version" $version) }}
  {{ $context.Scratch.Set "resources-generated" true }}
{{ end }}

<h3 class="mb-2">{{ i18n "code_example" }}</h3>

{{/* Use pre-generated resource */}}
{{ $resourcePath := printf "api-code-examples/%s-processed.html" $operationId }}
{{ $codeExampleResource := resources.Get $resourcePath }}

{{ if $codeExampleResource }}
  {{ $codeExampleResource.Content | safeHTML }}
{{ else }}
  {{/* Fallback to basic example */}}
  <div class="code-snippet-wrapper">
    <div class="code-snippet">
      <div class="highlight">
        <pre class="chroma">
          <code class="language-fallback" data-lang="fallback">
            {{/* Basic curl fallback */}}
            {{ partial "api/curl.html" (dict "context" $context "endpoint" .endpoint "title" .endpoint.action.summary) }}
          </code>
        </pre>
      </div>
    </div>
  </div>
{{ end }}

{{/* Language tabs */}}
{{ $codeLangs := slice "curl" }}
{{ $codeExampleLookup := (index (index $context.Site.Data.api $version) "CodeExamples") }}
{{ with (index $codeExampleLookup $operationId) }}
  {{ range $k, $langConfig := $context.Site.Params.code_languages }}
    {{ $codeLangs = $codeLangs | append $langConfig.name }}
  {{ end }}
{{ end }}
{{ $codeLangs = $codeLangs | uniq }}

{{ partial "code-lang-tabs" (dict "context" $context "codeLangs" $codeLangs) }}
