{{ define "main" }}
    <h1 id="pagetitle">{{ .Title }}</h1>

    {{ .Content }}

    <form>
        <div class="form-group clearfix">
            <input type="input" class="form-control rule-search mb-3" id="keywords" placeholder="Search here" onkeyup="search()">
        </div>

        <div class="list-group">
            {{ range $i, $v := .Pages.GroupByParam "parent" }}
                <div class="js-group js-group-{{ $i }}">
                    <div class="rule-list mb-1 active">
                        <div class="rule-list__icon d-inline font-semibold h-100 text-uppercase px-2 py-1">
                            {{ range first 1 $v.Pages }}
                              <img src="{{.Site.Params.img_url}}{{ .Params.meta_image }}?fit=auto&w=40" width="40" />
                            {{ end }}
                        </div>
                        <div class="d-inline font-semibold ml-1">{{ title $v.Key }}</div>
                        <div class="rule-list__arrow">></div>
                    </div>
                    <div class="group-{{ .Key }} mb-2 ml-2 d-none">
                        {{ range $v.Pages }}
                            {{ if isset .Params "source" }}
                            <a class="mb-1 font-semibold js-page" href="{{.Permalink}}" data-name="{{ lower .Title }}">
                                <img src="{{.Site.Params.img_url}}{{ .Params.meta_image }}?fit=auto&w=40" width="40" />
                                {{ .Title }}<br/>
                            </a>
                            {{ end }}
                        {{ end }}
                    </div>
                </div>
            {{ end }}
        </div>

    </form>

    <script type="text/javascript">
        const group = Array.prototype.slice.call(document.getElementsByClassName('js-group'));

        // Search
        function search() {
            const input = document.getElementById('keywords').value.toLowerCase();
            for(i = 0 ; i < group.length; i++){
                // Filtering individual rules
                const rules = Array.prototype.slice.call(document.querySelectorAll(`.js-group-${i} .js-page`));
                let count = 0;
                rules.forEach(elm => {
                    elm.classList.remove('d-none');
                    if(!elm.dataset.name.includes(input)){
                        elm.classList.add('d-none');
                    } else {
                        elm.classList.remove('d-none');
                        count += 1;
                    }
                });

                // Hiding group when there is no matching entry
                if(count === 0 ) {
                    document.querySelector(`.js-group-${i}`).classList.add('d-none');
                }else{
                    document.querySelector(`.js-group-${i}`).classList.remove('d-none');
                    document.querySelector(`.js-group-${i} > .rule-list`).classList.add('active');
                }
            }
        }

        // Accordion js
        const ruleList = Array.prototype.slice.call(document.getElementsByClassName('rule-list'));

        ruleList.forEach(elm => {
            elm.addEventListener("click", e => {
                e.currentTarget.classList.toggle('active');
            });
        });
    </script>
{{ end }}
