クォータプロセッサは、指定したフィルターに一致するログのロギングトラフィックを測定します。構成された日次クォータが 24 時間のローリングウィンドウ内で達成されると、プロセッサは追加のログをドロップするか、Datadog モニターを使用してアラートを送信することができます。プロセッサは、総ボリュームまたはイベントの総数を追跡するように構成できます。パイプラインは、Worker の複数の Remote Configuration デプロイメント間でクォータを識別するために、クォータの名前を使用します。

例えば、このプロセッサを構成して、過去 24 時間以内に特定のサービスから 1000 万件のイベントを受信した後に、新しいログを削除するか、削除せずにアラートをトリガーするように構成できます。

クォータプロセッサを設定するには、次の手順に従ってください、
1. クォータプロセッサの名前を入力します。
1. **フィルタークエリ**を定義します。指定した[フィルタークエリ](#filter-query-syntax)に一致するログのみが日次制限にカウントされます。
    - クォータフィルターに一致し、かつ日次クォータ内のログは、パイプラインの次のステップに送信されます。
    - クォータフィルターに一致しないログも、パイプラインの次のステップに送信されます。
1. **Unit for quota** (クォータの単位) ドロップダウンメニューで、クォータを `Events` の数か、バイト単位の `Volume` で測定するかを選択します。
1. 日次クォータの上限を設定し、希望するクォータの大きさの単位を選択します。
1. クォータが上限に達した場合にすべてのイベントを削除したい場合は、**Drop events** (イベントを削除) のチェックボックスをオンにします。クォータが上限に達したときにアラートを送信する[モニター][5001]をセットアップする場合は、チェックを外しておきます。
    - 日次クォータの上限に達した後にクォータフィルターに一致するログが受信され、**Drop events** (イベントを削除) オプションが選択されている場合、それらのログは削除されます。この場合、フィルタークエリに一致しなかったログのみがパイプラインの次のステップに送信されます。
    - 日次クォータの上限に達した後でも **Drop events** (イベントを削除) オプションが選択されていない場合、クォータフィルターに一致するログと一致しなかったログが共にパイプラインの次のステップに送信されます。
1. オプション: 特定のサービスまたはリージョンフィールドにクォータを設定したい場合は、**Add Field** をクリックします。
   a. パーティション分割したいフィールド名を入力します。詳細は[パーティションの例](#partition-example)を参照してください。
i. クォータをパーティションに一致するイベントのみに適用したい場合は、**Ignore when missing** を選択します。詳細は[「欠落時に無視」オプションの例](#example-for-the-ignore-when-missing-option)を参照してください。
ii. オプション: パーティション化されたフィールドに異なるクォータを設定したい場合は、**Overrides** をクリックします。
- CSV の構造例については、**Download as CSV** をクリックします。
- オーバーライド CSV をドラッグアンドドロップしてアップロードします。または、**Browse** をクリックしてファイルを選択してアップロードすることもできます。詳細は[オーバーライドの例](#overrides-example)を参照してください。
   b. もう 1 つのパーティションを追加したい場合は、**Add Field** をクリックします。

#### 例

##### パーティションの例

特定のサービスまたはリージョンにクォータを設定したい場合は、**Partition by** を使用します。例えば、1 日に 10 件のイベントのクォータを設定し、`service` フィールドでイベントをグループ化したい場合、`service` を **Partition by** フィールドに入力します。

##### 「欠落時に無視」オプションの例

クォータをパーティションに一致するイベントのみに適用したい場合は、**Ignore when missing** を選択します。例えば、Worker が次のイベントセットを受信した場合: 

```
{"service":"a", "source":"foo", "message": "..."}
{"service":"b", "source":"bar", "message": "..."}
{"service":"b", "message": "..."}
{"source":"redis", "message": "..."}
{"message": "..."}
```

そして **Ignore when missing** が選択されている場合、Worker は: 
- `service:a` と `source:foo` を持つログのセットを作成します
- `service:b` と `source:bar` を持つログのセットを作成します
- 最後の 3 つのイベントを無視します

クォータは 2 つのログセットに適用され、最後の 3 つのイベントには適用されません。

**Ignore when missing** が選択されていない場合、クォータは 5 つのすべてのイベントに適用されます。

##### オーバーライドの例

`service` でパーティション分割し、2 つのサービス `a` と `b` がある場合、オーバーライドを使用してそれぞれに異なるクォータを適用できます。例えば、`service:a` に 5,000 バイトのクォータ制限、`service:b` に 50 イベントの制限を設定したい場合、オーバーライドルールは次のようになります。

| サービス | タイプ   | Limit |
| ------- | ------ | ----- |
|  `a`    | Bytes  | 5,000 |
|  `b`    | イベント | 50    |

[5001]: /ja/monitors/types/metric/?tab=threshold