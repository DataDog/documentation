Quota プロセッサーは、指定したフィルターに一致するログのロギングトラフィックを測定します。設定された1 日のクォータが 24 時間のローリングウィンドウ内で達成されると、プロセッサーは追加のログを破棄するか、Datadog モニターを使用してアラートを送信することができます。総容量または総イベント数を追跡するようにプロセッサーを構成できます。パイプラインは、Worker の複数のリモートコンフィギュレーションデプロイメントでクォータを識別するために、クォータ名を使用します。

たとえば、過去 24 時間以内に特定のサービスから 1,000 万件のイベントを受信した後で、新しいログを破棄するか、破棄せずにアラートをトリガーするようにこのプロセッサーを構成できます。

Quotaプロセッサーをセットアップするには、次の手順に従います。
1. Quota プロセッサーの名前を入力します。
1. **フィルタークエリ**を定義します。指定した[フィルタークエリ](#filter-query-syntax)に一致するログのみが、1 日の制限の対象としてカウントされます。
    - Quota フィルターに一致し、かつ日次クォータ内のログは、パイプラインの次のステップに送信されます。
    - Quota フィルターに一致しないログも、パイプラインの次のステップに送信されます。
1. [**Unit for quota**] ドロップダウンメニューで、クォータを `Events` の数で測定するか、バイト単位の `Volume` で測定するかを選択します。
1. 日次クォータの上限を設定し、希望するクォータの大きさの単位を選択します。
1. クォータに達したときにすべてのイベントを破棄する場合は、[**Drop events**] チェックボックスをオンにします。クォータに達したときにアラートを送信する[モニター][5001]をセットアップする予定である場合は、オフのままにしておきます。
    - [**Drop events**] オプションが選択されている場合に、1 日のクォータに達した後で Quota フィルターに一致するログが受信されると、これらのログは破棄されます。この場合、フィルタークエリに一致しなかったログのみがパイプラインの次のステップに送られます。
    - [**Drop events**] オプションが選択されていない場合は、日次クォータの上限に達した後でも、Quota フィルターに一致するログと一致しなかったログが共にパイプラインの次のステップに送信されます。
1. オプション。特定のサービスまたは地域のフィールドにクォータを設定する場合は、[**Add Field**] をクリックします。
    a. パーティショニングの基準となるフィールド名を入力します。詳細については[パーティションの例](#partition-example)を参照してください。
        i. パーティションに一致するイベントにのみクォータを適用する場合は、[**Ignore when missing**] を選択します。詳しくは、[[[Ignore when missing] の例](#example-for-the-ignore-when-missing-option)を参照してください。
        ii. オプション。パーティション分割されたフィールドに異なるクォータを設定したい場合は、[**Overrides**] をクリックします。
        - [**Download as CSV**] をクリックして、CSV の構成例を確認します。
        - オーバーライド CSV をドラッグ＆ドロップしてアップロードします。[**Browse**] をクリックして、アップロードするファイルを選択することもできます。詳細については、[オーバーライドの例](#overrides-example)を参照してください。
    b. 別のパーティションを追加する場合は [**Add Field**] をクリックしてください。

#### 例

##### パーティションの例

特定のサービスやリージョンにクォータを設定する場合は、[**Partition by**] を使用します。たとえば、1 日 10 件のイベントというクォータを設定し、イベントを`service`フィールドでグループ化する場合、[**Partition by**] フィールドに `service` を入力します。

##### "Ignore when missing" の例

パーティションに一致するイベントのみにクォータを適用する場合は、[**Ignore when missing**] を選択します。たとえば、Worker が次の一連のイベントを受信するとします。

```
{"service":"a", "source":"foo", "message": "..."}
{"service":"b", "source":"bar", "message": "..."}
{"service":"b", "message": "..."}
{"source":"redis", "message": "..."}
{"message": "..."}
```

さらに [**Ignore when missing**] が選択されている場合、Worker は次の処理を行います。
- `service:a` と `source:foo` でログのセットを作成します。
- `service:b` と `source:bar` でログのセットを作成します。
- 最後の 3 つのイベントを無視します。

クォータは 2 つのログセットに適用され、最後の 3 つのイベントには適用されません。

[**Ignore when missing**] が選択されていない場合、クォータは 5 つのイベントすべてに適用されます。

##### オーバーライドの例

`service` でパーティションを設定し、2 つのサービス`a` と `b` がある場合は、オーバーライドを使用して、それぞれに異なるクォータを適用できます。たとえば、`service:a` に 5,000 バイトのクォータ制限を設定し、`service:b` に 50 イベントの制限を設定する場合、オーバーライドルールは次のようになります。

| サービス| タイプ| 制限|
|----------|----------|----------|
| `a`| バイト| 5,000|
| `b`| イベント| 50|

[5001]: /monitors/types/metric/?tab=threshold
