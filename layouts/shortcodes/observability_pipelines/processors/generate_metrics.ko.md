KPI와 같은 추세를 장기간 추적하기 위해 텔레메트리에 사용되는 로그 유형이 많습니다. CDN 로그, VPC 플로우 로그, 방화벽 로그, 네트워크 로그와 같은 대용량 로그에서 로그 데이터를 요약할 때 비용 효율적인 방법 중 하나가 로그에서 메트릭을 생성하는 것입니다. 메트릭 생성 프로세서를 사용하여 쿼리와 일치하는 로그의 카운트 메트릭 또는 요청 기간과 등 로그의 숫자 값에 관한 분포 메트릭을 생성할 수 있습니다.

**참고**: 생성된 지표는 [커스텀 지표][10031]이며 이에 따라 요금이 청구됩니다. 자세한 내용은 [커스텀 지표 청구][10032]를 참조하세요.

프로세서를 설정하려면,

**메트릭 관리**를 클릭하여 새 메트릭을 만들거나 기존 메트릭을 편집합니다. 그러면 사이드 패널이 열립니다.

- 아직 메트릭을 만들지 않았다면 [메트릭 추가](#메트릭 추가) 섹션에 설명된 대로 메트릭 매개변수를 입력하여 메트릭을 만듭니다.
- 이미 지표를 만든 경우 개요 표에서 해당 지표의 행을 클릭하여 수정하거나 삭제합니다. 검색창을 사용하여 이름으로 특정 지표를 찾은 다음 해당 지표를 선택하여 수정하거나 삭제합니다. 다른 지표를 추가하려면 **Add Metric**를 클릭합니다.

##### 메트릭 추가

 1. 필터 쿼리](#filter-query-syntax)를 입력합니다. 지정된 필터 쿼리와 일치하는 로그만 처리됩니다. 필터 쿼리와 일치하는지 여부에 관계없이 모든 로그는 파이프라인 다음 단계로 전송됩니다 **참고**: 단일 프로세서가 여러 메트릭을 생성할 수 있으므로 각 메트릭에 대해 서로 다른 필터 쿼리를 정의할 수 있습니다.
1. 지표의 이름을 입력합니다.
1. **Define parameters** 섹션에서 메트릭 유형(카운트, 게이지, 분포)을 선택합니다. 카운트 메트릭 예시](#count-metric-example) 및 [분포 메트릭 예시](#distribution-metric-example)를 참조하세요. 자세한 내용은 [메트릭 유형](#metrics-types)을 참조하세요.
    - 게이지 및 분포 지표 유형의 경우, 생성된 지표의 값에 사용되는 숫자(또는 파싱 가능한 숫자 문자열) 값이 있는 로그 필드를 선택합니다.
    - 분포 메트릭 유형의 경우 로그 필드의 값은 생성된 메트릭의 샘플 세트에 사용되는 (구문 분석 가능한) 숫자 배열일 수 있습니다.
    - **Group by** 필드는 메트릭 값을 함께 그룹화하는 방법을 결정합니다. 예를 들어 4개 지역에 수백 개의 호스트가 분산되어 있는 경우 지역별로 그룹화하면 모든 지역에 대해 한 줄의 그래프를 표시할 수 있습니다. 그룹화 기준** 설정에 나열된 필드는 구성된 메트릭의 태그로 설정됩니다.
1. **Add Metric**를 클릭합니다.

##### 메트릭 유형

로그에 이러한 유형의 메트릭을 생성할 수 있습니다. 자세한 내용은 [메트릭 유형][10033] 및 [분포][10034] 설명서를 참조하세요.

| 메트릭 유형  | 설명                                                                                                                                     | 예시                                                                                             |
| ------------ | ----------------------------------------------------------------------------------------------------------------------------------------------- | --------------------------------------------------------------------------------------------------- |
| 개수(COUNT)        | 한 시간 간격 동안 발생한 총 이벤트 수를 나타냅니다. 이 값은 0으로 재설정할 수 있지만 줄일 수는 없습니다.                | `status:error`로 로그 수를 계산하려고 합니다.                                         |
| GAUGE        | 한 시간 간격으로 이벤트의 스냅샷을 표시합니다.                                                                                           | 프로덕션 환경의 모든 로그에 대한 호스트별 최신 CPU 사용률을 측정하려고 합니다. |
| DISTRIBUTION | 전체 분산 인프라에서 한 시간 간격으로 계산된 값 집합의 글로벌 통계 분포를 나타냅니다. | API 호출이 이루어지는 데 걸리는 평균 시간을 측정하려고 합니다.                           |

##### 카운트 메트릭 예시

`status:error` 로그 예시:

```
{"status": "error", "env": "prod", "host": "ip-172-25-222-111.ec2.internal"}
```

`"status":"error"`를 포함하는 로그의 수를 카운트하고 `env` 및 `host`로 그룹화하는 카운트 메트릭을 만들려면 다음 정보를 입력합니다.

| 입력 파라미터 | 값               |
|------------------|---------------------|
| 쿼리 필터링     | `@status:error`     |
| 메트릭 이름      | `status_error_total`|
| 메트릭 유형      | 개수               |
| 그룹화         | `env`, `prod`       |

##### 배포 메트릭 예시

API 응답 로그의 예:

```
{
    "timestamp": "2018-10-15T17:01:33Z",
    "method": "GET",
    "status": 200,
    "request_body": "{"information"}",
    "response_time_seconds: 10
}
```

API 호출에 걸리는 평균 시간을 측정하는 분포 지표를 만들려면 다음 정보를 입력합니다.

| 입력 파라미터       | 값                   |
|------------------------|-------------------------|
| 쿼리 필터링           | `@method`               |
| 메트릭 이름            | `status_200_response`   |
| 메트릭 유형            | 분포            |
| 로그 속성 선택 | `response_time_seconds` |
| 그룹화               | `method`                |

[10031]: /ko/metrics/custom_metrics/
[10032]: /ko/account_management/billing/custom_metrics/
[10033]: /ko/metrics/types/
[10034]: /ko/metrics/distributions/
